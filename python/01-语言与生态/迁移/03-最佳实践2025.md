# 最佳实践2025（迁移自 docs/model/Programming_Language/python_best_practices_2025.md）

（完整迁移，后续精炼与本地交叉引用补全）

## 1. 代码质量与规范

- 类型优先：公共 API 必须注解；内部关键路径注解
- Lint 优先：`ruff` 一站式，必要时补充 `pylint`
- 格式统一：`black`（或 `ruff format`）

```python
from typing import Iterable, Iterator, TypeVar

T = TypeVar("T")

def batched(items: Iterable[T], size: int) -> Iterator[list[T]]:
    if size <= 0:
        raise ValueError("size must be positive")
    batch: list[T] = []
    for item in items:
        batch.append(item)
        if len(batch) == size:
            yield batch
            batch = []
    if batch:
        yield batch
```

## 2. 依赖与构建（uv）

```bash
uv pip compile pyproject.toml -o uv.lock
uv pip sync uv.lock
uv build && uv publish --repository pypi
```

## 3. 测试与质量门禁

- 单元/集成/端到端分层
- 覆盖率阈值：`--cov-fail-under=80`

```bash
pytest -q --cov=src --cov-fail-under=80
ruff check . && mypy src
```

## 4. 并发与IO

- 优先 `asyncio` + 限流（`Semaphore` / `TaskGroup`）
- I/O 绑定使用异步；CPU 绑定使用进程池

## 5. 观测与运维

- 结构化日志（JSON）+ 统一字段
- 性能/错误指标接入（如 OpenTelemetry）

---

## 返回与相关

- 返回上级：[01-语言与生态/README](../README.md)
- 导航索引：[@SUMMARY](../../SUMMARY.md)
- 相关文档：
  - [04-安全开发指南](./04-安全开发指南.md)
  - [05-性能优化指南](./05-性能优化指南.md)
