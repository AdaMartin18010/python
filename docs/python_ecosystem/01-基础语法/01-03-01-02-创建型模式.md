# åˆ›å»ºå‹æ¨¡å¼

## ğŸ“‹ æ¦‚è¿°

åˆ›å»ºå‹æ¨¡å¼å¤„ç†å¯¹è±¡åˆ›å»ºæœºåˆ¶ï¼Œè¯•å›¾åœ¨é€‚åˆç‰¹å®šæƒ…å†µçš„åœºæ™¯ä¸‹åˆ›å»ºå¯¹è±¡ã€‚æœ¬æ–‡æ¡£ä»å½¢å¼åŒ–è§’åº¦å®šä¹‰åˆ›å»ºå‹æ¨¡å¼çš„ç†è®ºæ¡†æ¶ï¼Œå¹¶æä¾›å®Œæ•´çš„Pythonå®ç°ã€‚

## 1. å½¢å¼åŒ–å®šä¹‰

### 1.1 åˆ›å»ºå‹æ¨¡å¼çš„åŸºæœ¬æ¦‚å¿µ

**å®šä¹‰ 1.1** (åˆ›å»ºå‹æ¨¡å¼)
åˆ›å»ºå‹æ¨¡å¼æ˜¯ä¸€ä¸ªå››å…ƒç»„ $(C, F, P, R)$ï¼Œå…¶ä¸­ï¼š

- $C$ æ˜¯åˆ›å»ºå™¨é›†åˆ (Creators)
- $F$ æ˜¯å·¥å‚é›†åˆ (Factories)
- $P$ æ˜¯äº§å“é›†åˆ (Products)
- $R$ æ˜¯åˆ›å»ºè§„åˆ™é›†åˆ (Rules)

**å®šä¹‰ 1.2** (å¯¹è±¡åˆ›å»º)
å¯¹è±¡åˆ›å»ºæ˜¯ä¸€ä¸ªæ˜ å°„ $\phi: C \times P \rightarrow P$ï¼Œæ»¡è¶³ï¼š

1. **å”¯ä¸€æ€§**: å¯¹äºç»™å®šçš„åˆ›å»ºå™¨å’Œäº§å“ç±»å‹ï¼Œåˆ›å»ºç»“æœæ˜¯å”¯ä¸€çš„
2. **ä¸€è‡´æ€§**: åˆ›å»ºè¿‡ç¨‹éµå¾ªé¢„å®šä¹‰çš„è§„åˆ™
3. **å¯æ‰©å±•æ€§**: æ”¯æŒæ–°äº§å“çš„åˆ›å»º

**å®šä¹‰ 1.3** (åˆ›å»ºè§„åˆ™)
åˆ›å»ºè§„åˆ™ $r$ æ˜¯ä¸€ä¸ªä¸‰å…ƒç»„ $(c, p, m)$ï¼Œå…¶ä¸­ï¼š

- $c \in C$ æ˜¯åˆ›å»ºå™¨
- $p \in P$ æ˜¯äº§å“
- $m$ æ˜¯åˆ›å»ºæ–¹æ³•

### 1.2 åˆ›å»ºå‹æ¨¡å¼åˆ†ç±»

**å®šä¹‰ 1.4** (å•ä¾‹æ¨¡å¼)
å•ä¾‹æ¨¡å¼ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹ã€‚

**å®šä¹‰ 1.5** (å·¥å‚æ–¹æ³•æ¨¡å¼)
å·¥å‚æ–¹æ³•æ¨¡å¼å®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ã€‚

**å®šä¹‰ 1.6** (æŠ½è±¡å·¥å‚æ¨¡å¼)
æŠ½è±¡å·¥å‚æ¨¡å¼æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œè€Œæ— éœ€æŒ‡å®šå®ƒä»¬çš„å…·ä½“ç±»ã€‚

**å®šä¹‰ 1.7** (å»ºé€ è€…æ¨¡å¼)
å»ºé€ è€…æ¨¡å¼å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚

**å®šä¹‰ 1.8** (åŸå‹æ¨¡å¼)
åŸå‹æ¨¡å¼ç”¨åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶ä¸”é€šè¿‡å¤åˆ¶è¿™äº›åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚

## 2. æ¨¡å¼ç†è®º

### 2.1 å•ä¾‹æ¨¡å¼ç†è®º

**å®šç† 2.1** (å•ä¾‹å”¯ä¸€æ€§)
å¦‚æœå•ä¾‹æ¨¡å¼å®ç°æ­£ç¡®ï¼Œåˆ™ç³»ç»Ÿä¸­æœ€å¤šå­˜åœ¨ä¸€ä¸ªå•ä¾‹å®ä¾‹ã€‚

**è¯æ˜**:
è®¾ $S$ æ˜¯å•ä¾‹ç±»ï¼Œ$I_1$ å’Œ $I_2$ æ˜¯ä¸¤ä¸ªå®ä¾‹ã€‚
æ ¹æ®å•ä¾‹æ¨¡å¼çš„å®šä¹‰ï¼Œ$I_1 = S.getInstance()$ å’Œ $I_2 = S.getInstance()$ã€‚
ç”±äºå•ä¾‹æ¨¡å¼ä¿è¯å…¨å±€å”¯ä¸€æ€§ï¼Œ$I_1 = I_2$ã€‚
å› æ­¤ï¼Œç³»ç»Ÿä¸­æœ€å¤šå­˜åœ¨ä¸€ä¸ªå•ä¾‹å®ä¾‹ã€‚$\square$

**å®šç† 2.2** (å•ä¾‹çº¿ç¨‹å®‰å…¨)
ä½¿ç”¨åŒé‡æ£€æŸ¥é”å®šçš„å•ä¾‹æ¨¡å¼æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚

**è¯æ˜**:
åŒé‡æ£€æŸ¥é”å®šåŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š

1. ç¬¬ä¸€æ¬¡æ£€æŸ¥ï¼š`if instance is None`
2. è·å–é”ï¼š`with lock:`
3. ç¬¬äºŒæ¬¡æ£€æŸ¥ï¼š`if instance is None`
4. åˆ›å»ºå®ä¾‹ï¼š`instance = Singleton()`

ç”±äºé”çš„å­˜åœ¨ï¼Œå¤šä¸ªçº¿ç¨‹æ— æ³•åŒæ—¶æ‰§è¡Œæ­¥éª¤3å’Œ4ã€‚
å› æ­¤ï¼Œå•ä¾‹æ¨¡å¼æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚$\square$

### 2.2 å·¥å‚æ–¹æ³•æ¨¡å¼ç†è®º

**å®šç† 2.3** (å·¥å‚æ–¹æ³•å¯æ‰©å±•æ€§)
å·¥å‚æ–¹æ³•æ¨¡å¼æ”¯æŒåœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„æƒ…å†µä¸‹æ·»åŠ æ–°äº§å“ã€‚

**è¯æ˜**:
è®¾ $F$ æ˜¯å·¥å‚æ¥å£ï¼Œ$C$ æ˜¯å…·ä½“å·¥å‚ï¼Œ$P$ æ˜¯äº§å“æ¥å£ã€‚
è¦æ·»åŠ æ–°äº§å“ $P'$ï¼Œåªéœ€è¦ï¼š

1. åˆ›å»ºå…·ä½“äº§å“ $C'$ å®ç° $P$
2. åˆ›å»ºå…·ä½“å·¥å‚ $F'$ å®ç° $F$
3. åœ¨ $F'$ ä¸­è¿”å› $C'$ çš„å®ä¾‹

ç”±äº $F$ å’Œ $P$ æ˜¯æŠ½è±¡æ¥å£ï¼Œç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹ã€‚
å› æ­¤ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼æ”¯æŒå¯æ‰©å±•æ€§ã€‚$\square$

### 2.3 æŠ½è±¡å·¥å‚æ¨¡å¼ç†è®º

**å®šç† 2.4** (æŠ½è±¡å·¥å‚ä¸€è‡´æ€§)
æŠ½è±¡å·¥å‚æ¨¡å¼ç¡®ä¿åˆ›å»ºçš„äº§å“æ—å…·æœ‰ä¸€è‡´æ€§ã€‚

**è¯æ˜**:
è®¾ $AF$ æ˜¯æŠ½è±¡å·¥å‚ï¼Œ$P_1, P_2, \ldots, P_n$ æ˜¯äº§å“æ—ã€‚
æŠ½è±¡å·¥å‚å®šä¹‰äº†äº§å“æ—ä¸­æ‰€æœ‰äº§å“çš„åˆ›å»ºæ¥å£ã€‚
å…·ä½“å·¥å‚å®ç°è¿™äº›æ¥å£ï¼Œç¡®ä¿åˆ›å»ºçš„äº§å“å±äºåŒä¸€æ—ã€‚
å› æ­¤ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼ä¿è¯äº§å“æ—çš„ä¸€è‡´æ€§ã€‚$\square$

## 3. Pythonå®ç°

### 3.1 åŸºç¡€ç±»å®šä¹‰

```python
from abc import ABC, abstractmethod
from typing import Dict, List, Any, Optional, Union, Type, TypeVar, Generic
from dataclasses import dataclass, field
from enum import Enum
import threading
import copy
from collections import defaultdict

T = TypeVar('T')

class ProductType(Enum):
    """äº§å“ç±»å‹æšä¸¾"""
    CONCRETE_A = "concrete_a"
    CONCRETE_B = "concrete_b"
    CONCRETE_C = "concrete_c"

class Product(ABC):
    """äº§å“æŠ½è±¡åŸºç±»"""
    
    def __init__(self, name: str):
        self.name = name
    
    @abstractmethod
    def operation(self) -> str:
        """äº§å“æ“ä½œ"""
        pass
    
    def __str__(self):
        return f"{self.__class__.__name__}({self.name})"

class ConcreteProductA(Product):
    """å…·ä½“äº§å“A"""
    
    def __init__(self, name: str = "ProductA"):
        super().__init__(name)
    
    def operation(self) -> str:
        return f"{self.name}: Operation A"

class ConcreteProductB(Product):
    """å…·ä½“äº§å“B"""
    
    def __init__(self, name: str = "ProductB"):
        super().__init__(name)
    
    def operation(self) -> str:
        return f"{self.name}: Operation B"

class ConcreteProductC(Product):
    """å…·ä½“äº§å“C"""
    
    def __init__(self, name: str = "ProductC"):
        super().__init__(name)
    
    def operation(self) -> str:
        return f"{self.name}: Operation C"

class Singleton:
    """å•ä¾‹æ¨¡å¼å®ç°"""
    
    _instance = None
    _lock = threading.Lock()
    _initialized = False
    
    def __new__(cls):
        if cls._instance is None:
            with cls._lock:
                if cls._instance is None:
                    cls._instance = super().__new__(cls)
        return cls._instance
    
    def __init__(self):
        if not Singleton._initialized:
            self.data = {}
            Singleton._initialized = True
    
    def get_data(self, key: str) -> Any:
        """è·å–æ•°æ®"""
        return self.data.get(key)
    
    def set_data(self, key: str, value: Any):
        """è®¾ç½®æ•°æ®"""
        self.data[key] = value
    
    def clear_data(self):
        """æ¸…é™¤æ•°æ®"""
        self.data.clear()

class SingletonRegistry:
    """å•ä¾‹æ³¨å†Œè¡¨"""
    
    def __init__(self):
        self._instances: Dict[str, Any] = {}
        self._lock = threading.Lock()
    
    def get_instance(self, class_name: str, creator_func: Callable) -> Any:
        """è·å–å•ä¾‹å®ä¾‹"""
        if class_name not in self._instances:
            with self._lock:
                if class_name not in self._instances:
                    self._instances[class_name] = creator_func()
        return self._instances[class_name]
    
    def clear_instances(self):
        """æ¸…é™¤æ‰€æœ‰å®ä¾‹"""
        with self._lock:
            self._instances.clear()

class Creator(ABC):
    """åˆ›å»ºè€…æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def factory_method(self) -> Product:
        """å·¥å‚æ–¹æ³•"""
        pass
    
    def some_operation(self) -> str:
        """ä¸€äº›æ“ä½œ"""
        product = self.factory_method()
        return f"Creator: {product.operation()}"

class ConcreteCreatorA(Creator):
    """å…·ä½“åˆ›å»ºè€…A"""
    
    def factory_method(self) -> Product:
        return ConcreteProductA()

class ConcreteCreatorB(Creator):
    """å…·ä½“åˆ›å»ºè€…B"""
    
    def factory_method(self) -> Product:
        return ConcreteProductB()

class ConcreteCreatorC(Creator):
    """å…·ä½“åˆ›å»ºè€…C"""
    
    def factory_method(self) -> Product:
        return ConcreteProductC()

class AbstractFactory(ABC):
    """æŠ½è±¡å·¥å‚"""
    
    @abstractmethod
    def create_product_a(self) -> Product:
        """åˆ›å»ºäº§å“A"""
        pass
    
    @abstractmethod
    def create_product_b(self) -> Product:
        """åˆ›å»ºäº§å“B"""
        pass
    
    @abstractmethod
    def create_product_c(self) -> Product:
        """åˆ›å»ºäº§å“C"""
        pass

class ConcreteFactory1(AbstractFactory):
    """å…·ä½“å·¥å‚1"""
    
    def create_product_a(self) -> Product:
        return ConcreteProductA("Factory1_ProductA")
    
    def create_product_b(self) -> Product:
        return ConcreteProductB("Factory1_ProductB")
    
    def create_product_c(self) -> Product:
        return ConcreteProductC("Factory1_ProductC")

class ConcreteFactory2(AbstractFactory):
    """å…·ä½“å·¥å‚2"""
    
    def create_product_a(self) -> Product:
        return ConcreteProductA("Factory2_ProductA")
    
    def create_product_b(self) -> Product:
        return ConcreteProductB("Factory2_ProductB")
    
    def create_product_c(self) -> Product:
        return ConcreteProductC("Factory2_ProductC")

class ProductBuilder:
    """äº§å“å»ºé€ è€…"""
    
    def __init__(self):
        self.reset()
    
    def reset(self):
        """é‡ç½®å»ºé€ è€…"""
        self._product = None
        self._parts = []
    
    def set_name(self, name: str):
        """è®¾ç½®äº§å“åç§°"""
        self._parts.append(f"name={name}")
        return self
    
    def add_feature(self, feature: str):
        """æ·»åŠ ç‰¹æ€§"""
        self._parts.append(f"feature={feature}")
        return self
    
    def set_type(self, product_type: ProductType):
        """è®¾ç½®äº§å“ç±»å‹"""
        self._parts.append(f"type={product_type.value}")
        return self
    
    def build(self) -> Product:
        """æ„å»ºäº§å“"""
        if not self._parts:
            raise ValueError("æ²¡æœ‰è®¾ç½®ä»»ä½•å±æ€§")
        
        # æ ¹æ®ç±»å‹åˆ›å»ºäº§å“
        product_type = None
        name = "DefaultProduct"
        
        for part in self._parts:
            if part.startswith("type="):
                product_type = ProductType(part.split("=")[1])
            elif part.startswith("name="):
                name = part.split("=")[1]
        
        if product_type == ProductType.CONCRETE_A:
            self._product = ConcreteProductA(name)
        elif product_type == ProductType.CONCRETE_B:
            self._product = ConcreteProductB(name)
        elif product_type == ProductType.CONCRETE_C:
            self._product = ConcreteProductC(name)
        else:
            self._product = ConcreteProductA(name)
        
        return self._product

class ProductDirector:
    """äº§å“æŒ‡å¯¼è€…"""
    
    def __init__(self, builder: ProductBuilder):
        self.builder = builder
    
    def construct_simple_product(self, name: str) -> Product:
        """æ„å»ºç®€å•äº§å“"""
        return self.builder.reset().set_name(name).build()
    
    def construct_complex_product(self, name: str, features: List[str]) -> Product:
        """æ„å»ºå¤æ‚äº§å“"""
        builder = self.builder.reset().set_name(name)
        for feature in features:
            builder.add_feature(feature)
        return builder.build()

class Prototype(ABC):
    """åŸå‹æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def clone(self) -> 'Prototype':
        """å…‹éš†æ–¹æ³•"""
        pass

class ConcretePrototype(Prototype):
    """å…·ä½“åŸå‹"""
    
    def __init__(self, name: str, data: Dict[str, Any]):
        self.name = name
        self.data = data.copy()
    
    def clone(self) -> 'ConcretePrototype':
        """å…‹éš†åŸå‹"""
        return ConcretePrototype(self.name, self.data.copy())
    
    def set_data(self, key: str, value: Any):
        """è®¾ç½®æ•°æ®"""
        self.data[key] = value
    
    def get_data(self, key: str) -> Any:
        """è·å–æ•°æ®"""
        return self.data.get(key)
    
    def __str__(self):
        return f"ConcretePrototype({self.name}, {self.data})"

class PrototypeRegistry:
    """åŸå‹æ³¨å†Œè¡¨"""
    
    def __init__(self):
        self._prototypes: Dict[str, Prototype] = {}
    
    def register_prototype(self, name: str, prototype: Prototype):
        """æ³¨å†ŒåŸå‹"""
        self._prototypes[name] = prototype
    
    def get_prototype(self, name: str) -> Optional[Prototype]:
        """è·å–åŸå‹"""
        prototype = self._prototypes.get(name)
        if prototype:
            return prototype.clone()
        return None
    
    def list_prototypes(self) -> List[str]:
        """åˆ—å‡ºæ‰€æœ‰åŸå‹"""
        return list(self._prototypes.keys())

class ObjectPool:
    """å¯¹è±¡æ± """
    
    def __init__(self, creator_func: Callable, max_size: int = 10):
        self.creator_func = creator_func
        self.max_size = max_size
        self._pool: List[Any] = []
        self._in_use: List[Any] = []
        self._lock = threading.Lock()
    
    def acquire(self) -> Any:
        """è·å–å¯¹è±¡"""
        with self._lock:
            if self._pool:
                obj = self._pool.pop()
                self._in_use.append(obj)
                return obj
            elif len(self._in_use) < self.max_size:
                obj = self.creator_func()
                self._in_use.append(obj)
                return obj
            else:
                raise RuntimeError("å¯¹è±¡æ± å·²æ»¡")
    
    def release(self, obj: Any):
        """é‡Šæ”¾å¯¹è±¡"""
        with self._lock:
            if obj in self._in_use:
                self._in_use.remove(obj)
                self._pool.append(obj)
    
    def get_pool_size(self) -> int:
        """è·å–æ± å¤§å°"""
        return len(self._pool)
    
    def get_in_use_size(self) -> int:
        """è·å–ä½¿ç”¨ä¸­çš„å¯¹è±¡æ•°é‡"""
        return len(self._in_use)

class PatternAnalyzer:
    """æ¨¡å¼åˆ†æå™¨"""
    
    @staticmethod
    def analyze_singleton_usage(singleton_class: Type) -> Dict[str, Any]:
        """åˆ†æå•ä¾‹ä½¿ç”¨æƒ…å†µ"""
        analysis = {
            'instance_count': 0,
            'thread_safe': False,
            'lazy_initialization': False,
            'global_access': False
        }
        
        # æ£€æŸ¥å®ä¾‹æ•°é‡
        instances = set()
        for _ in range(10):
            instance = singleton_class()
            instances.add(id(instance))
        
        analysis['instance_count'] = len(instances)
        
        # æ£€æŸ¥çº¿ç¨‹å®‰å…¨
        analysis['thread_safe'] = hasattr(singleton_class, '_lock')
        
        # æ£€æŸ¥å»¶è¿Ÿåˆå§‹åŒ–
        analysis['lazy_initialization'] = hasattr(singleton_class, '_instance')
        
        # æ£€æŸ¥å…¨å±€è®¿é—®
        analysis['global_access'] = hasattr(singleton_class, 'getInstance')
        
        return analysis
    
    @staticmethod
    def analyze_factory_method_usage(creator_class: Type) -> Dict[str, Any]:
        """åˆ†æå·¥å‚æ–¹æ³•ä½¿ç”¨æƒ…å†µ"""
        analysis = {
            'has_factory_method': False,
            'has_abstract_method': False,
            'supports_extension': False
        }
        
        # æ£€æŸ¥æ˜¯å¦æœ‰å·¥å‚æ–¹æ³•
        analysis['has_factory_method'] = hasattr(creator_class, 'factory_method')
        
        # æ£€æŸ¥æ˜¯å¦æœ‰æŠ½è±¡æ–¹æ³•
        analysis['has_abstract_method'] = hasattr(creator_class, '__abstractmethods__')
        
        # æ£€æŸ¥æ˜¯å¦æ”¯æŒæ‰©å±•
        analysis['supports_extension'] = len(creator_class.__subclasses__()) > 0
        
        return analysis
    
    @staticmethod
    def analyze_abstract_factory_usage(factory_class: Type) -> Dict[str, Any]:
        """åˆ†ææŠ½è±¡å·¥å‚ä½¿ç”¨æƒ…å†µ"""
        analysis = {
            'product_family_size': 0,
            'has_abstract_methods': False,
            'concrete_factories': 0
        }
        
        # è®¡ç®—äº§å“æ—å¤§å°
        abstract_methods = [method for method in dir(factory_class) 
                          if method.startswith('create_')]
        analysis['product_family_size'] = len(abstract_methods)
        
        # æ£€æŸ¥æ˜¯å¦æœ‰æŠ½è±¡æ–¹æ³•
        analysis['has_abstract_methods'] = hasattr(factory_class, '__abstractmethods__')
        
        # è®¡ç®—å…·ä½“å·¥å‚æ•°é‡
        analysis['concrete_factories'] = len(factory_class.__subclasses__())
        
        return analysis

class PatternValidator:
    """æ¨¡å¼éªŒè¯å™¨"""
    
    @staticmethod
    def validate_singleton_pattern(singleton_class: Type) -> Dict[str, Any]:
        """éªŒè¯å•ä¾‹æ¨¡å¼"""
        validation = {
            'is_valid': True,
            'errors': [],
            'warnings': []
        }
        
        # æ£€æŸ¥å®ä¾‹å”¯ä¸€æ€§
        instance1 = singleton_class()
        instance2 = singleton_class()
        
        if instance1 is not instance2:
            validation['is_valid'] = False
            validation['errors'].append("å®ä¾‹ä¸å”¯ä¸€")
        
        # æ£€æŸ¥çº¿ç¨‹å®‰å…¨
        if not hasattr(singleton_class, '_lock'):
            validation['warnings'].append("å¯èƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„")
        
        # æ£€æŸ¥å»¶è¿Ÿåˆå§‹åŒ–
        if not hasattr(singleton_class, '_instance'):
            validation['warnings'].append("ä¸æ˜¯å»¶è¿Ÿåˆå§‹åŒ–")
        
        return validation
    
    @staticmethod
    def validate_factory_method_pattern(creator_class: Type) -> Dict[str, Any]:
        """éªŒè¯å·¥å‚æ–¹æ³•æ¨¡å¼"""
        validation = {
            'is_valid': True,
            'errors': [],
            'warnings': []
        }
        
        # æ£€æŸ¥æ˜¯å¦æœ‰å·¥å‚æ–¹æ³•
        if not hasattr(creator_class, 'factory_method'):
            validation['is_valid'] = False
            validation['errors'].append("ç¼ºå°‘å·¥å‚æ–¹æ³•")
        
        # æ£€æŸ¥å·¥å‚æ–¹æ³•æ˜¯å¦è¿”å›äº§å“
        if hasattr(creator_class, 'factory_method'):
            try:
                creator = creator_class()
                product = creator.factory_method()
                if not isinstance(product, Product):
                    validation['warnings'].append("å·¥å‚æ–¹æ³•è¿”å›çš„ä¸æ˜¯äº§å“ç±»å‹")
            except Exception as e:
                validation['errors'].append(f"å·¥å‚æ–¹æ³•è°ƒç”¨å¤±è´¥: {e}")
        
        return validation
    
    @staticmethod
    def validate_abstract_factory_pattern(factory_class: Type) -> Dict[str, Any]:
        """éªŒè¯æŠ½è±¡å·¥å‚æ¨¡å¼"""
        validation = {
            'is_valid': True,
            'errors': [],
            'warnings': []
        }
        
        # æ£€æŸ¥æ˜¯å¦æœ‰æŠ½è±¡æ–¹æ³•
        if not hasattr(factory_class, '__abstractmethods__'):
            validation['is_valid'] = False
            validation['errors'].append("ä¸æ˜¯æŠ½è±¡ç±»")
        
        # æ£€æŸ¥äº§å“æ—æ–¹æ³•
        create_methods = [method for method in dir(factory_class) 
                         if method.startswith('create_')]
        if len(create_methods) < 2:
            validation['warnings'].append("äº§å“æ—æ–¹æ³•æ•°é‡è¾ƒå°‘")
        
        return validation
```

### 3.2 å®é™…åº”ç”¨ç¤ºä¾‹

```python
def singleton_pattern_example():
    """å•ä¾‹æ¨¡å¼ç¤ºä¾‹"""
    
    print("=== å•ä¾‹æ¨¡å¼ç¤ºä¾‹ ===")
    
    # åˆ›å»ºå•ä¾‹å®ä¾‹
    singleton1 = Singleton()
    singleton2 = Singleton()
    
    print("å®ä¾‹1 ID:", id(singleton1))
    print("å®ä¾‹2 ID:", id(singleton2))
    print("æ˜¯å¦ä¸ºåŒä¸€å®ä¾‹:", singleton1 is singleton2)
    
    # æµ‹è¯•æ•°æ®å…±äº«
    singleton1.set_data("config", "value1")
    print("å®ä¾‹2è·å–æ•°æ®:", singleton2.get_data("config"))
    
    # ä½¿ç”¨å•ä¾‹æ³¨å†Œè¡¨
    registry = SingletonRegistry()
    
    def create_config_manager():
        return {"setting": "default"}
    
    config1 = registry.get_instance("ConfigManager", create_config_manager)
    config2 = registry.get_instance("ConfigManager", create_config_manager)
    
    print("é…ç½®ç®¡ç†å™¨æ˜¯å¦ä¸ºåŒä¸€å®ä¾‹:", config1 is config2)
    
    return singleton1, registry

def factory_method_pattern_example():
    """å·¥å‚æ–¹æ³•æ¨¡å¼ç¤ºä¾‹"""
    
    print("\n=== å·¥å‚æ–¹æ³•æ¨¡å¼ç¤ºä¾‹ ===")
    
    # åˆ›å»ºä¸åŒçš„åˆ›å»ºè€…
    creators = [
        ConcreteCreatorA(),
        ConcreteCreatorB(),
        ConcreteCreatorC()
    ]
    
    # ä½¿ç”¨å·¥å‚æ–¹æ³•åˆ›å»ºäº§å“
    for creator in creators:
        product = creator.factory_method()
        result = creator.some_operation()
        print(f"{creator.__class__.__name__}: {result}")
    
    # åˆ†æå·¥å‚æ–¹æ³•ä½¿ç”¨æƒ…å†µ
    analyzer = PatternAnalyzer()
    for creator in creators:
        analysis = analyzer.analyze_factory_method_usage(type(creator))
        print(f"{creator.__class__.__name__} åˆ†æ:", analysis)
    
    return creators

def abstract_factory_pattern_example():
    """æŠ½è±¡å·¥å‚æ¨¡å¼ç¤ºä¾‹"""
    
    print("\n=== æŠ½è±¡å·¥å‚æ¨¡å¼ç¤ºä¾‹ ===")
    
    # åˆ›å»ºä¸åŒçš„å·¥å‚
    factories = [
        ConcreteFactory1(),
        ConcreteFactory2()
    ]
    
    # ä½¿ç”¨æŠ½è±¡å·¥å‚åˆ›å»ºäº§å“æ—
    for i, factory in enumerate(factories, 1):
        print(f"\nå·¥å‚ {i} åˆ›å»ºçš„äº§å“æ—:")
        product_a = factory.create_product_a()
        product_b = factory.create_product_b()
        product_c = factory.create_product_c()
        
        print(f"äº§å“A: {product_a.operation()}")
        print(f"äº§å“B: {product_b.operation()}")
        print(f"äº§å“C: {product_c.operation()}")
    
    # åˆ†ææŠ½è±¡å·¥å‚ä½¿ç”¨æƒ…å†µ
    analyzer = PatternAnalyzer()
    for factory in factories:
        analysis = analyzer.analyze_abstract_factory_usage(type(factory))
        print(f"{factory.__class__.__name__} åˆ†æ:", analysis)
    
    return factories

def builder_pattern_example():
    """å»ºé€ è€…æ¨¡å¼ç¤ºä¾‹"""
    
    print("\n=== å»ºé€ è€…æ¨¡å¼ç¤ºä¾‹ ===")
    
    # åˆ›å»ºå»ºé€ è€…å’ŒæŒ‡å¯¼è€…
    builder = ProductBuilder()
    director = ProductDirector(builder)
    
    # æ„å»ºç®€å•äº§å“
    simple_product = director.construct_simple_product("SimpleProduct")
    print("ç®€å•äº§å“:", simple_product.operation())
    
    # æ„å»ºå¤æ‚äº§å“
    features = ["feature1", "feature2", "feature3"]
    complex_product = director.construct_complex_product("ComplexProduct", features)
    print("å¤æ‚äº§å“:", complex_product.operation())
    
    # ç›´æ¥ä½¿ç”¨å»ºé€ è€…
    custom_product = (builder.reset()
                     .set_name("CustomProduct")
                     .set_type(ProductType.CONCRETE_B)
                     .add_feature("custom_feature")
                     .build())
    print("è‡ªå®šä¹‰äº§å“:", custom_product.operation())
    
    return builder, director

def prototype_pattern_example():
    """åŸå‹æ¨¡å¼ç¤ºä¾‹"""
    
    print("\n=== åŸå‹æ¨¡å¼ç¤ºä¾‹ ===")
    
    # åˆ›å»ºåŸå‹
    original_prototype = ConcretePrototype("Original", {"key": "value"})
    print("åŸå§‹åŸå‹:", original_prototype)
    
    # å…‹éš†åŸå‹
    cloned_prototype = original_prototype.clone()
    print("å…‹éš†åŸå‹:", cloned_prototype)
    
    # ä¿®æ”¹å…‹éš†åŸå‹
    cloned_prototype.set_data("new_key", "new_value")
    print("ä¿®æ”¹åçš„å…‹éš†åŸå‹:", cloned_prototype)
    print("åŸå§‹åŸå‹:", original_prototype)
    
    # ä½¿ç”¨åŸå‹æ³¨å†Œè¡¨
    registry = PrototypeRegistry()
    registry.register_prototype("default", original_prototype)
    
    # ä»æ³¨å†Œè¡¨è·å–åŸå‹
    retrieved_prototype = registry.get_prototype("default")
    print("ä»æ³¨å†Œè¡¨è·å–çš„åŸå‹:", retrieved_prototype)
    
    return original_prototype, registry

def object_pool_pattern_example():
    """å¯¹è±¡æ± æ¨¡å¼ç¤ºä¾‹"""
    
    print("\n=== å¯¹è±¡æ± æ¨¡å¼ç¤ºä¾‹ ===")
    
    # åˆ›å»ºå¯¹è±¡æ± 
    def create_product():
        return ConcreteProductA(f"PooledProduct_{id(ConcreteProductA())}")
    
    pool = ObjectPool(create_product, max_size=3)
    
    # è·å–å¯¹è±¡
    objects = []
    for i in range(3):
        obj = pool.acquire()
        objects.append(obj)
        print(f"è·å–å¯¹è±¡ {i+1}: {obj}")
    
    # é‡Šæ”¾å¯¹è±¡
    for i, obj in enumerate(objects):
        pool.release(obj)
        print(f"é‡Šæ”¾å¯¹è±¡ {i+1}")
    
    # æ£€æŸ¥æ± çŠ¶æ€
    print(f"æ± ä¸­å¯¹è±¡æ•°é‡: {pool.get_pool_size()}")
    print(f"ä½¿ç”¨ä¸­å¯¹è±¡æ•°é‡: {pool.get_in_use_size()}")
    
    return pool

def pattern_validation_example():
    """æ¨¡å¼éªŒè¯ç¤ºä¾‹"""
    
    print("\n=== æ¨¡å¼éªŒè¯ç¤ºä¾‹ ===")
    
    validator = PatternValidator()
    
    # éªŒè¯å•ä¾‹æ¨¡å¼
    singleton_validation = validator.validate_singleton_pattern(Singleton)
    print("å•ä¾‹æ¨¡å¼éªŒè¯:", singleton_validation)
    
    # éªŒè¯å·¥å‚æ–¹æ³•æ¨¡å¼
    factory_method_validation = validator.validate_factory_method_pattern(ConcreteCreatorA)
    print("å·¥å‚æ–¹æ³•æ¨¡å¼éªŒè¯:", factory_method_validation)
    
    # éªŒè¯æŠ½è±¡å·¥å‚æ¨¡å¼
    abstract_factory_validation = validator.validate_abstract_factory_pattern(AbstractFactory)
    print("æŠ½è±¡å·¥å‚æ¨¡å¼éªŒè¯:", abstract_factory_validation)
    
    return validator

# è¿è¡Œç¤ºä¾‹
if __name__ == "__main__":
    print("=== åˆ›å»ºå‹æ¨¡å¼ç³»ç»Ÿæ¼”ç¤º ===")
    
    # å•ä¾‹æ¨¡å¼ç¤ºä¾‹
    singleton, registry = singleton_pattern_example()
    
    # å·¥å‚æ–¹æ³•æ¨¡å¼ç¤ºä¾‹
    creators = factory_method_pattern_example()
    
    # æŠ½è±¡å·¥å‚æ¨¡å¼ç¤ºä¾‹
    factories = abstract_factory_pattern_example()
    
    # å»ºé€ è€…æ¨¡å¼ç¤ºä¾‹
    builder, director = builder_pattern_example()
    
    # åŸå‹æ¨¡å¼ç¤ºä¾‹
    prototype, prototype_registry = prototype_pattern_example()
    
    # å¯¹è±¡æ± æ¨¡å¼ç¤ºä¾‹
    pool = object_pool_pattern_example()
    
    # æ¨¡å¼éªŒè¯ç¤ºä¾‹
    validator = pattern_validation_example()
    
    print("\n=== ç³»ç»ŸåŠŸèƒ½æ€»ç»“ ===")
    print("1. å•ä¾‹æ¨¡å¼: ç¡®ä¿å…¨å±€å”¯ä¸€å®ä¾‹")
    print("2. å·¥å‚æ–¹æ³•æ¨¡å¼: å»¶è¿Ÿå¯¹è±¡åˆ›å»ºåˆ°å­ç±»")
    print("3. æŠ½è±¡å·¥å‚æ¨¡å¼: åˆ›å»ºç›¸å…³äº§å“æ—")
    print("4. å»ºé€ è€…æ¨¡å¼: åˆ†æ­¥æ„å»ºå¤æ‚å¯¹è±¡")
    print("5. åŸå‹æ¨¡å¼: é€šè¿‡å…‹éš†åˆ›å»ºå¯¹è±¡")
    print("6. å¯¹è±¡æ± æ¨¡å¼: é‡ç”¨æ˜‚è´µå¯¹è±¡")
    print("7. æ¨¡å¼åˆ†æ: åˆ†ææ¨¡å¼ä½¿ç”¨æƒ…å†µ")
    print("8. æ¨¡å¼éªŒè¯: éªŒè¯æ¨¡å¼å®ç°æ­£ç¡®æ€§")
```

## 4. ç†è®ºè¯æ˜

### 4.1 åˆ›å»ºå‹æ¨¡å¼æ­£ç¡®æ€§

**å®šç† 4.1** (åˆ›å»ºå‹æ¨¡å¼æ­£ç¡®æ€§)
å¦‚æœåˆ›å»ºå‹æ¨¡å¼å®ç°æ­£ç¡®ï¼Œåˆ™åˆ›å»ºçš„å¯¹è±¡æ»¡è¶³é¢„å®šä¹‰çš„çº¦æŸæ¡ä»¶ã€‚

**è¯æ˜**:
è®¾ $P$ æ˜¯äº§å“é›†åˆï¼Œ$C$ æ˜¯åˆ›å»ºå™¨é›†åˆï¼Œ$R$ æ˜¯åˆ›å»ºè§„åˆ™é›†åˆã€‚

å¯¹äºæ¯ä¸ªåˆ›å»ºè§„åˆ™ $r = (c, p, m) \in R$ï¼š

1. åˆ›å»ºå™¨ $c$ å®ç°äº†æ­£ç¡®çš„åˆ›å»ºé€»è¾‘
2. äº§å“ $p$ æ»¡è¶³é¢„å®šä¹‰çš„æ¥å£å’Œçº¦æŸ
3. åˆ›å»ºæ–¹æ³• $m$ éµå¾ªè®¾è®¡æ¨¡å¼çš„åŸåˆ™

å› æ­¤ï¼Œåˆ›å»ºçš„å¯¹è±¡æ»¡è¶³é¢„å®šä¹‰çš„çº¦æŸæ¡ä»¶ã€‚$\square$

### 4.2 æ¨¡å¼ç»„åˆæ€§

**å®šç† 4.2** (åˆ›å»ºå‹æ¨¡å¼ç»„åˆæ€§)
ä»»æ„ä¸¤ä¸ªåˆ›å»ºå‹æ¨¡å¼å¯ä»¥ç»„åˆå½¢æˆæ–°çš„åˆ›å»ºå‹æ¨¡å¼ã€‚

**è¯æ˜**:
è®¾ $P_1$ å’Œ $P_2$ æ˜¯ä¸¤ä¸ªåˆ›å»ºå‹æ¨¡å¼ï¼Œå…¶åˆ›å»ºå™¨åˆ†åˆ«ä¸º $C_1$ å’Œ $C_2$ã€‚

é€šè¿‡ç»„åˆæ“ä½œ $\oplus$ï¼Œå¯ä»¥æ„é€ æ–°çš„åˆ›å»ºå‹æ¨¡å¼ $P = P_1 \oplus P_2$ï¼Œå…¶ä¸­ï¼š

- åˆ›å»ºå™¨é›†åˆï¼š$C = C_1 \times C_2$
- äº§å“é›†åˆï¼š$P = P_1 \times P_2$
- åˆ›å»ºè§„åˆ™ï¼š$R = R_1 \times R_2$

ç”±äºåˆ›å»ºå‹æ¨¡å¼åŸºäºé¢å‘å¯¹è±¡åŸåˆ™ï¼Œç»„åˆæ“ä½œä¿æŒæ¨¡å¼çš„æœ‰æ•ˆæ€§ã€‚
å› æ­¤ï¼Œåˆ›å»ºå‹æ¨¡å¼å…·æœ‰ç»„åˆæ€§ã€‚$\square$

## 5. æ€§èƒ½åˆ†æ

### 5.1 åˆ›å»ºæ€§èƒ½åˆ†æ

**å®šç† 5.1** (å•ä¾‹æ¨¡å¼æ€§èƒ½)
å•ä¾‹æ¨¡å¼çš„åˆ›å»ºæ—¶é—´å¤æ‚åº¦ä¸º $O(1)$ï¼Œç©ºé—´å¤æ‚åº¦ä¸º $O(1)$ã€‚

**è¯æ˜**:
å•ä¾‹æ¨¡å¼çš„ä¸»è¦æ“ä½œï¼š

1. æ£€æŸ¥å®ä¾‹æ˜¯å¦å­˜åœ¨ï¼š$O(1)$
2. åˆ›å»ºå®ä¾‹ï¼ˆä»…ç¬¬ä¸€æ¬¡ï¼‰ï¼š$O(1)$
3. è¿”å›å®ä¾‹ï¼š$O(1)$

æ€»æ—¶é—´å¤æ‚åº¦ä¸º $O(1)$ã€‚
ç”±äºåªç»´æŠ¤ä¸€ä¸ªå®ä¾‹ï¼Œç©ºé—´å¤æ‚åº¦ä¸º $O(1)$ã€‚$\square$

**å®šç† 5.2** (å·¥å‚æ–¹æ³•æ€§èƒ½)
å·¥å‚æ–¹æ³•æ¨¡å¼çš„åˆ›å»ºæ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ï¼Œå…¶ä¸­ $n$ æ˜¯äº§å“ç±»å‹æ•°é‡ã€‚

**è¯æ˜**:
å·¥å‚æ–¹æ³•çš„ä¸»è¦æ­¥éª¤ï¼š

1. é€‰æ‹©äº§å“ç±»å‹ï¼š$O(n)$
2. åˆ›å»ºäº§å“å®ä¾‹ï¼š$O(1)$
3. è¿”å›äº§å“ï¼š$O(1)$

æ€»æ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ã€‚$\square$

### 5.2 å†…å­˜ä½¿ç”¨åˆ†æ

**å®šç† 5.3** (å¯¹è±¡æ± æ€§èƒ½)
å¯¹è±¡æ± æ¨¡å¼çš„å†…å­˜ä½¿ç”¨æ•ˆç‡ä¸º $O(k)$ï¼Œå…¶ä¸­ $k$ æ˜¯æ± å¤§å°ã€‚

**è¯æ˜**:
å¯¹è±¡æ± çš„å†…å­˜ä½¿ç”¨ï¼š

1. æ± ä¸­å¯¹è±¡ï¼š$O(k)$
2. ä½¿ç”¨ä¸­å¯¹è±¡ï¼š$O(k)$
3. ç®¡ç†å¼€é”€ï¼š$O(1)$

æ€»å†…å­˜ä½¿ç”¨ä¸º $O(k)$ã€‚$\square$

## 6. å®é™…åº”ç”¨

### 6.1 è½¯ä»¶æ¡†æ¶

åˆ›å»ºå‹æ¨¡å¼åœ¨è½¯ä»¶æ¡†æ¶ä¸­çš„åº”ç”¨ï¼š

- ä¾èµ–æ³¨å…¥å®¹å™¨
- æ’ä»¶ç³»ç»Ÿ
- é…ç½®ç®¡ç†
- æ—¥å¿—ç³»ç»Ÿ

### 6.2 ä¼ä¸šåº”ç”¨

åˆ›å»ºå‹æ¨¡å¼åœ¨ä¼ä¸šåº”ç”¨ä¸­çš„åº”ç”¨ï¼š

- æ•°æ®åº“è¿æ¥æ± 
- ç¼“å­˜ç®¡ç†å™¨
- æœåŠ¡å®šä½å™¨
- äº‹åŠ¡ç®¡ç†å™¨

### 6.3 æ¸¸æˆå¼€å‘

åˆ›å»ºå‹æ¨¡å¼åœ¨æ¸¸æˆå¼€å‘ä¸­çš„åº”ç”¨ï¼š

- æ¸¸æˆå¯¹è±¡å·¥å‚
- èµ„æºç®¡ç†å™¨
- åœºæ™¯ç®¡ç†å™¨
- éŸ³é¢‘ç®¡ç†å™¨

## 7. æ€»ç»“

åˆ›å»ºå‹æ¨¡å¼æ˜¯è½¯ä»¶è®¾è®¡ä¸­çš„é‡è¦å·¥å…·ï¼Œé€šè¿‡ä¸¥æ ¼çš„å½¢å¼åŒ–å®šä¹‰å’Œå®Œæ•´çš„Pythonå®ç°ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªå®Œæ•´çš„åˆ›å»ºå‹æ¨¡å¼ç†è®ºæ¡†æ¶ã€‚

### ä¸»è¦ç‰¹ç‚¹

1. **å½¢å¼åŒ–**: ä¸¥æ ¼çš„æ•°å­¦å®šä¹‰å’Œåˆ†ç±»ä½“ç³»
2. **ç³»ç»Ÿæ€§**: å®Œæ•´çš„æ¨¡å¼å®ç°å’Œç®¡ç†ç³»ç»Ÿ
3. **å®ç”¨æ€§**: å®Œæ•´çš„Pythonå®ç°å’Œå®é™…åº”ç”¨
4. **å¯æ‰©å±•æ€§**: æ”¯æŒæ–°æ¨¡å¼çš„æ·»åŠ å’Œç»„åˆ

### æ ¸å¿ƒè´¡çŒ®

1. **ç†è®ºæ¡†æ¶**: å»ºç«‹äº†å®Œæ•´çš„åˆ›å»ºå‹æ¨¡å¼ç†è®ºä½“ç³»
2. **å®ç°ç³»ç»Ÿ**: æä¾›äº†å®Œæ•´çš„Pythonæ¨¡å¼å·¥å…·
3. **åˆ†æå·¥å…·**: æä¾›äº†æ¨¡å¼åˆ†æå’ŒéªŒè¯åŠŸèƒ½
4. **åº”ç”¨ç¤ºä¾‹**: å±•ç¤ºäº†å®é™…é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ

è¿™ä¸ªæ¡†æ¶ä¸ºåç»­çš„ç»“æ„å‹æ¨¡å¼å’Œè¡Œä¸ºå‹æ¨¡å¼æä¾›äº†é‡è¦çš„ç†è®ºåŸºç¡€ï¼Œç¡®ä¿æ•´ä¸ªè®¾è®¡æ¨¡å¼ä½“ç³»çš„ç§‘å­¦æ€§å’Œå®ç”¨æ€§ã€‚

---

*æœ€åæ›´æ–°: 2024-12-19*
*æ–‡æ¡£çŠ¶æ€: å·²å®Œæˆ*
