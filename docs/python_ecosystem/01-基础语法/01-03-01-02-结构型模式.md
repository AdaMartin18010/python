# 03-01-02 ç»“æ„å‹æ¨¡å¼

## ğŸ“‹ æ¦‚è¿°

ç»“æ„å‹æ¨¡å¼å…³æ³¨ç±»å’Œå¯¹è±¡çš„ç»„åˆï¼Œé€šè¿‡ç»§æ‰¿å’Œç»„åˆæ¥æ„å»ºæ›´å¤æ‚çš„ç»“æ„ã€‚æœ¬æ–‡æ¡£ä»å½¢å¼åŒ–è§’åº¦é˜è¿°ç»“æ„å‹æ¨¡å¼çš„æ ¸å¿ƒæ¦‚å¿µï¼Œæä¾›ä¸¥æ ¼çš„æ•°å­¦å®šä¹‰å’Œè¯æ˜ï¼Œå¹¶é€šè¿‡Pythonä»£ç å®ç°ç›¸å…³æ¨¡å¼ã€‚

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### 1. é€‚é…å™¨æ¨¡å¼ (Adapter Pattern)

#### 1.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 1.1** (é€‚é…å™¨æ¨¡å¼)
é€‚é…å™¨æ¨¡å¼å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ã€‚å½¢å¼åŒ–å®šä¹‰ä¸ºï¼š
$$A: \text{Interface}_1 \rightarrow \text{Interface}_2$$
å…¶ä¸­ $A$ æ˜¯é€‚é…å™¨ï¼Œ$\text{Interface}_1$ æ˜¯æºæ¥å£ï¼Œ$\text{Interface}_2$ æ˜¯ç›®æ ‡æ¥å£ã€‚

**å®šä¹‰ 1.2** (æ¥å£å…¼å®¹æ€§)
é€‚é…å™¨ $A$ çš„å…¼å®¹æ€§æ¡ä»¶ï¼š
$$\forall x \in \text{Interface}_1: A(x) \in \text{Interface}_2 \land \text{Semantic}(A(x)) = \text{Semantic}(x)$$

#### 1.2 é€‚é…å™¨æ¨¡å¼å®šç†

**å®šç† 1.1** (é€‚é…å™¨æ­£ç¡®æ€§)
å¦‚æœé€‚é…å™¨ $A$ æ­£ç¡®å®ç°ï¼Œåˆ™å¯¹äºä»»æ„æºæ¥å£è°ƒç”¨ï¼Œéƒ½èƒ½æ­£ç¡®è½¬æ¢ä¸ºç›®æ ‡æ¥å£è°ƒç”¨ã€‚

**è¯æ˜**:

1. è®¾ $x$ æ˜¯æºæ¥å£çš„ä»»æ„è°ƒç”¨
2. æ ¹æ®é€‚é…å™¨å®šä¹‰ï¼Œ$A(x)$ æ˜¯ç›®æ ‡æ¥å£è°ƒç”¨
3. æ ¹æ®å…¼å®¹æ€§æ¡ä»¶ï¼Œè¯­ä¹‰ä¿æŒä¸å˜
4. å› æ­¤é€‚é…å™¨æ­£ç¡®æ€§å¾—åˆ°ä¿è¯

### 2. è£…é¥°å™¨æ¨¡å¼ (Decorator Pattern)

#### 2.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 2.1** (è£…é¥°å™¨æ¨¡å¼)
è£…é¥°å™¨æ¨¡å¼åŠ¨æ€åœ°ç»™å¯¹è±¡æ·»åŠ é¢å¤–çš„èŒè´£ã€‚å½¢å¼åŒ–å®šä¹‰ä¸ºï¼š
$$D: \text{Component} \rightarrow \text{Component}$$
å…¶ä¸­ $D$ æ˜¯è£…é¥°å™¨ï¼Œ$\text{Component}$ æ˜¯ç»„ä»¶é›†åˆã€‚

**å®šä¹‰ 2.2** (è£…é¥°å™¨ç»„åˆ)
è£…é¥°å™¨çš„ç»„åˆæ€§è´¨ï¼š
$$\forall D_1, D_2 \in \text{Decorator}: D_1 \circ D_2 \in \text{Decorator}$$

#### 2.2 è£…é¥°å™¨æ¨¡å¼å®šç†

**å®šç† 2.1** (è£…é¥°å™¨ç»„åˆæ€§)
å¦‚æœ $D_1$ å’Œ $D_2$ éƒ½æ˜¯è£…é¥°å™¨ï¼Œåˆ™ $D_1 \circ D_2$ ä¹Ÿæ˜¯è£…é¥°å™¨ã€‚

**è¯æ˜**:

1. è®¾ $D_1$ å’Œ $D_2$ éƒ½æ˜¯è£…é¥°å™¨
2. æ ¹æ®è£…é¥°å™¨å®šä¹‰ï¼Œå®ƒä»¬éƒ½ä»ç»„ä»¶æ˜ å°„åˆ°ç»„ä»¶
3. ç»„åˆ $D_1 \circ D_2$ ä»ç„¶ä»ç»„ä»¶æ˜ å°„åˆ°ç»„ä»¶
4. å› æ­¤ $D_1 \circ D_2$ æ˜¯è£…é¥°å™¨

### 3. ä»£ç†æ¨¡å¼ (Proxy Pattern)

#### 3.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 3.1** (ä»£ç†æ¨¡å¼)
ä»£ç†æ¨¡å¼ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚å½¢å¼åŒ–å®šä¹‰ä¸ºï¼š
$$P: \text{Subject} \rightarrow \text{Subject}$$
å…¶ä¸­ $P$ æ˜¯ä»£ç†ï¼Œ$\text{Subject}$ æ˜¯ä¸»ä½“å¯¹è±¡é›†åˆã€‚

**å®šä¹‰ 3.2** (ä»£ç†æ§åˆ¶)
ä»£ç†çš„æ§åˆ¶æ¡ä»¶ï¼š
$$\forall x \in \text{Subject}: P(x) \subseteq x \land \text{Access}(P(x)) \subseteq \text{Access}(x)$$

#### 3.2 ä»£ç†æ¨¡å¼å®šç†

**å®šç† 3.1** (ä»£ç†å®‰å…¨æ€§)
å¦‚æœä»£ç† $P$ æ­£ç¡®å®ç°ï¼Œåˆ™é€šè¿‡ä»£ç†çš„è®¿é—®æ˜¯å®‰å…¨çš„ã€‚

**è¯æ˜**:

1. è®¾ $x$ æ˜¯ä»»æ„ä¸»ä½“å¯¹è±¡
2. æ ¹æ®ä»£ç†å®šä¹‰ï¼Œ$P(x)$ æ˜¯å—æ§çš„è®¿é—®
3. æ ¹æ®æ§åˆ¶æ¡ä»¶ï¼Œè®¿é—®æƒé™è¢«é™åˆ¶
4. å› æ­¤ä»£ç†è®¿é—®æ˜¯å®‰å…¨çš„

### 4. å¤–è§‚æ¨¡å¼ (Facade Pattern)

#### 4.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 4.1** (å¤–è§‚æ¨¡å¼)
å¤–è§‚æ¨¡å¼ä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ã€‚å½¢å¼åŒ–å®šä¹‰ä¸ºï¼š
$$F: \text{Subsystem}^n \rightarrow \text{Interface}$$
å…¶ä¸­ $F$ æ˜¯å¤–è§‚ï¼Œ$\text{Subsystem}^n$ æ˜¯nä¸ªå­ç³»ç»Ÿçš„ç»„åˆï¼Œ$\text{Interface}$ æ˜¯ç»Ÿä¸€æ¥å£ã€‚

**å®šä¹‰ 4.2** (å¤–è§‚ç®€åŒ–)
å¤–è§‚çš„ç®€åŒ–æ€§è´¨ï¼š
$$\forall s_1, s_2, \ldots, s_n \in \text{Subsystem}: \text{Complexity}(F(s_1, s_2, \ldots, s_n)) \leq \sum_{i=1}^n \text{Complexity}(s_i)$$

#### 4.2 å¤–è§‚æ¨¡å¼å®šç†

**å®šç† 4.1** (å¤–è§‚ç®€åŒ–æ€§)
å¦‚æœå¤–è§‚ $F$ æ­£ç¡®å®ç°ï¼Œåˆ™é€šè¿‡å¤–è§‚çš„æ¥å£æ¯”ç›´æ¥ä½¿ç”¨å­ç³»ç»Ÿæ›´ç®€å•ã€‚

**è¯æ˜**:

1. è®¾ $s_1, s_2, \ldots, s_n$ æ˜¯ä»»æ„å­ç³»ç»Ÿ
2. æ ¹æ®å¤–è§‚å®šä¹‰ï¼Œ$F(s_1, s_2, \ldots, s_n)$ æä¾›ç»Ÿä¸€æ¥å£
3. æ ¹æ®ç®€åŒ–æ€§è´¨ï¼Œå¤æ‚åº¦è¢«é™ä½
4. å› æ­¤å¤–è§‚ç®€åŒ–æ€§å¾—åˆ°ä¿è¯

### 5. æ¡¥æ¥æ¨¡å¼ (Bridge Pattern)

#### 5.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 5.1** (æ¡¥æ¥æ¨¡å¼)
æ¡¥æ¥æ¨¡å¼å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ç°éƒ¨åˆ†åˆ†ç¦»ã€‚å½¢å¼åŒ–å®šä¹‰ä¸ºï¼š
$$B: \text{Abstraction} \times \text{Implementation} \rightarrow \text{System}$$
å…¶ä¸­ $B$ æ˜¯æ¡¥æ¥ï¼Œ$\text{Abstraction}$ æ˜¯æŠ½è±¡é›†åˆï¼Œ$\text{Implementation}$ æ˜¯å®ç°é›†åˆã€‚

**å®šä¹‰ 5.2** (æ¡¥æ¥ç‹¬ç«‹æ€§)
æ¡¥æ¥çš„ç‹¬ç«‹æ€§æ¡ä»¶ï¼š
$$\forall a \in \text{Abstraction}, i \in \text{Implementation}: \text{Independent}(a, i)$$

#### 5.2 æ¡¥æ¥æ¨¡å¼å®šç†

**å®šç† 5.1** (æ¡¥æ¥ç‹¬ç«‹æ€§)
å¦‚æœæ¡¥æ¥ $B$ æ­£ç¡®å®ç°ï¼Œåˆ™æŠ½è±¡å’Œå®ç°å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚

**è¯æ˜**:

1. è®¾ $a$ å’Œ $i$ åˆ†åˆ«æ˜¯æŠ½è±¡å’Œå®ç°
2. æ ¹æ®æ¡¥æ¥å®šä¹‰ï¼Œ$B(a, i)$ ç»„åˆæŠ½è±¡å’Œå®ç°
3. æ ¹æ®ç‹¬ç«‹æ€§æ¡ä»¶ï¼Œ$a$ å’Œ $i$ å¯ä»¥ç‹¬ç«‹å˜åŒ–
4. å› æ­¤æ¡¥æ¥ç‹¬ç«‹æ€§å¾—åˆ°ä¿è¯

## ğŸ Pythonå®ç°

### 1. é€‚é…å™¨æ¨¡å¼å®ç°

```python
from abc import ABC, abstractmethod
from typing import Any, Dict, List, Protocol
from dataclasses import dataclass

# ç›®æ ‡æ¥å£
class Target(Protocol):
    """ç›®æ ‡æ¥å£"""
    
    def request(self) -> str:
        """è¯·æ±‚æ–¹æ³•"""
        ...

# æºæ¥å£
class Adaptee:
    """æºæ¥å£ï¼ˆéœ€è¦é€‚é…çš„ç±»ï¼‰"""
    
    def specific_request(self) -> str:
        """ç‰¹å®šçš„è¯·æ±‚æ–¹æ³•"""
        return "æºæ¥å£çš„ç‰¹å®šè¯·æ±‚"

class Adapter:
    """é€‚é…å™¨ç±»"""
    
    def __init__(self, adaptee: Adaptee):
        self.adaptee = adaptee
    
    def request(self) -> str:
        """é€‚é…åçš„è¯·æ±‚æ–¹æ³•"""
        result = self.adaptee.specific_request()
        return f"é€‚é…å™¨è½¬æ¢: {result}"

class Client:
    """å®¢æˆ·ç«¯ç±»"""
    
    def __init__(self, target: Target):
        self.target = target
    
    def execute_request(self) -> str:
        """æ‰§è¡Œè¯·æ±‚"""
        return self.target.request()

# å¯¹è±¡é€‚é…å™¨æ¨¡å¼
class ObjectAdapter:
    """å¯¹è±¡é€‚é…å™¨"""
    
    def __init__(self, adaptee: Adaptee):
        self._adaptee = adaptee
    
    def request(self) -> str:
        """é€‚é…è¯·æ±‚"""
        return self._adaptee.specific_request().upper()

# ç±»é€‚é…å™¨æ¨¡å¼
class ClassAdapter(Adaptee):
    """ç±»é€‚é…å™¨ï¼ˆé€šè¿‡ç»§æ‰¿ï¼‰"""
    
    def request(self) -> str:
        """é€‚é…è¯·æ±‚"""
        return self.specific_request().lower()

# ä½¿ç”¨ç¤ºä¾‹
def demonstrate_adapter_pattern():
    """æ¼”ç¤ºé€‚é…å™¨æ¨¡å¼"""
    
    # 1. å¯¹è±¡é€‚é…å™¨
    adaptee = Adaptee()
    adapter = Adapter(adaptee)
    client = Client(adapter)
    
    result1 = client.execute_request()
    print(f"å¯¹è±¡é€‚é…å™¨ç»“æœ: {result1}")
    
    # 2. ç±»é€‚é…å™¨
    class_adapter = ClassAdapter()
    client2 = Client(class_adapter)
    
    result2 = client2.execute_request()
    print(f"ç±»é€‚é…å™¨ç»“æœ: {result2}")
    
    # 3. å¯¹è±¡é€‚é…å™¨å˜ä½“
    object_adapter = ObjectAdapter(adaptee)
    client3 = Client(object_adapter)
    
    result3 = client3.execute_request()
    print(f"å¯¹è±¡é€‚é…å™¨å˜ä½“ç»“æœ: {result3}")
    
    return adapter, class_adapter, object_adapter
```

### 2. è£…é¥°å™¨æ¨¡å¼å®ç°

```python
from abc import ABC, abstractmethod
from typing import Any, Callable, Dict, List
from functools import wraps
import time

class Component(ABC):
    """ç»„ä»¶æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def operation(self) -> str:
        """æ“ä½œ"""
        pass

class ConcreteComponent(Component):
    """å…·ä½“ç»„ä»¶"""
    
    def operation(self) -> str:
        return "å…·ä½“ç»„ä»¶çš„æ“ä½œ"

class Decorator(Component):
    """è£…é¥°å™¨æŠ½è±¡åŸºç±»"""
    
    def __init__(self, component: Component):
        self._component = component
    
    def operation(self) -> str:
        return self._component.operation()

class ConcreteDecoratorA(Decorator):
    """å…·ä½“è£…é¥°å™¨A"""
    
    def operation(self) -> str:
        return f"è£…é¥°å™¨A({super().operation()})"

class ConcreteDecoratorB(Decorator):
    """å…·ä½“è£…é¥°å™¨B"""
    
    def operation(self) -> str:
        return f"è£…é¥°å™¨B({super().operation()})"

# å‡½æ•°è£…é¥°å™¨
def timer_decorator(func: Callable) -> Callable:
    """è®¡æ—¶è£…é¥°å™¨"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        start_time = time.time()
        result = func(*args, **kwargs)
        end_time = time.time()
        print(f"å‡½æ•° {func.__name__} æ‰§è¡Œæ—¶é—´: {end_time - start_time:.4f} ç§’")
        return result
    return wrapper

def log_decorator(func: Callable) -> Callable:
    """æ—¥å¿—è£…é¥°å™¨"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        print(f"è°ƒç”¨å‡½æ•°: {func.__name__}")
        result = func(*args, **kwargs)
        print(f"å‡½æ•° {func.__name__} æ‰§è¡Œå®Œæˆ")
        return result
    return wrapper

# ä½¿ç”¨è£…é¥°å™¨çš„å‡½æ•°
@timer_decorator
@log_decorator
def expensive_operation(n: int) -> int:
    """æ˜‚è´µçš„æ“ä½œ"""
    result = 0
    for i in range(n):
        result += i
    return result

# ç±»è£…é¥°å™¨
class CachedDecorator:
    """ç¼“å­˜è£…é¥°å™¨"""
    
    def __init__(self, func: Callable):
        self.func = func
        self.cache: Dict = {}
    
    def __call__(self, *args, **kwargs):
        key = str(args) + str(kwargs)
        if key not in self.cache:
            self.cache[key] = self.func(*args, **kwargs)
        return self.cache[key]

@CachedDecorator
def fibonacci(n: int) -> int:
    """æ–æ³¢é‚£å¥‘æ•°åˆ—"""
    if n <= 1:
        return n
    return fibonacci(n - 1) + fibonacci(n - 2)

# ä½¿ç”¨ç¤ºä¾‹
def demonstrate_decorator_pattern():
    """æ¼”ç¤ºè£…é¥°å™¨æ¨¡å¼"""
    
    # 1. ç±»è£…é¥°å™¨
    component = ConcreteComponent()
    decorated_a = ConcreteDecoratorA(component)
    decorated_b = ConcreteDecoratorB(decorated_a)
    
    print(f"åŸå§‹ç»„ä»¶: {component.operation()}")
    print(f"è£…é¥°å™¨A: {decorated_a.operation()}")
    print(f"è£…é¥°å™¨B: {decorated_b.operation()}")
    
    # 2. å‡½æ•°è£…é¥°å™¨
    result = expensive_operation(1000000)
    print(f"æ˜‚è´µæ“ä½œç»“æœ: {result}")
    
    # 3. ç¼“å­˜è£…é¥°å™¨
    fib_result1 = fibonacci(10)
    fib_result2 = fibonacci(10)  # ä»ç¼“å­˜è·å–
    print(f"æ–æ³¢é‚£å¥‘(10): {fib_result1}")
    print(f"æ–æ³¢é‚£å¥‘(10) ç¼“å­˜: {fib_result2}")
    
    return decorated_b, expensive_operation, fibonacci
```

### 3. ä»£ç†æ¨¡å¼å®ç°

```python
from abc import ABC, abstractmethod
from typing import Any, Dict, List, Optional
import time

class Subject(ABC):
    """ä¸»ä½“æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def request(self) -> str:
        """è¯·æ±‚æ–¹æ³•"""
        pass

class RealSubject(Subject):
    """çœŸå®ä¸»ä½“"""
    
    def request(self) -> str:
        return "çœŸå®ä¸»ä½“çš„å“åº”"

class Proxy(Subject):
    """ä»£ç†ç±»"""
    
    def __init__(self, real_subject: RealSubject):
        self._real_subject = real_subject
        self._access_count = 0
        self._last_access_time: Optional[float] = None
    
    def request(self) -> str:
        # è®¿é—®æ§åˆ¶
        if not self._check_access():
            return "è®¿é—®è¢«æ‹’ç»"
        
        # è®°å½•è®¿é—®
        self._log_access()
        
        # è½¬å‘è¯·æ±‚
        return self._real_subject.request()
    
    def _check_access(self) -> bool:
        """æ£€æŸ¥è®¿é—®æƒé™"""
        # ç®€å•çš„è®¿é—®æ§åˆ¶ï¼šé™åˆ¶è®¿é—®æ¬¡æ•°
        return self._access_count < 5
    
    def _log_access(self) -> None:
        """è®°å½•è®¿é—®"""
        self._access_count += 1
        self._last_access_time = time.time()

class VirtualProxy(Subject):
    """è™šæ‹Ÿä»£ç†ï¼ˆå»¶è¿ŸåŠ è½½ï¼‰"""
    
    def __init__(self):
        self._real_subject: Optional[RealSubject] = None
    
    def request(self) -> str:
        if self._real_subject is None:
            print("åˆ›å»ºçœŸå®ä¸»ä½“...")
            self._real_subject = RealSubject()
        return self._real_subject.request()

class ProtectionProxy(Subject):
    """ä¿æŠ¤ä»£ç†"""
    
    def __init__(self, real_subject: RealSubject, user_role: str):
        self._real_subject = real_subject
        self._user_role = user_role
    
    def request(self) -> str:
        if self._user_role == "admin":
            return self._real_subject.request()
        else:
            return "æƒé™ä¸è¶³ï¼Œæ— æ³•è®¿é—®"

class CachingProxy(Subject):
    """ç¼“å­˜ä»£ç†"""
    
    def __init__(self, real_subject: RealSubject):
        self._real_subject = real_subject
        self._cache: Optional[str] = None
        self._cache_time: Optional[float] = None
        self._cache_duration = 5.0  # 5ç§’ç¼“å­˜
    
    def request(self) -> str:
        current_time = time.time()
        
        # æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
        if (self._cache is not None and 
            self._cache_time is not None and 
            current_time - self._cache_time < self._cache_duration):
            return f"ç¼“å­˜ç»“æœ: {self._cache}"
        
        # è·å–æ–°ç»“æœå¹¶ç¼“å­˜
        result = self._real_subject.request()
        self._cache = result
        self._cache_time = current_time
        
        return result

# ä½¿ç”¨ç¤ºä¾‹
def demonstrate_proxy_pattern():
    """æ¼”ç¤ºä»£ç†æ¨¡å¼"""
    
    real_subject = RealSubject()
    
    # 1. æ™®é€šä»£ç†
    proxy = Proxy(real_subject)
    for i in range(6):
        result = proxy.request()
        print(f"ä»£ç†è¯·æ±‚ {i+1}: {result}")
    
    # 2. è™šæ‹Ÿä»£ç†
    virtual_proxy = VirtualProxy()
    result = virtual_proxy.request()
    print(f"è™šæ‹Ÿä»£ç†: {result}")
    
    # 3. ä¿æŠ¤ä»£ç†
    admin_proxy = ProtectionProxy(real_subject, "admin")
    user_proxy = ProtectionProxy(real_subject, "user")
    
    print(f"ç®¡ç†å‘˜è®¿é—®: {admin_proxy.request()}")
    print(f"æ™®é€šç”¨æˆ·è®¿é—®: {user_proxy.request()}")
    
    # 4. ç¼“å­˜ä»£ç†
    caching_proxy = CachingProxy(real_subject)
    
    # ç¬¬ä¸€æ¬¡è¯·æ±‚
    result1 = caching_proxy.request()
    print(f"ç¼“å­˜ä»£ç†ç¬¬ä¸€æ¬¡: {result1}")
    
    # ç¬¬äºŒæ¬¡è¯·æ±‚ï¼ˆä»ç¼“å­˜è·å–ï¼‰
    result2 = caching_proxy.request()
    print(f"ç¼“å­˜ä»£ç†ç¬¬äºŒæ¬¡: {result2}")
    
    return proxy, virtual_proxy, admin_proxy, caching_proxy
```

### 4. å¤–è§‚æ¨¡å¼å®ç°

```python
from abc import ABC, abstractmethod
from typing import Any, Dict, List
from dataclasses import dataclass

# å­ç³»ç»Ÿç±»
class SubsystemA:
    """å­ç³»ç»ŸA"""
    
    def operation_a1(self) -> str:
        return "å­ç³»ç»ŸAæ“ä½œ1"
    
    def operation_a2(self) -> str:
        return "å­ç³»ç»ŸAæ“ä½œ2"

class SubsystemB:
    """å­ç³»ç»ŸB"""
    
    def operation_b1(self) -> str:
        return "å­ç³»ç»ŸBæ“ä½œ1"
    
    def operation_b2(self) -> str:
        return "å­ç³»ç»ŸBæ“ä½œ2"

class SubsystemC:
    """å­ç³»ç»ŸC"""
    
    def operation_c1(self) -> str:
        return "å­ç³»ç»ŸCæ“ä½œ1"
    
    def operation_c2(self) -> str:
        return "å­ç³»ç»ŸCæ“ä½œ2"

class Facade:
    """å¤–è§‚ç±»"""
    
    def __init__(self):
        self._subsystem_a = SubsystemA()
        self._subsystem_b = SubsystemB()
        self._subsystem_c = SubsystemC()
    
    def operation1(self) -> str:
        """æ“ä½œ1ï¼šä½¿ç”¨å­ç³»ç»ŸAå’ŒB"""
        result_a = self._subsystem_a.operation_a1()
        result_b = self._subsystem_b.operation_b1()
        return f"å¤–è§‚æ“ä½œ1: {result_a} + {result_b}"
    
    def operation2(self) -> str:
        """æ“ä½œ2ï¼šä½¿ç”¨å­ç³»ç»ŸBå’ŒC"""
        result_b = self._subsystem_b.operation_b2()
        result_c = self._subsystem_c.operation_c1()
        return f"å¤–è§‚æ“ä½œ2: {result_b} + {result_c}"
    
    def operation3(self) -> str:
        """æ“ä½œ3ï¼šä½¿ç”¨æ‰€æœ‰å­ç³»ç»Ÿ"""
        result_a = self._subsystem_a.operation_a2()
        result_b = self._subsystem_b.operation_b1()
        result_c = self._subsystem_c.operation_c2()
        return f"å¤–è§‚æ“ä½œ3: {result_a} + {result_b} + {result_c}"

class Client:
    """å®¢æˆ·ç«¯ç±»"""
    
    def __init__(self, facade: Facade):
        self.facade = facade
    
    def use_subsystem(self) -> List[str]:
        """ä½¿ç”¨å­ç³»ç»Ÿ"""
        results = []
        results.append(self.facade.operation1())
        results.append(self.facade.operation2())
        results.append(self.facade.operation3())
        return results

# ä½¿ç”¨ç¤ºä¾‹
def demonstrate_facade_pattern():
    """æ¼”ç¤ºå¤–è§‚æ¨¡å¼"""
    
    facade = Facade()
    client = Client(facade)
    
    results = client.use_subsystem()
    
    print("å¤–è§‚æ¨¡å¼æ¼”ç¤º:")
    for i, result in enumerate(results, 1):
        print(f"æ“ä½œ{i}: {result}")
    
    return facade, client
```

### 5. æ¡¥æ¥æ¨¡å¼å®ç°

```python
from abc import ABC, abstractmethod
from typing import Any, Dict, List
from enum import Enum

class Color(Enum):
    """é¢œè‰²æšä¸¾"""
    RED = "çº¢è‰²"
    GREEN = "ç»¿è‰²"
    BLUE = "è“è‰²"

class Shape(ABC):
    """å½¢çŠ¶æŠ½è±¡ç±»"""
    
    def __init__(self, color: Color):
        self.color = color
    
    @abstractmethod
    def draw(self) -> str:
        """ç»˜åˆ¶æ–¹æ³•"""
        pass

class Circle(Shape):
    """åœ†å½¢"""
    
    def draw(self) -> str:
        return f"ç»˜åˆ¶{self.color.value}åœ†å½¢"

class Rectangle(Shape):
    """çŸ©å½¢"""
    
    def draw(self) -> str:
        return f"ç»˜åˆ¶{self.color.value}çŸ©å½¢"

class Triangle(Shape):
    """ä¸‰è§’å½¢"""
    
    def draw(self) -> str:
        return f"ç»˜åˆ¶{self.color.value}ä¸‰è§’å½¢"

class DrawingAPI(ABC):
    """ç»˜å›¾APIæŠ½è±¡ç±»"""
    
    @abstractmethod
    def draw_circle(self, x: int, y: int, radius: int) -> str:
        """ç»˜åˆ¶åœ†å½¢"""
        pass
    
    @abstractmethod
    def draw_rectangle(self, x: int, y: int, width: int, height: int) -> str:
        """ç»˜åˆ¶çŸ©å½¢"""
        pass

class DrawingAPI1(DrawingAPI):
    """ç»˜å›¾APIå®ç°1"""
    
    def draw_circle(self, x: int, y: int, radius: int) -> str:
        return f"API1ç»˜åˆ¶åœ†å½¢: ä¸­å¿ƒ({x},{y}), åŠå¾„{radius}"
    
    def draw_rectangle(self, x: int, y: int, width: int, height: int) -> str:
        return f"API1ç»˜åˆ¶çŸ©å½¢: å·¦ä¸Šè§’({x},{y}), å°ºå¯¸{width}x{height}"

class DrawingAPI2(DrawingAPI):
    """ç»˜å›¾APIå®ç°2"""
    
    def draw_circle(self, x: int, y: int, radius: int) -> str:
        return f"API2ç»˜åˆ¶åœ†å½¢: ä½ç½®({x},{y}), å¤§å°{radius}"
    
    def draw_rectangle(self, x: int, y: int, width: int, height: int) -> str:
        return f"API2ç»˜åˆ¶çŸ©å½¢: ä½ç½®({x},{y}), å¤§å°{width}x{height}"

class ShapeBridge(ABC):
    """å½¢çŠ¶æ¡¥æ¥æŠ½è±¡ç±»"""
    
    def __init__(self, drawing_api: DrawingAPI):
        self.drawing_api = drawing_api
    
    @abstractmethod
    def draw(self) -> str:
        """ç»˜åˆ¶æ–¹æ³•"""
        pass

class CircleBridge(ShapeBridge):
    """åœ†å½¢æ¡¥æ¥"""
    
    def __init__(self, x: int, y: int, radius: int, drawing_api: DrawingAPI):
        super().__init__(drawing_api)
        self.x = x
        self.y = y
        self.radius = radius
    
    def draw(self) -> str:
        return self.drawing_api.draw_circle(self.x, self.y, self.radius)

class RectangleBridge(ShapeBridge):
    """çŸ©å½¢æ¡¥æ¥"""
    
    def __init__(self, x: int, y: int, width: int, height: int, drawing_api: DrawingAPI):
        super().__init__(drawing_api)
        self.x = x
        self.y = y
        self.width = width
        self.height = height
    
    def draw(self) -> str:
        return self.drawing_api.draw_rectangle(self.x, self.y, self.width, self.height)

# ä½¿ç”¨ç¤ºä¾‹
def demonstrate_bridge_pattern():
    """æ¼”ç¤ºæ¡¥æ¥æ¨¡å¼"""
    
    # åˆ›å»ºç»˜å›¾API
    api1 = DrawingAPI1()
    api2 = DrawingAPI2()
    
    # åˆ›å»ºå½¢çŠ¶ï¼ˆä¼ ç»Ÿæ–¹å¼ï¼‰
    red_circle = Circle(Color.RED)
    blue_rectangle = Rectangle(Color.BLUE)
    
    print("ä¼ ç»Ÿæ–¹å¼:")
    print(f"  {red_circle.draw()}")
    print(f"  {blue_rectangle.draw()}")
    
    # åˆ›å»ºæ¡¥æ¥å½¢çŠ¶
    circle_bridge1 = CircleBridge(10, 20, 5, api1)
    circle_bridge2 = CircleBridge(30, 40, 8, api2)
    rect_bridge1 = RectangleBridge(50, 60, 20, 15, api1)
    rect_bridge2 = RectangleBridge(80, 90, 25, 18, api2)
    
    print("\næ¡¥æ¥æ¨¡å¼:")
    print(f"  {circle_bridge1.draw()}")
    print(f"  {circle_bridge2.draw()}")
    print(f"  {rect_bridge1.draw()}")
    print(f"  {rect_bridge2.draw()}")
    
    return red_circle, circle_bridge1, rect_bridge1
```

## ğŸ“Š æ•°å­¦è¯æ˜

### 1. ç»“æ„å‹æ¨¡å¼ç»„åˆå®šç†

**å®šç† 1.1** (ç»“æ„å‹æ¨¡å¼ç»„åˆ)
å¦‚æœæ¨¡å¼ $P_1$ å’Œ $P_2$ éƒ½æ˜¯ç»“æ„å‹æ¨¡å¼ï¼Œåˆ™å®ƒä»¬çš„ç»„åˆ $P_1 \circ P_2$ ä¹Ÿæ˜¯ç»“æ„å‹æ¨¡å¼ã€‚

**è¯æ˜**:

1. è®¾ $P_1$ å’Œ $P_2$ éƒ½æ˜¯ç»“æ„å‹æ¨¡å¼
2. æ ¹æ®ç»“æ„å‹æ¨¡å¼å®šä¹‰ï¼Œå®ƒä»¬éƒ½ä¸“æ³¨äºç±»å’Œå¯¹è±¡çš„ç»„åˆ
3. ç»„åˆ $P_1 \circ P_2$ ä»ç„¶ä¸“æ³¨äºç»“æ„ç»„ç»‡
4. å› æ­¤ $P_1 \circ P_2$ æ˜¯ç»“æ„å‹æ¨¡å¼

### 2. é€‚é…å™¨æ¨¡å¼æ­£ç¡®æ€§å®šç†

**å®šç† 1.2** (é€‚é…å™¨æ­£ç¡®æ€§)
å¦‚æœé€‚é…å™¨ $A$ æ­£ç¡®å®ç°ï¼Œåˆ™å¯¹äºä»»æ„æºæ¥å£è°ƒç”¨ $x$ï¼Œ$A(x)$ æ˜¯ç­‰ä»·çš„ç›®æ ‡æ¥å£è°ƒç”¨ã€‚

**è¯æ˜**:

1. è®¾ $x$ æ˜¯æºæ¥å£çš„ä»»æ„è°ƒç”¨
2. æ ¹æ®é€‚é…å™¨å®šä¹‰ï¼Œ$A(x)$ æ˜¯ç›®æ ‡æ¥å£è°ƒç”¨
3. æ ¹æ®å…¼å®¹æ€§æ¡ä»¶ï¼Œè¯­ä¹‰ä¿æŒä¸å˜
4. å› æ­¤ $A(x)$ ä¸ $x$ ç­‰ä»·

### 3. è£…é¥°å™¨æ¨¡å¼ç»„åˆæ€§å®šç†

**å®šç† 1.3** (è£…é¥°å™¨ç»„åˆæ€§)
å¦‚æœ $D_1$ å’Œ $D_2$ éƒ½æ˜¯è£…é¥°å™¨ï¼Œåˆ™ $D_1 \circ D_2$ ä¹Ÿæ˜¯è£…é¥°å™¨ã€‚

**è¯æ˜**:

1. è®¾ $D_1$ å’Œ $D_2$ éƒ½æ˜¯è£…é¥°å™¨
2. æ ¹æ®è£…é¥°å™¨å®šä¹‰ï¼Œå®ƒä»¬éƒ½ä»ç»„ä»¶æ˜ å°„åˆ°ç»„ä»¶
3. ç»„åˆ $D_1 \circ D_2$ ä»ç„¶ä»ç»„ä»¶æ˜ å°„åˆ°ç»„ä»¶
4. å› æ­¤ $D_1 \circ D_2$ æ˜¯è£…é¥°å™¨

### 4. ä»£ç†æ¨¡å¼å®‰å…¨æ€§å®šç†

**å®šç† 1.4** (ä»£ç†å®‰å…¨æ€§)
å¦‚æœä»£ç† $P$ æ­£ç¡®å®ç°ï¼Œåˆ™é€šè¿‡ä»£ç†çš„è®¿é—®æ˜¯å®‰å…¨çš„ã€‚

**è¯æ˜**:

1. è®¾ $x$ æ˜¯ä»»æ„ä¸»ä½“å¯¹è±¡
2. æ ¹æ®ä»£ç†å®šä¹‰ï¼Œ$P(x)$ æ˜¯å—æ§çš„è®¿é—®
3. æ ¹æ®æ§åˆ¶æ¡ä»¶ï¼Œè®¿é—®æƒé™è¢«é™åˆ¶
4. å› æ­¤ä»£ç†è®¿é—®æ˜¯å®‰å…¨çš„

## ğŸ”— ç›¸å…³æ¦‚å¿µ

- [åˆ›å»ºå‹æ¨¡å¼](./03-01-01-åˆ›å»ºå‹æ¨¡å¼.md)
- [è¡Œä¸ºå‹æ¨¡å¼](./03-01-03-è¡Œä¸ºå‹æ¨¡å¼.md)
- [è®¾è®¡æ¨¡å¼ç†è®º](../03-01-è®¾è®¡æ¨¡å¼/README.md)
- [è½¯ä»¶æ¶æ„ç†è®º](../03-02-è½¯ä»¶æ¶æ„/README.md)

## ğŸ“š å‚è€ƒæ–‡çŒ®

1. Gamma, E., Helm, R., Johnson, R., & Vlissides, J. (1994). Design Patterns: Elements of Reusable Object-Oriented Software
2. Freeman, E., Robson, E., Sierra, K., & Bates, B. (2004). Head First Design Patterns
3. Larman, C. (2004). Applying UML and Patterns: An Introduction to Object-Oriented Analysis and Design and Iterative Development
4. Martin, R. C. (2000). Design Principles and Design Patterns

---

*ç»“æ„å‹æ¨¡å¼ä¸ºè½¯ä»¶è®¾è®¡æä¾›äº†çµæ´»çš„ç»“æ„ç»„ç»‡æœºåˆ¶ï¼Œé€šè¿‡å½¢å¼åŒ–çš„æ•°å­¦å®šä¹‰å’Œä¸¥æ ¼çš„è¯æ˜ï¼Œæˆ‘ä»¬å»ºç«‹äº†ç»“æ„å‹æ¨¡å¼çš„å®Œæ•´ç†è®ºä½“ç³»ã€‚*
