# 03-01-è®¾è®¡æ¨¡å¼ç§‘å­¦

## ğŸ“‹ æ¦‚è¿°

è®¾è®¡æ¨¡å¼ç§‘å­¦æ˜¯ç ”ç©¶è½¯ä»¶è®¾è®¡ä¸­é‡å¤å‡ºç°çš„é—®é¢˜åŠå…¶è§£å†³æ–¹æ¡ˆçš„å­¦ç§‘ã€‚å®ƒæä¾›äº†ä¸€å¥—æ ‡å‡†åŒ–çš„è®¾è®¡è¯­è¨€ï¼Œå¸®åŠ©å¼€å‘è€…åˆ›å»ºå¯ç»´æŠ¤ã€å¯æ‰©å±•å’Œå¯é‡ç”¨çš„è½¯ä»¶ç³»ç»Ÿã€‚

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### 1. è®¾è®¡æ¨¡å¼åˆ†ç±»ä½“ç³»

**æ¦‚å¿µå®šä¹‰**: è®¾è®¡æ¨¡å¼æŒ‰ç…§å…¶ç›®çš„å’ŒèŒƒå›´è¿›è¡Œåˆ†ç±»ï¼Œå½¢æˆå®Œæ•´çš„åˆ†ç±»ä½“ç³»ã€‚

**æ•°å­¦å½¢å¼**:
è®¾è®¡æ¨¡å¼åˆ†ç±»å¯ä»¥å½¢å¼åŒ–ä¸ºï¼š

$$Patterns = \{Creational, Structural, Behavioral\}$$

å…¶ä¸­æ¯ä¸ªç±»åˆ«åŒ…å«ï¼š

- **åˆ›å»ºå‹æ¨¡å¼**: $Creational = \{Singleton, Factory, Builder, ...\}$
- **ç»“æ„å‹æ¨¡å¼**: $Structural = \{Adapter, Bridge, Composite, ...\}$
- **è¡Œä¸ºå‹æ¨¡å¼**: $Behavioral = \{Observer, Strategy, Command, ...\}$

**Pythonå®ç°**:

```python
from typing import Dict, List, Set, Any, Type, Optional
from abc import ABC, abstractmethod
from dataclasses import dataclass
from enum import Enum
import threading
import copy

class PatternCategory(Enum):
    """è®¾è®¡æ¨¡å¼åˆ†ç±»"""
    CREATIONAL = "åˆ›å»ºå‹"
    STRUCTURAL = "ç»“æ„å‹"
    BEHAVIORAL = "è¡Œä¸ºå‹"

class PatternScope(Enum):
    """æ¨¡å¼ä½œç”¨åŸŸ"""
    CLASS = "ç±»"
    OBJECT = "å¯¹è±¡"

@dataclass
class PatternDefinition:
    """æ¨¡å¼å®šä¹‰"""
    name: str
    category: PatternCategory
    scope: PatternScope
    intent: str
    problem: str
    solution: str
    consequences: List[str]
    participants: List[str]
    collaborations: List[str]

class DesignPatternCatalog:
    """è®¾è®¡æ¨¡å¼ç›®å½•"""
    
    def __init__(self):
        self.patterns: Dict[str, PatternDefinition] = {}
        self._initialize_patterns()
    
    def _initialize_patterns(self):
        """åˆå§‹åŒ–æ¨¡å¼å®šä¹‰"""
        # åˆ›å»ºå‹æ¨¡å¼
        self.patterns["Singleton"] = PatternDefinition(
            name="Singleton",
            category=PatternCategory.CREATIONAL,
            scope=PatternScope.OBJECT,
            intent="ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹",
            problem="å¦‚ä½•ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Ÿ",
            solution="ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°å’Œé™æ€å®ä¾‹",
            consequences=["æ§åˆ¶å®ä¾‹æ•°é‡", "å…¨å±€è®¿é—®ç‚¹", "çº¿ç¨‹å®‰å…¨è€ƒè™‘"],
            participants=["Singletonç±»"],
            collaborations=["å®¢æˆ·ç«¯é€šè¿‡getInstance()è®¿é—®å”¯ä¸€å®ä¾‹"]
        )
        
        self.patterns["Factory Method"] = PatternDefinition(
            name="Factory Method",
            category=PatternCategory.CREATIONAL,
            scope=PatternScope.CLASS,
            intent="å®šä¹‰åˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»",
            problem="å¦‚ä½•åœ¨ä¸æŒ‡å®šå…·ä½“ç±»çš„æƒ…å†µä¸‹åˆ›å»ºå¯¹è±¡ï¼Ÿ",
            solution="å®šä¹‰å·¥å‚æ–¹æ³•ï¼Œå­ç±»é‡å†™ä»¥åˆ›å»ºå…·ä½“å¯¹è±¡",
            consequences=["æ¶ˆé™¤å¯¹å…·ä½“ç±»çš„ä¾èµ–", "æ”¯æŒæ‰©å±•", "å¯èƒ½äº§ç”Ÿè¿‡å¤šå­ç±»"],
            participants=["Creator", "ConcreteCreator", "Product", "ConcreteProduct"],
            collaborations=["Creatorä¾èµ–ConcreteCreatoråˆ›å»ºProduct"]
        )
        
        # ç»“æ„å‹æ¨¡å¼
        self.patterns["Adapter"] = PatternDefinition(
            name="Adapter",
            category=PatternCategory.STRUCTURAL,
            scope=PatternScope.OBJECT,
            intent="å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£",
            problem="å¦‚ä½•è®©ä¸å…¼å®¹çš„æ¥å£ååŒå·¥ä½œï¼Ÿ",
            solution="åˆ›å»ºé€‚é…å™¨ç±»åŒ…è£…ä¸å…¼å®¹çš„æ¥å£",
            consequences=["æé«˜ç±»çš„å¤ç”¨æ€§", "å¢åŠ ç³»ç»Ÿå¤æ‚æ€§"],
            participants=["Target", "Adapter", "Adaptee", "Client"],
            collaborations=["Clientè°ƒç”¨Targetæ¥å£ï¼ŒAdapterå°†è¯·æ±‚è½¬å‘ç»™Adaptee"]
        )
        
        # è¡Œä¸ºå‹æ¨¡å¼
        self.patterns["Observer"] = PatternDefinition(
            name="Observer",
            category=PatternCategory.BEHAVIORAL,
            scope=PatternScope.OBJECT,
            intent="å®šä¹‰å¯¹è±¡é—´çš„ä¸€å¯¹å¤šä¾èµ–å…³ç³»",
            problem="å¦‚ä½•å®ç°å¯¹è±¡é—´çš„æ¾è€¦åˆé€šä¿¡ï¼Ÿ",
            solution="å®šä¹‰è§‚å¯Ÿè€…æ¥å£ï¼Œä¸»é¢˜ç»´æŠ¤è§‚å¯Ÿè€…åˆ—è¡¨",
            consequences=["æ¾è€¦åˆ", "æ”¯æŒå¹¿æ’­é€šä¿¡", "å¯èƒ½äº§ç”Ÿå¾ªç¯ä¾èµ–"],
            participants=["Subject", "Observer", "ConcreteSubject", "ConcreteObserver"],
            collaborations=["Subjecté€šçŸ¥Observerï¼ŒObserveræ›´æ–°çŠ¶æ€"]
        )
    
    def get_patterns_by_category(self, category: PatternCategory) -> List[PatternDefinition]:
        """æŒ‰åˆ†ç±»è·å–æ¨¡å¼"""
        return [pattern for pattern in self.patterns.values() 
                if pattern.category == category]
    
    def get_pattern(self, name: str) -> Optional[PatternDefinition]:
        """è·å–ç‰¹å®šæ¨¡å¼"""
        return self.patterns.get(name)
    
    def search_patterns(self, keyword: str) -> List[PatternDefinition]:
        """æœç´¢æ¨¡å¼"""
        keyword_lower = keyword.lower()
        results = []
        
        for pattern in self.patterns.values():
            if (keyword_lower in pattern.name.lower() or
                keyword_lower in pattern.intent.lower() or
                keyword_lower in pattern.problem.lower()):
                results.append(pattern)
        
        return results

# ä½¿ç”¨ç¤ºä¾‹
def demonstrate_pattern_catalog():
    """æ¼”ç¤ºæ¨¡å¼ç›®å½•"""
    catalog = DesignPatternCatalog()
    
    print("=== è®¾è®¡æ¨¡å¼ç›®å½• ===")
    
    # æŒ‰åˆ†ç±»æ˜¾ç¤ºæ¨¡å¼
    for category in PatternCategory:
        patterns = catalog.get_patterns_by_category(category)
        print(f"\n{category.value}æ¨¡å¼:")
        for pattern in patterns:
            print(f"  - {pattern.name}: {pattern.intent}")
    
    # æœç´¢æ¨¡å¼
    search_results = catalog.search_patterns("æ¥å£")
    print(f"\nåŒ…å«'æ¥å£'çš„æ¨¡å¼:")
    for pattern in search_results:
        print(f"  - {pattern.name}: {pattern.intent}")
```

### 2. åˆ›å»ºå‹æ¨¡å¼ (Creational Patterns)

**æ¦‚å¿µå®šä¹‰**: åˆ›å»ºå‹æ¨¡å¼å¤„ç†å¯¹è±¡åˆ›å»ºæœºåˆ¶ï¼Œè¯•å›¾åœ¨é€‚åˆç‰¹å®šæƒ…å†µçš„åœºæ™¯ä¸‹åˆ›å»ºå¯¹è±¡ã€‚

**æ•°å­¦å½¢å¼**:
å•ä¾‹æ¨¡å¼å¯ä»¥å½¢å¼åŒ–ä¸ºï¼š

$$Singleton = \{instance | instance \in Class \land \forall x \in Class : x = instance\}$$

å·¥å‚æ–¹æ³•æ¨¡å¼ï¼š

$$FactoryMethod(Creator) \rightarrow Product$$

**Pythonå®ç°**:

```python
from typing import Dict, Any, Optional, Type
import threading
import time

class Singleton:
    """å•ä¾‹æ¨¡å¼å®ç°"""
    
    _instance: Optional['Singleton'] = None
    _lock = threading.Lock()
    
    def __new__(cls):
        if cls._instance is None:
            with cls._lock:
                if cls._instance is None:
                    cls._instance = super().__new__(cls)
        return cls._instance
    
    def __init__(self):
        if not hasattr(self, '_initialized'):
            self._initialized = True
            self.data = {}
    
    def set_data(self, key: str, value: Any):
        """è®¾ç½®æ•°æ®"""
        self.data[key] = value
    
    def get_data(self, key: str) -> Any:
        """è·å–æ•°æ®"""
        return self.data.get(key)

class DatabaseConnection(Singleton):
    """æ•°æ®åº“è¿æ¥å•ä¾‹"""
    
    def __init__(self):
        if not hasattr(self, '_initialized'):
            super().__init__()
            self._initialized = True
            self.connection_string = ""
            self.is_connected = False
    
    def connect(self, connection_string: str):
        """è¿æ¥æ•°æ®åº“"""
        self.connection_string = connection_string
        self.is_connected = True
        print(f"è¿æ¥åˆ°æ•°æ®åº“: {connection_string}")
    
    def disconnect(self):
        """æ–­å¼€è¿æ¥"""
        self.is_connected = False
        print("æ–­å¼€æ•°æ®åº“è¿æ¥")
    
    def execute_query(self, query: str):
        """æ‰§è¡ŒæŸ¥è¯¢"""
        if self.is_connected:
            print(f"æ‰§è¡ŒæŸ¥è¯¢: {query}")
            return f"ç»“æœ: {query}"
        else:
            raise Exception("æ•°æ®åº“æœªè¿æ¥")

# å·¥å‚æ–¹æ³•æ¨¡å¼
class Product(ABC):
    """äº§å“æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def operation(self) -> str:
        pass

class ConcreteProductA(Product):
    """å…·ä½“äº§å“A"""
    
    def operation(self) -> str:
        return "ConcreteProductAçš„æ“ä½œ"

class ConcreteProductB(Product):
    """å…·ä½“äº§å“B"""
    
    def operation(self) -> str:
        return "ConcreteProductBçš„æ“ä½œ"

class Creator(ABC):
    """åˆ›å»ºè€…æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def factory_method(self) -> Product:
        pass
    
    def some_operation(self) -> str:
        """ä½¿ç”¨å·¥å‚æ–¹æ³•åˆ›å»ºäº§å“"""
        product = self.factory_method()
        return f"åˆ›å»ºè€…: {product.operation()}"

class ConcreteCreatorA(Creator):
    """å…·ä½“åˆ›å»ºè€…A"""
    
    def factory_method(self) -> Product:
        return ConcreteProductA()

class ConcreteCreatorB(Creator):
    """å…·ä½“åˆ›å»ºè€…B"""
    
    def factory_method(self) -> Product:
        return ConcreteProductB()

# æŠ½è±¡å·¥å‚æ¨¡å¼
class AbstractFactory(ABC):
    """æŠ½è±¡å·¥å‚"""
    
    @abstractmethod
    def create_product_a(self) -> Product:
        pass
    
    @abstractmethod
    def create_product_b(self) -> Product:
        pass

class ConcreteFactory1(AbstractFactory):
    """å…·ä½“å·¥å‚1"""
    
    def create_product_a(self) -> Product:
        return ConcreteProductA()
    
    def create_product_b(self) -> Product:
        return ConcreteProductB()

class ConcreteFactory2(AbstractFactory):
    """å…·ä½“å·¥å‚2"""
    
    def create_product_a(self) -> Product:
        return ConcreteProductB()  # è¿”å›ä¸åŒçš„äº§å“
    
    def create_product_b(self) -> Product:
        return ConcreteProductA()

# å»ºé€ è€…æ¨¡å¼
class Computer:
    """è®¡ç®—æœºç±»"""
    
    def __init__(self):
        self.cpu = ""
        self.memory = ""
        self.storage = ""
        self.graphics = ""
    
    def __str__(self):
        return f"CPU: {self.cpu}, Memory: {self.memory}, Storage: {self.storage}, Graphics: {self.graphics}"

class ComputerBuilder(ABC):
    """è®¡ç®—æœºå»ºé€ è€…"""
    
    def __init__(self):
        self.computer = Computer()
    
    @abstractmethod
    def build_cpu(self):
        pass
    
    @abstractmethod
    def build_memory(self):
        pass
    
    @abstractmethod
    def build_storage(self):
        pass
    
    @abstractmethod
    def build_graphics(self):
        pass
    
    def get_result(self) -> Computer:
        return self.computer

class GamingComputerBuilder(ComputerBuilder):
    """æ¸¸æˆç”µè„‘å»ºé€ è€…"""
    
    def build_cpu(self):
        self.computer.cpu = "Intel i9-12900K"
    
    def build_memory(self):
        self.computer.memory = "32GB DDR5"
    
    def build_storage(self):
        self.computer.storage = "2TB NVMe SSD"
    
    def build_graphics(self):
        self.computer.graphics = "RTX 4090"

class OfficeComputerBuilder(ComputerBuilder):
    """åŠå…¬ç”µè„‘å»ºé€ è€…"""
    
    def build_cpu(self):
        self.computer.cpu = "Intel i5-12400"
    
    def build_memory(self):
        self.computer.memory = "16GB DDR4"
    
    def build_storage(self):
        self.computer.storage = "512GB SSD"
    
    def build_graphics(self):
        self.computer.graphics = "Integrated Graphics"

class ComputerDirector:
    """è®¡ç®—æœºä¸»ç®¡"""
    
    def __init__(self, builder: ComputerBuilder):
        self.builder = builder
    
    def construct(self) -> Computer:
        """æ„å»ºè®¡ç®—æœº"""
        self.builder.build_cpu()
        self.builder.build_memory()
        self.builder.build_storage()
        self.builder.build_graphics()
        return self.builder.get_result()

# ä½¿ç”¨ç¤ºä¾‹
def demonstrate_creational_patterns():
    """æ¼”ç¤ºåˆ›å»ºå‹æ¨¡å¼"""
    print("=== åˆ›å»ºå‹æ¨¡å¼æ¼”ç¤º ===")
    
    # å•ä¾‹æ¨¡å¼
    print("\n--- å•ä¾‹æ¨¡å¼ ---")
    db1 = DatabaseConnection()
    db2 = DatabaseConnection()
    
    print(f"db1 å’Œ db2 æ˜¯åŒä¸€ä¸ªå®ä¾‹: {db1 is db2}")
    
    db1.connect("mysql://localhost:3306/mydb")
    db2.execute_query("SELECT * FROM users")
    
    # å·¥å‚æ–¹æ³•æ¨¡å¼
    print("\n--- å·¥å‚æ–¹æ³•æ¨¡å¼ ---")
    creator_a = ConcreteCreatorA()
    creator_b = ConcreteCreatorB()
    
    print(creator_a.some_operation())
    print(creator_b.some_operation())
    
    # æŠ½è±¡å·¥å‚æ¨¡å¼
    print("\n--- æŠ½è±¡å·¥å‚æ¨¡å¼ ---")
    factory1 = ConcreteFactory1()
    factory2 = ConcreteFactory2()
    
    product_a1 = factory1.create_product_a()
    product_b1 = factory1.create_product_b()
    
    product_a2 = factory2.create_product_a()
    product_b2 = factory2.create_product_b()
    
    print(f"Factory1 - ProductA: {product_a1.operation()}")
    print(f"Factory1 - ProductB: {product_b1.operation()}")
    print(f"Factory2 - ProductA: {product_a2.operation()}")
    print(f"Factory2 - ProductB: {product_b2.operation()}")
    
    # å»ºé€ è€…æ¨¡å¼
    print("\n--- å»ºé€ è€…æ¨¡å¼ ---")
    gaming_builder = GamingComputerBuilder()
    office_builder = OfficeComputerBuilder()
    
    director = ComputerDirector(gaming_builder)
    gaming_computer = director.construct()
    print(f"æ¸¸æˆç”µè„‘: {gaming_computer}")
    
    director = ComputerDirector(office_builder)
    office_computer = director.construct()
    print(f"åŠå…¬ç”µè„‘: {office_computer}")
```

### 3. ç»“æ„å‹æ¨¡å¼ (Structural Patterns)

**æ¦‚å¿µå®šä¹‰**: ç»“æ„å‹æ¨¡å¼å¤„ç†ç±»å’Œå¯¹è±¡çš„ç»„åˆï¼Œå…³æ³¨å¦‚ä½•å°†ç±»å’Œå¯¹è±¡ç»„åˆæˆæ›´å¤§çš„ç»“æ„ã€‚

**æ•°å­¦å½¢å¼**:
é€‚é…å™¨æ¨¡å¼ï¼š

$$Adapter(Target, Adaptee) \rightarrow CompatibleInterface$$

è£…é¥°å™¨æ¨¡å¼ï¼š

$$Decorator(Component) \rightarrow EnhancedComponent$$

**Pythonå®ç°**:

```python
from typing import List, Dict, Any
from abc import ABC, abstractmethod

# é€‚é…å™¨æ¨¡å¼
class Target(ABC):
    """ç›®æ ‡æ¥å£"""
    
    @abstractmethod
    def request(self) -> str:
        pass

class Adaptee:
    """éœ€è¦é€‚é…çš„ç±»"""
    
    def specific_request(self) -> str:
        return "ç‰¹æ®Šè¯·æ±‚"

class Adapter(Target):
    """é€‚é…å™¨"""
    
    def __init__(self, adaptee: Adaptee):
        self.adaptee = adaptee
    
    def request(self) -> str:
        return f"é€‚é…å™¨: {self.adaptee.specific_request()}"

# è£…é¥°å™¨æ¨¡å¼
class Component(ABC):
    """ç»„ä»¶æ¥å£"""
    
    @abstractmethod
    def operation(self) -> str:
        pass

class ConcreteComponent(Component):
    """å…·ä½“ç»„ä»¶"""
    
    def operation(self) -> str:
        return "å…·ä½“ç»„ä»¶"

class Decorator(Component):
    """è£…é¥°å™¨åŸºç±»"""
    
    def __init__(self, component: Component):
        self.component = component
    
    def operation(self) -> str:
        return self.component.operation()

class ConcreteDecoratorA(Decorator):
    """å…·ä½“è£…é¥°å™¨A"""
    
    def operation(self) -> str:
        return f"è£…é¥°å™¨A({super().operation()})"

class ConcreteDecoratorB(Decorator):
    """å…·ä½“è£…é¥°å™¨B"""
    
    def operation(self) -> str:
        return f"è£…é¥°å™¨B({super().operation()})"

# å¤–è§‚æ¨¡å¼
class SubsystemA:
    """å­ç³»ç»ŸA"""
    
    def operation_a1(self) -> str:
        return "å­ç³»ç»ŸAæ“ä½œ1"
    
    def operation_a2(self) -> str:
        return "å­ç³»ç»ŸAæ“ä½œ2"

class SubsystemB:
    """å­ç³»ç»ŸB"""
    
    def operation_b1(self) -> str:
        return "å­ç³»ç»ŸBæ“ä½œ1"
    
    def operation_b2(self) -> str:
        return "å­ç³»ç»ŸBæ“ä½œ2"

class Facade:
    """å¤–è§‚ç±»"""
    
    def __init__(self):
        self.subsystem_a = SubsystemA()
        self.subsystem_b = SubsystemB()
    
    def operation1(self) -> str:
        """æ“ä½œ1"""
        result = []
        result.append(self.subsystem_a.operation_a1())
        result.append(self.subsystem_b.operation_b1())
        return " + ".join(result)
    
    def operation2(self) -> str:
        """æ“ä½œ2"""
        result = []
        result.append(self.subsystem_a.operation_a2())
        result.append(self.subsystem_b.operation_b2())
        return " + ".join(result)

# ä»£ç†æ¨¡å¼
class Subject(ABC):
    """ä¸»é¢˜æ¥å£"""
    
    @abstractmethod
    def request(self) -> str:
        pass

class RealSubject(Subject):
    """çœŸå®ä¸»é¢˜"""
    
    def request(self) -> str:
        return "çœŸå®ä¸»é¢˜çš„è¯·æ±‚"

class Proxy(Subject):
    """ä»£ç†"""
    
    def __init__(self, real_subject: RealSubject):
        self.real_subject = real_subject
        self.access_count = 0
    
    def request(self) -> str:
        self.access_count += 1
        print(f"ä»£ç†: è®¿é—®æ¬¡æ•° {self.access_count}")
        return self.real_subject.request()

# ç»„åˆæ¨¡å¼
class Component_Composite(ABC):
    """ç»„åˆæ¨¡å¼ç»„ä»¶"""
    
    def __init__(self, name: str):
        self.name = name
    
    @abstractmethod
    def operation(self) -> str:
        pass
    
    @abstractmethod
    def add(self, component: 'Component_Composite'):
        pass
    
    @abstractmethod
    def remove(self, component: 'Component_Composite'):
        pass
    
    @abstractmethod
    def get_child(self, index: int) -> 'Component_Composite':
        pass

class Leaf(Component_Composite):
    """å¶å­èŠ‚ç‚¹"""
    
    def operation(self) -> str:
        return f"å¶å­ {self.name}"
    
    def add(self, component: Component_Composite):
        raise Exception("å¶å­èŠ‚ç‚¹ä¸èƒ½æ·»åŠ å­èŠ‚ç‚¹")
    
    def remove(self, component: Component_Composite):
        raise Exception("å¶å­èŠ‚ç‚¹ä¸èƒ½åˆ é™¤å­èŠ‚ç‚¹")
    
    def get_child(self, index: int) -> Component_Composite:
        raise Exception("å¶å­èŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹")

class Composite(Component_Composite):
    """ç»„åˆèŠ‚ç‚¹"""
    
    def __init__(self, name: str):
        super().__init__(name)
        self.children: List[Component_Composite] = []
    
    def operation(self) -> str:
        results = [f"ç»„åˆ {self.name}"]
        for child in self.children:
            results.append(f"  {child.operation()}")
        return "\n".join(results)
    
    def add(self, component: Component_Composite):
        self.children.append(component)
    
    def remove(self, component: Component_Composite):
        self.children.remove(component)
    
    def get_child(self, index: int) -> Component_Composite:
        return self.children[index]

# ä½¿ç”¨ç¤ºä¾‹
def demonstrate_structural_patterns():
    """æ¼”ç¤ºç»“æ„å‹æ¨¡å¼"""
    print("=== ç»“æ„å‹æ¨¡å¼æ¼”ç¤º ===")
    
    # é€‚é…å™¨æ¨¡å¼
    print("\n--- é€‚é…å™¨æ¨¡å¼ ---")
    adaptee = Adaptee()
    adapter = Adapter(adaptee)
    print(adapter.request())
    
    # è£…é¥°å™¨æ¨¡å¼
    print("\n--- è£…é¥°å™¨æ¨¡å¼ ---")
    component = ConcreteComponent()
    decorated = ConcreteDecoratorA(ConcreteDecoratorB(component))
    print(decorated.operation())
    
    # å¤–è§‚æ¨¡å¼
    print("\n--- å¤–è§‚æ¨¡å¼ ---")
    facade = Facade()
    print(f"æ“ä½œ1: {facade.operation1()}")
    print(f"æ“ä½œ2: {facade.operation2()}")
    
    # ä»£ç†æ¨¡å¼
    print("\n--- ä»£ç†æ¨¡å¼ ---")
    real_subject = RealSubject()
    proxy = Proxy(real_subject)
    print(proxy.request())
    print(proxy.request())
    
    # ç»„åˆæ¨¡å¼
    print("\n--- ç»„åˆæ¨¡å¼ ---")
    root = Composite("æ ¹")
    root.add(Leaf("å¶å­A"))
    root.add(Leaf("å¶å­B"))
    
    branch = Composite("åˆ†æ”¯")
    branch.add(Leaf("å¶å­C"))
    branch.add(Leaf("å¶å­D"))
    
    root.add(branch)
    print(root.operation())
```

### 4. è¡Œä¸ºå‹æ¨¡å¼ (Behavioral Patterns)

**æ¦‚å¿µå®šä¹‰**: è¡Œä¸ºå‹æ¨¡å¼å…³æ³¨å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ï¼Œæè¿°å¯¹è±¡å¦‚ä½•åä½œä»¥åŠå¦‚ä½•åˆ†é…èŒè´£ã€‚

**æ•°å­¦å½¢å¼**:
è§‚å¯Ÿè€…æ¨¡å¼ï¼š

$$Observer(Subject) \rightarrow Update(Observer)$$

ç­–ç•¥æ¨¡å¼ï¼š

$$Strategy(Context) \rightarrow Algorithm(Strategy)$$

**Pythonå®ç°**:

```python
from typing import List, Dict, Any, Callable
from abc import ABC, abstractmethod
from dataclasses import dataclass
from enum import Enum

# è§‚å¯Ÿè€…æ¨¡å¼
class Observer(ABC):
    """è§‚å¯Ÿè€…æ¥å£"""
    
    @abstractmethod
    def update(self, subject: 'Subject'):
        pass

class Subject(ABC):
    """ä¸»é¢˜æ¥å£"""
    
    def __init__(self):
        self.observers: List[Observer] = []
    
    def attach(self, observer: Observer):
        """æ·»åŠ è§‚å¯Ÿè€…"""
        if observer not in self.observers:
            self.observers.append(observer)
    
    def detach(self, observer: Observer):
        """ç§»é™¤è§‚å¯Ÿè€…"""
        self.observers.remove(observer)
    
    def notify(self):
        """é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…"""
        for observer in self.observers:
            observer.update(self)

class ConcreteSubject(Subject):
    """å…·ä½“ä¸»é¢˜"""
    
    def __init__(self):
        super().__init__()
        self.state = ""
    
    def set_state(self, state: str):
        """è®¾ç½®çŠ¶æ€"""
        self.state = state
        self.notify()
    
    def get_state(self) -> str:
        """è·å–çŠ¶æ€"""
        return self.state

class ConcreteObserverA(Observer):
    """å…·ä½“è§‚å¯Ÿè€…A"""
    
    def update(self, subject: Subject):
        print(f"è§‚å¯Ÿè€…Aæ”¶åˆ°é€šçŸ¥: {subject.get_state()}")

class ConcreteObserverB(Observer):
    """å…·ä½“è§‚å¯Ÿè€…B"""
    
    def update(self, subject: Subject):
        print(f"è§‚å¯Ÿè€…Bæ”¶åˆ°é€šçŸ¥: {subject.get_state()}")

# ç­–ç•¥æ¨¡å¼
class Strategy(ABC):
    """ç­–ç•¥æ¥å£"""
    
    @abstractmethod
    def algorithm(self, data: List[int]) -> List[int]:
        pass

class BubbleSortStrategy(Strategy):
    """å†’æ³¡æ’åºç­–ç•¥"""
    
    def algorithm(self, data: List[int]) -> List[int]:
        result = data.copy()
        n = len(result)
        for i in range(n):
            for j in range(0, n - i - 1):
                if result[j] > result[j + 1]:
                    result[j], result[j + 1] = result[j + 1], result[j]
        return result

class QuickSortStrategy(Strategy):
    """å¿«é€Ÿæ’åºç­–ç•¥"""
    
    def algorithm(self, data: List[int]) -> List[int]:
        if len(data) <= 1:
            return data
        pivot = data[len(data) // 2]
        left = [x for x in data if x < pivot]
        middle = [x for x in data if x == pivot]
        right = [x for x in data if x > pivot]
        return self.algorithm(left) + middle + self.algorithm(right)

class Context:
    """ä¸Šä¸‹æ–‡"""
    
    def __init__(self, strategy: Strategy):
        self.strategy = strategy
    
    def set_strategy(self, strategy: Strategy):
        """è®¾ç½®ç­–ç•¥"""
        self.strategy = strategy
    
    def execute_strategy(self, data: List[int]) -> List[int]:
        """æ‰§è¡Œç­–ç•¥"""
        return self.strategy.algorithm(data)

# å‘½ä»¤æ¨¡å¼
class Command(ABC):
    """å‘½ä»¤æ¥å£"""
    
    @abstractmethod
    def execute(self):
        pass
    
    @abstractmethod
    def undo(self):
        pass

class Receiver:
    """æ¥æ”¶è€…"""
    
    def action1(self):
        print("æ¥æ”¶è€…æ‰§è¡ŒåŠ¨ä½œ1")
    
    def action2(self):
        print("æ¥æ”¶è€…æ‰§è¡ŒåŠ¨ä½œ2")

class ConcreteCommand(Command):
    """å…·ä½“å‘½ä»¤"""
    
    def __init__(self, receiver: Receiver, action: str):
        self.receiver = receiver
        self.action = action
    
    def execute(self):
        if self.action == "action1":
            self.receiver.action1()
        elif self.action == "action2":
            self.receiver.action2()
    
    def undo(self):
        print(f"æ’¤é”€å‘½ä»¤: {self.action}")

class Invoker:
    """è°ƒç”¨è€…"""
    
    def __init__(self):
        self.commands: List[Command] = []
    
    def add_command(self, command: Command):
        """æ·»åŠ å‘½ä»¤"""
        self.commands.append(command)
    
    def execute_commands(self):
        """æ‰§è¡Œæ‰€æœ‰å‘½ä»¤"""
        for command in self.commands:
            command.execute()
    
    def undo_last_command(self):
        """æ’¤é”€æœ€åä¸€ä¸ªå‘½ä»¤"""
        if self.commands:
            command = self.commands.pop()
            command.undo()

# çŠ¶æ€æ¨¡å¼
class State(ABC):
    """çŠ¶æ€æ¥å£"""
    
    @abstractmethod
    def handle(self, context: 'Context_State'):
        pass

class ConcreteStateA(State):
    """å…·ä½“çŠ¶æ€A"""
    
    def handle(self, context: 'Context_State'):
        print("çŠ¶æ€Aå¤„ç†")
        context.set_state(ConcreteStateB())

class ConcreteStateB(State):
    """å…·ä½“çŠ¶æ€B"""
    
    def handle(self, context: 'Context_State'):
        print("çŠ¶æ€Bå¤„ç†")
        context.set_state(ConcreteStateA())

class Context_State:
    """çŠ¶æ€ä¸Šä¸‹æ–‡"""
    
    def __init__(self):
        self.state = ConcreteStateA()
    
    def set_state(self, state: State):
        """è®¾ç½®çŠ¶æ€"""
        self.state = state
    
    def request(self):
        """è¯·æ±‚å¤„ç†"""
        self.state.handle(self)

# æ¨¡æ¿æ–¹æ³•æ¨¡å¼
class AbstractClass(ABC):
    """æŠ½è±¡ç±»"""
    
    def template_method(self):
        """æ¨¡æ¿æ–¹æ³•"""
        self.primitive_operation1()
        self.primitive_operation2()
        self.concrete_operation()
        self.hook()
    
    @abstractmethod
    def primitive_operation1(self):
        pass
    
    @abstractmethod
    def primitive_operation2(self):
        pass
    
    def concrete_operation(self):
        """å…·ä½“æ“ä½œ"""
        print("æŠ½è±¡ç±»çš„å…·ä½“æ“ä½œ")
    
    def hook(self):
        """é’©å­æ–¹æ³•"""
        pass

class ConcreteClass(AbstractClass):
    """å…·ä½“ç±»"""
    
    def primitive_operation1(self):
        print("å…·ä½“ç±»æ“ä½œ1")
    
    def primitive_operation2(self):
        print("å…·ä½“ç±»æ“ä½œ2")
    
    def hook(self):
        print("å…·ä½“ç±»é’©å­æ–¹æ³•")

# ä½¿ç”¨ç¤ºä¾‹
def demonstrate_behavioral_patterns():
    """æ¼”ç¤ºè¡Œä¸ºå‹æ¨¡å¼"""
    print("=== è¡Œä¸ºå‹æ¨¡å¼æ¼”ç¤º ===")
    
    # è§‚å¯Ÿè€…æ¨¡å¼
    print("\n--- è§‚å¯Ÿè€…æ¨¡å¼ ---")
    subject = ConcreteSubject()
    observer_a = ConcreteObserverA()
    observer_b = ConcreteObserverB()
    
    subject.attach(observer_a)
    subject.attach(observer_b)
    subject.set_state("æ–°çŠ¶æ€")
    
    # ç­–ç•¥æ¨¡å¼
    print("\n--- ç­–ç•¥æ¨¡å¼ ---")
    data = [64, 34, 25, 12, 22, 11, 90]
    context = Context(BubbleSortStrategy())
    
    print(f"åŸå§‹æ•°æ®: {data}")
    sorted_data = context.execute_strategy(data)
    print(f"å†’æ³¡æ’åº: {sorted_data}")
    
    context.set_strategy(QuickSortStrategy())
    sorted_data = context.execute_strategy(data)
    print(f"å¿«é€Ÿæ’åº: {sorted_data}")
    
    # å‘½ä»¤æ¨¡å¼
    print("\n--- å‘½ä»¤æ¨¡å¼ ---")
    receiver = Receiver()
    command1 = ConcreteCommand(receiver, "action1")
    command2 = ConcreteCommand(receiver, "action2")
    
    invoker = Invoker()
    invoker.add_command(command1)
    invoker.add_command(command2)
    invoker.execute_commands()
    invoker.undo_last_command()
    
    # çŠ¶æ€æ¨¡å¼
    print("\n--- çŠ¶æ€æ¨¡å¼ ---")
    context_state = Context_State()
    for _ in range(4):
        context_state.request()
    
    # æ¨¡æ¿æ–¹æ³•æ¨¡å¼
    print("\n--- æ¨¡æ¿æ–¹æ³•æ¨¡å¼ ---")
    concrete = ConcreteClass()
    concrete.template_method()
```

## ğŸ”— ç›¸å…³é“¾æ¥

- [03-02-å¹¶å‘ç¼–ç¨‹ç§‘å­¦](./03-02-å¹¶å‘ç¼–ç¨‹ç§‘å­¦.md)
- [03-03-åˆ†å¸ƒå¼ç³»ç»Ÿç§‘å­¦](./03-03-åˆ†å¸ƒå¼ç³»ç»Ÿç§‘å­¦.md)
- [06-03-è®¾è®¡æ¨¡å¼å®ç°](../06-ç»„ä»¶ç®—æ³•/06-03-è®¾è®¡æ¨¡å¼å®ç°.md)

## ğŸ“š å‚è€ƒæ–‡çŒ®

1. Gamma, E., Helm, R., Johnson, R., & Vlissides, J. (1994). Design patterns: Elements of reusable object-oriented software.
2. Freeman, E., Robson, E., Sierra, K., & Bates, B. (2004). Head first design patterns.
3. Martin, R. C. (2000). Design principles and design patterns.

---

**æœ€åæ›´æ–°**: 2024å¹´12æœˆ19æ—¥  
**ç»´æŠ¤è€…**: AI Assistant
