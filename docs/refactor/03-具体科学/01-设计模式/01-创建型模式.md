# 01. åˆ›å»ºå‹æ¨¡å¼

## ğŸ“‹ æ¦‚è¿°

åˆ›å»ºå‹æ¨¡å¼å…³æ³¨å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œæä¾›çµæ´»çš„å¯¹è±¡åˆ›å»ºæœºåˆ¶ã€‚æœ¬æ–‡æ¡£å°†åˆ›å»ºå‹æ¨¡å¼è¿›è¡Œå½¢å¼åŒ–å®šä¹‰ï¼Œå¹¶æä¾›å®Œæ•´çš„Pythonå®ç°ã€‚

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### 1. åˆ›å»ºå‹æ¨¡å¼çš„å½¢å¼åŒ–å®šä¹‰

**æ•°å­¦å®šä¹‰**ï¼š
åˆ›å»ºå‹æ¨¡å¼æ˜¯ä¸€ä¸ªå‡½æ•° $C: P \rightarrow O$ï¼Œå…¶ä¸­ï¼š

- $P$ æ˜¯åˆ›å»ºå‚æ•°é›†åˆ
- $O$ æ˜¯å¯¹è±¡é›†åˆ
- $C$ æ˜¯åˆ›å»ºå‡½æ•°ï¼Œå°†å‚æ•°æ˜ å°„åˆ°å¯¹è±¡

å¯¹äºæ¨¡å¼ $M$ï¼Œå…¶åˆ›å»ºå‡½æ•°ä¸ºï¼š
$$C_M: P_M \times S_M \rightarrow O_M$$

å…¶ä¸­ $S_M$ æ˜¯æ¨¡å¼çš„çŠ¶æ€ç©ºé—´ã€‚

**Pythonå®ç°**ï¼š

```python
from typing import TypeVar, Generic, Dict, Any, Callable, Optional, List
from abc import ABC, abstractmethod
from dataclasses import dataclass
from enum import Enum
import threading
import time

T = TypeVar('T')
U = TypeVar('U')

class CreationPattern(Enum):
    """åˆ›å»ºå‹æ¨¡å¼æšä¸¾"""
    SINGLETON = "singleton"
    FACTORY_METHOD = "factory_method"
    ABSTRACT_FACTORY = "abstract_factory"
    BUILDER = "builder"
    PROTOTYPE = "prototype"

@dataclass
class CreationContext:
    """åˆ›å»ºä¸Šä¸‹æ–‡"""
    pattern_type: CreationPattern
    parameters: Dict[str, Any]
    constraints: List[str]
    state: Dict[str, Any]

class ObjectCreator(ABC):
    """å¯¹è±¡åˆ›å»ºå™¨æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def create(self, context: CreationContext) -> Any:
        """åˆ›å»ºå¯¹è±¡"""
        pass
    
    @abstractmethod
    def validate(self, context: CreationContext) -> bool:
        """éªŒè¯åˆ›å»ºå‚æ•°"""
        pass

class CreationPatternRegistry:
    """åˆ›å»ºæ¨¡å¼æ³¨å†Œè¡¨"""
    
    def __init__(self):
        self.patterns: Dict[CreationPattern, ObjectCreator] = {}
        self.instances: Dict[str, Any] = {}
    
    def register_pattern(self, pattern: CreationPattern, creator: ObjectCreator) -> None:
        """æ³¨å†Œåˆ›å»ºæ¨¡å¼"""
        self.patterns[pattern] = creator
    
    def create_object(self, pattern: CreationPattern, context: CreationContext) -> Any:
        """ä½¿ç”¨æ¨¡å¼åˆ›å»ºå¯¹è±¡"""
        if pattern not in self.patterns:
            raise ValueError(f"Pattern {pattern} not registered")
        
        creator = self.patterns[pattern]
        
        if not creator.validate(context):
            raise ValueError(f"Invalid context for pattern {pattern}")
        
        return creator.create(context)
    
    def get_instance(self, key: str) -> Any:
        """è·å–å®ä¾‹"""
        return self.instances.get(key)
    
    def set_instance(self, key: str, instance: Any) -> None:
        """è®¾ç½®å®ä¾‹"""
        self.instances[key] = instance

# å…¨å±€åˆ›å»ºæ¨¡å¼æ³¨å†Œè¡¨
creation_registry = CreationPatternRegistry()
```

### 2. å•ä¾‹æ¨¡å¼ (Singleton Pattern)

#### 2.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 2.1.1** (å•ä¾‹æ¨¡å¼)
å•ä¾‹æ¨¡å¼ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹ï¼š
$$\forall x, y \in \text{Instance}(C) \Rightarrow x = y$$

å…¶ä¸­ $C$ ä¸ºå•ä¾‹ç±»ï¼Œ$\text{Instance}(C)$ ä¸º $C$ çš„æ‰€æœ‰å®ä¾‹é›†åˆã€‚

#### 2.2 Pythonå®ç°

```python
import threading
from typing import Any, Optional, TypeVar, Type
from functools import wraps

T = TypeVar('T')

class Singleton(type):
    """å•ä¾‹å…ƒç±»"""
    
    _instances: dict = {}
    _lock: threading.Lock = threading.Lock()
    
    def __call__(cls: Type[T], *args, **kwargs) -> T:
        if cls not in cls._instances:
            with cls._lock:
                if cls not in cls._instances:
                    cls._instances[cls] = super().__call__(*args, **kwargs)
        return cls._instances[cls]

def singleton_decorator(cls: Type[T]) -> Type[T]:
    """å•ä¾‹è£…é¥°å™¨"""
    instances = {}
    lock = threading.Lock()
    
    @wraps(cls)
    def get_instance(*args, **kwargs) -> T:
        if cls not in instances:
            with lock:
                if cls not in instances:
                    instances[cls] = cls(*args, **kwargs)
        return instances[cls]
    
    return get_instance

class SingletonLogger:
    """å•ä¾‹æ—¥å¿—å™¨"""
    
    def __init__(self):
        self.logs: List[str] = []
        self.level = "INFO"
    
    def log(self, message: str) -> None:
        """è®°å½•æ—¥å¿—"""
        timestamp = time.strftime("%Y-%m-%d %H:%M:%S")
        log_entry = f"[{self.level}] {timestamp}: {message}"
        self.logs.append(log_entry)
        print(log_entry)
    
    def set_level(self, level: str) -> None:
        """è®¾ç½®æ—¥å¿—çº§åˆ«"""
        self.level = level
    
    def get_logs(self) -> List[str]:
        """è·å–æ‰€æœ‰æ—¥å¿—"""
        return self.logs.copy()
    
    def clear_logs(self) -> None:
        """æ¸…ç©ºæ—¥å¿—"""
        self.logs.clear()

# ä½¿ç”¨å…ƒç±»å®ç°å•ä¾‹
class DatabaseConnection(metaclass=Singleton):
    """æ•°æ®åº“è¿æ¥å•ä¾‹"""
    
    def __init__(self):
        self.connection_string = ""
        self.is_connected = False
    
    def connect(self, connection_string: str) -> None:
        """è¿æ¥æ•°æ®åº“"""
        self.connection_string = connection_string
        self.is_connected = True
        print(f"Connected to database: {connection_string}")
    
    def disconnect(self) -> None:
        """æ–­å¼€è¿æ¥"""
        self.is_connected = False
        print("Disconnected from database")
    
    def execute_query(self, query: str) -> str:
        """æ‰§è¡ŒæŸ¥è¯¢"""
        if not self.is_connected:
            raise RuntimeError("Database not connected")
        return f"Executed: {query}"

# ä½¿ç”¨è£…é¥°å™¨å®ç°å•ä¾‹
@singleton_decorator
class ConfigurationManager:
    """é…ç½®ç®¡ç†å™¨å•ä¾‹"""
    
    def __init__(self):
        self.config: Dict[str, Any] = {}
    
    def set_config(self, key: str, value: Any) -> None:
        """è®¾ç½®é…ç½®"""
        self.config[key] = value
    
    def get_config(self, key: str, default: Any = None) -> Any:
        """è·å–é…ç½®"""
        return self.config.get(key, default)
    
    def get_all_config(self) -> Dict[str, Any]:
        """è·å–æ‰€æœ‰é…ç½®"""
        return self.config.copy()

# çº¿ç¨‹å®‰å…¨çš„å•ä¾‹å®ç°
class ThreadSafeSingleton:
    """çº¿ç¨‹å®‰å…¨å•ä¾‹"""
    
    _instance: Optional['ThreadSafeSingleton'] = None
    _lock = threading.Lock()
    _initialized = False
    
    def __new__(cls) -> 'ThreadSafeSingleton':
        if cls._instance is None:
            with cls._lock:
                if cls._instance is None:
                    cls._instance = super().__new__(cls)
        return cls._instance
    
    def __init__(self):
        if not self._initialized:
            with self._lock:
                if not self._initialized:
                    self.data: Dict[str, Any] = {}
                    self._initialized = True
    
    def set_data(self, key: str, value: Any) -> None:
        """è®¾ç½®æ•°æ®"""
        with self._lock:
            self.data[key] = value
    
    def get_data(self, key: str) -> Any:
        """è·å–æ•°æ®"""
        with self._lock:
            return self.data.get(key)

# ç¤ºä¾‹ï¼šå•ä¾‹æ¨¡å¼ä½¿ç”¨
def singleton_example():
    """å•ä¾‹æ¨¡å¼ç¤ºä¾‹"""
    print("å•ä¾‹æ¨¡å¼ç¤ºä¾‹:")
    print("=" * 50)
    
    # æ•°æ®åº“è¿æ¥å•ä¾‹
    db1 = DatabaseConnection()
    db2 = DatabaseConnection()
    
    print(f"db1 is db2: {db1 is db2}")  # True
    
    db1.connect("postgresql://localhost:5432/mydb")
    db2.execute_query("SELECT * FROM users")  # ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥
    
    # é…ç½®ç®¡ç†å™¨å•ä¾‹
    config1 = ConfigurationManager()
    config2 = ConfigurationManager()
    
    print(f"config1 is config2: {config1 is config2}")  # True
    
    config1.set_config("database_url", "postgresql://localhost:5432/mydb")
    config1.set_config("max_connections", 10)
    
    print(f"config2 database_url: {config2.get_config('database_url')}")
    print(f"config2 max_connections: {config2.get_config('max_connections')}")
    
    # çº¿ç¨‹å®‰å…¨å•ä¾‹
    singleton1 = ThreadSafeSingleton()
    singleton2 = ThreadSafeSingleton()
    
    print(f"singleton1 is singleton2: {singleton1 is singleton2}")  # True
    
    singleton1.set_data("thread_id", threading.get_ident())
    print(f"singleton2 thread_id: {singleton2.get_data('thread_id')}")

if __name__ == "__main__":
    singleton_example()
```

### 3. å·¥å‚æ–¹æ³•æ¨¡å¼ (Factory Method Pattern)

#### 3.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 3.1.1** (å·¥å‚æ–¹æ³•æ¨¡å¼)
å·¥å‚æ–¹æ³•æ¨¡å¼å®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ï¼š
$$F: \text{ProductType} \rightarrow \text{Product}$$

å…¶ä¸­ $F$ æ˜¯å·¥å‚å‡½æ•°ï¼Œå°†äº§å“ç±»å‹æ˜ å°„åˆ°å…·ä½“äº§å“ã€‚

#### 3.2 Pythonå®ç°

```python
from abc import ABC, abstractmethod
from typing import TypeVar, Generic, Dict, Any

T = TypeVar('T')

class Product(ABC):
    """äº§å“æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def operation(self) -> str:
        """äº§å“æ“ä½œ"""
        pass

class ConcreteProductA(Product):
    """å…·ä½“äº§å“A"""
    
    def operation(self) -> str:
        return "ConcreteProductA operation"

class ConcreteProductB(Product):
    """å…·ä½“äº§å“B"""
    
    def operation(self) -> str:
        return "ConcreteProductB operation"

class Creator(ABC):
    """åˆ›å»ºè€…æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def factory_method(self) -> Product:
        """å·¥å‚æ–¹æ³•"""
        pass
    
    def some_operation(self) -> str:
        """ä¸€äº›æ“ä½œ"""
        product = self.factory_method()
        return f"Creator: {product.operation()}"

class ConcreteCreatorA(Creator):
    """å…·ä½“åˆ›å»ºè€…A"""
    
    def factory_method(self) -> Product:
        return ConcreteProductA()

class ConcreteCreatorB(Creator):
    """å…·ä½“åˆ›å»ºè€…B"""
    
    def factory_method(self) -> Product:
        return ConcreteProductB()

# å‚æ•°åŒ–å·¥å‚æ–¹æ³•
class ProductFactory:
    """äº§å“å·¥å‚"""
    
    _products: Dict[str, Type[Product]] = {
        "A": ConcreteProductA,
        "B": ConcreteProductB
    }
    
    @classmethod
    def create_product(cls, product_type: str) -> Product:
        """åˆ›å»ºäº§å“"""
        if product_type not in cls._products:
            raise ValueError(f"Unknown product type: {product_type}")
        
        return cls._products[product_type]()
    
    @classmethod
    def register_product(cls, product_type: str, product_class: Type[Product]) -> None:
        """æ³¨å†Œäº§å“ç±»å‹"""
        cls._products[product_type] = product_class

# æ³›å‹å·¥å‚æ–¹æ³•
class GenericFactory(Generic[T]):
    """æ³›å‹å·¥å‚"""
    
    def __init__(self, product_class: Type[T]):
        self.product_class = product_class
    
    def create(self, *args, **kwargs) -> T:
        """åˆ›å»ºäº§å“"""
        return self.product_class(*args, **kwargs)

# ç¤ºä¾‹ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼
def factory_method_example():
    """å·¥å‚æ–¹æ³•æ¨¡å¼ç¤ºä¾‹"""
    print("å·¥å‚æ–¹æ³•æ¨¡å¼ç¤ºä¾‹:")
    print("=" * 50)
    
    # ä½¿ç”¨å…·ä½“åˆ›å»ºè€…
    creator_a = ConcreteCreatorA()
    creator_b = ConcreteCreatorB()
    
    print(creator_a.some_operation())
    print(creator_b.some_operation())
    
    # ä½¿ç”¨å‚æ•°åŒ–å·¥å‚
    product_a = ProductFactory.create_product("A")
    product_b = ProductFactory.create_product("B")
    
    print(f"Product A: {product_a.operation()}")
    print(f"Product B: {product_b.operation()}")
    
    # ä½¿ç”¨æ³›å‹å·¥å‚
    factory = GenericFactory(ConcreteProductA)
    product = factory.create()
    print(f"Generic factory product: {product.operation()}")

if __name__ == "__main__":
    factory_method_example()
```

### 4. æŠ½è±¡å·¥å‚æ¨¡å¼ (Abstract Factory Pattern)

#### 4.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 4.1.1** (æŠ½è±¡å·¥å‚æ¨¡å¼)
æŠ½è±¡å·¥å‚æ¨¡å¼æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼š
$$F: \text{Family} \rightarrow \text{ProductFamily}$$

å…¶ä¸­ $F$ æ˜¯æŠ½è±¡å·¥å‚ï¼Œå°†äº§å“æ—æ˜ å°„åˆ°å…·ä½“äº§å“ç³»åˆ—ã€‚

#### 4.2 Pythonå®ç°

```python
from abc import ABC, abstractmethod
from typing import TypeVar, Generic, Dict, Any

T = TypeVar('T')

class AbstractProductA(ABC):
    """æŠ½è±¡äº§å“A"""
    
    @abstractmethod
    def operation_a(self) -> str:
        pass

class AbstractProductB(ABC):
    """æŠ½è±¡äº§å“B"""
    
    @abstractmethod
    def operation_b(self) -> str:
        pass

class ConcreteProductA1(AbstractProductA):
    """å…·ä½“äº§å“A1"""
    
    def operation_a(self) -> str:
        return "ConcreteProductA1 operation"

class ConcreteProductA2(AbstractProductA):
    """å…·ä½“äº§å“A2"""
    
    def operation_a(self) -> str:
        return "ConcreteProductA2 operation"

class ConcreteProductB1(AbstractProductB):
    """å…·ä½“äº§å“B1"""
    
    def operation_b(self) -> str:
        return "ConcreteProductB1 operation"

class ConcreteProductB2(AbstractProductB):
    """å…·ä½“äº§å“B2"""
    
    def operation_b(self) -> str:
        return "ConcreteProductB2 operation"

class AbstractFactory(ABC):
    """æŠ½è±¡å·¥å‚"""
    
    @abstractmethod
    def create_product_a(self) -> AbstractProductA:
        pass
    
    @abstractmethod
    def create_product_b(self) -> AbstractProductB:
        pass

class ConcreteFactory1(AbstractFactory):
    """å…·ä½“å·¥å‚1"""
    
    def create_product_a(self) -> AbstractProductA:
        return ConcreteProductA1()
    
    def create_product_b(self) -> AbstractProductB:
        return ConcreteProductB1()

class ConcreteFactory2(AbstractFactory):
    """å…·ä½“å·¥å‚2"""
    
    def create_product_a(self) -> AbstractProductA:
        return ConcreteProductA2()
    
    def create_product_b(self) -> AbstractProductB:
        return ConcreteProductB2()

# å·¥å‚æ³¨å†Œè¡¨
class FactoryRegistry:
    """å·¥å‚æ³¨å†Œè¡¨"""
    
    def __init__(self):
        self.factories: Dict[str, Type[AbstractFactory]] = {}
    
    def register_factory(self, name: str, factory_class: Type[AbstractFactory]) -> None:
        """æ³¨å†Œå·¥å‚"""
        self.factories[name] = factory_class
    
    def create_factory(self, name: str) -> AbstractFactory:
        """åˆ›å»ºå·¥å‚"""
        if name not in self.factories:
            raise ValueError(f"Unknown factory: {name}")
        
        return self.factories[name]()
    
    def get_available_factories(self) -> List[str]:
        """è·å–å¯ç”¨å·¥å‚åˆ—è¡¨"""
        return list(self.factories.keys())

# ç¤ºä¾‹ï¼šæŠ½è±¡å·¥å‚æ¨¡å¼
def abstract_factory_example():
    """æŠ½è±¡å·¥å‚æ¨¡å¼ç¤ºä¾‹"""
    print("æŠ½è±¡å·¥å‚æ¨¡å¼ç¤ºä¾‹:")
    print("=" * 50)
    
    # ä½¿ç”¨å…·ä½“å·¥å‚
    factory1 = ConcreteFactory1()
    factory2 = ConcreteFactory2()
    
    # å·¥å‚1çš„äº§å“
    product_a1 = factory1.create_product_a()
    product_b1 = factory1.create_product_b()
    
    print(f"Factory1 ProductA: {product_a1.operation_a()}")
    print(f"Factory1 ProductB: {product_b1.operation_b()}")
    
    # å·¥å‚2çš„äº§å“
    product_a2 = factory2.create_product_a()
    product_b2 = factory2.create_product_b()
    
    print(f"Factory2 ProductA: {product_a2.operation_a()}")
    print(f"Factory2 ProductB: {product_b2.operation_b()}")
    
    # ä½¿ç”¨å·¥å‚æ³¨å†Œè¡¨
    registry = FactoryRegistry()
    registry.register_factory("factory1", ConcreteFactory1)
    registry.register_factory("factory2", ConcreteFactory2)
    
    print(f"Available factories: {registry.get_available_factories()}")
    
    factory = registry.create_factory("factory1")
    product_a = factory.create_product_a()
    print(f"Registry factory ProductA: {product_a.operation_a()}")

if __name__ == "__main__":
    abstract_factory_example()
```

### 5. å»ºé€ è€…æ¨¡å¼ (Builder Pattern)

#### 5.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 5.1.1** (å»ºé€ è€…æ¨¡å¼)
å»ºé€ è€…æ¨¡å¼å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼š
$$B: \text{Steps} \rightarrow \text{Product}$$

å…¶ä¸­ $B$ æ˜¯å»ºé€ è€…ï¼Œå°†æ„å»ºæ­¥éª¤æ˜ å°„åˆ°æœ€ç»ˆäº§å“ã€‚

#### 5.2 Pythonå®ç°

```python
from abc import ABC, abstractmethod
from typing import List, Any

class Product:
    """äº§å“ç±»"""
    
    def __init__(self):
        self.parts: List[str] = []
    
    def add_part(self, part: str) -> None:
        """æ·»åŠ éƒ¨ä»¶"""
        self.parts.append(part)
    
    def list_parts(self) -> str:
        """åˆ—å‡ºæ‰€æœ‰éƒ¨ä»¶"""
        return f"Product parts: {', '.join(self.parts)}"

class Builder(ABC):
    """å»ºé€ è€…æŠ½è±¡åŸºç±»"""
    
    def __init__(self):
        self.reset()
    
    @abstractmethod
    def reset(self) -> None:
        """é‡ç½®å»ºé€ è€…"""
        pass
    
    @abstractmethod
    def build_part_a(self) -> None:
        """æ„å»ºéƒ¨ä»¶A"""
        pass
    
    @abstractmethod
    def build_part_b(self) -> None:
        """æ„å»ºéƒ¨ä»¶B"""
        pass
    
    @abstractmethod
    def build_part_c(self) -> None:
        """æ„å»ºéƒ¨ä»¶C"""
        pass

class ConcreteBuilder1(Builder):
    """å…·ä½“å»ºé€ è€…1"""
    
    def reset(self) -> None:
        self.product = Product()
    
    def build_part_a(self) -> None:
        self.product.add_part("PartA1")
    
    def build_part_b(self) -> None:
        self.product.add_part("PartB1")
    
    def build_part_c(self) -> None:
        self.product.add_part("PartC1")
    
    def get_product(self) -> Product:
        """è·å–äº§å“"""
        product = self.product
        self.reset()
        return product

class ConcreteBuilder2(Builder):
    """å…·ä½“å»ºé€ è€…2"""
    
    def reset(self) -> None:
        self.product = Product()
    
    def build_part_a(self) -> None:
        self.product.add_part("PartA2")
    
    def build_part_b(self) -> None:
        self.product.add_part("PartB2")
    
    def build_part_c(self) -> None:
        self.product.add_part("PartC2")
    
    def get_product(self) -> Product:
        """è·å–äº§å“"""
        product = self.product
        self.reset()
        return product

class Director:
    """æŒ‡å¯¼è€…"""
    
    def __init__(self):
        self.builder: Optional[Builder] = None
    
    def set_builder(self, builder: Builder) -> None:
        """è®¾ç½®å»ºé€ è€…"""
        self.builder = builder
    
    def build_minimal_viable_product(self) -> Product:
        """æ„å»ºæœ€å°å¯è¡Œäº§å“"""
        if not self.builder:
            raise ValueError("Builder not set")
        
        self.builder.reset()
        self.builder.build_part_a()
        return self.builder.get_product()
    
    def build_full_featured_product(self) -> Product:
        """æ„å»ºå®Œæ•´åŠŸèƒ½äº§å“"""
        if not self.builder:
            raise ValueError("Builder not set")
        
        self.builder.reset()
        self.builder.build_part_a()
        self.builder.build_part_b()
        self.builder.build_part_c()
        return self.builder.get_product()

# æµå¼å»ºé€ è€…
class FluentBuilder:
    """æµå¼å»ºé€ è€…"""
    
    def __init__(self):
        self.product = Product()
    
    def add_part_a(self) -> 'FluentBuilder':
        """æ·»åŠ éƒ¨ä»¶A"""
        self.product.add_part("PartA")
        return self
    
    def add_part_b(self) -> 'FluentBuilder':
        """æ·»åŠ éƒ¨ä»¶B"""
        self.product.add_part("PartB")
        return self
    
    def add_part_c(self) -> 'FluentBuilder':
        """æ·»åŠ éƒ¨ä»¶C"""
        self.product.add_part("PartC")
        return self
    
    def build(self) -> Product:
        """æ„å»ºäº§å“"""
        return self.product

# ç¤ºä¾‹ï¼šå»ºé€ è€…æ¨¡å¼
def builder_example():
    """å»ºé€ è€…æ¨¡å¼ç¤ºä¾‹"""
    print("å»ºé€ è€…æ¨¡å¼ç¤ºä¾‹:")
    print("=" * 50)
    
    director = Director()
    
    # ä½¿ç”¨å»ºé€ è€…1
    builder1 = ConcreteBuilder1()
    director.set_builder(builder1)
    
    print("æ„å»ºæœ€å°å¯è¡Œäº§å“:")
    minimal_product = director.build_minimal_viable_product()
    print(f"  {minimal_product.list_parts()}")
    
    print("æ„å»ºå®Œæ•´åŠŸèƒ½äº§å“:")
    full_product = director.build_full_featured_product()
    print(f"  {full_product.list_parts()}")
    
    # ä½¿ç”¨å»ºé€ è€…2
    builder2 = ConcreteBuilder2()
    director.set_builder(builder2)
    
    print("ä½¿ç”¨å»ºé€ è€…2æ„å»ºå®Œæ•´äº§å“:")
    full_product2 = director.build_full_featured_product()
    print(f"  {full_product2.list_parts()}")
    
    # ä½¿ç”¨æµå¼å»ºé€ è€…
    print("ä½¿ç”¨æµå¼å»ºé€ è€…:")
    fluent_builder = FluentBuilder()
    fluent_product = fluent_builder.add_part_a().add_part_b().add_part_c().build()
    print(f"  {fluent_product.list_parts()}")

if __name__ == "__main__":
    builder_example()
```

### 6. åŸå‹æ¨¡å¼ (Prototype Pattern)

#### 6.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 6.1.1** (åŸå‹æ¨¡å¼)
åŸå‹æ¨¡å¼ç”¨åŸå‹å®ä¾‹æŒ‡å®šåˆ›å»ºå¯¹è±¡çš„ç§ç±»ï¼Œå¹¶ä¸”é€šè¿‡æ‹·è´è¿™äº›åŸå‹åˆ›å»ºæ–°çš„å¯¹è±¡ï¼š
$$P: \text{Prototype} \rightarrow \text{Clone}$$

å…¶ä¸­ $P$ æ˜¯åŸå‹å‡½æ•°ï¼Œå°†åŸå‹æ˜ å°„åˆ°å…‹éš†å¯¹è±¡ã€‚

#### 6.2 Pythonå®ç°

```python
import copy
from abc import ABC, abstractmethod
from typing import Dict, Any

class Prototype(ABC):
    """åŸå‹æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def clone(self) -> 'Prototype':
        pass

class ConcretePrototype1(Prototype):
    """å…·ä½“åŸå‹1"""
    
    def __init__(self, data: Dict[str, Any]):
        self.data = data
    
    def clone(self) -> 'ConcretePrototype1':
        """æµ…æ‹·è´"""
        return copy.copy(self)
    
    def deep_clone(self) -> 'ConcretePrototype1':
        """æ·±æ‹·è´"""
        return copy.deepcopy(self)
    
    def __str__(self) -> str:
        return f"ConcretePrototype1(data={self.data})"

class ConcretePrototype2(Prototype):
    """å…·ä½“åŸå‹2"""
    
    def __init__(self, value: int, message: str):
        self.value = value
        self.message = message
    
    def clone(self) -> 'ConcretePrototype2':
        """æµ…æ‹·è´"""
        return copy.copy(self)
    
    def deep_clone(self) -> 'ConcretePrototype2':
        """æ·±æ‹·è´"""
        return copy.deepcopy(self)
    
    def __str__(self) -> str:
        return f"ConcretePrototype2(value={self.value}, message='{self.message}')"

class PrototypeRegistry:
    """åŸå‹æ³¨å†Œè¡¨"""
    
    def __init__(self):
        self.prototypes: Dict[str, Prototype] = {}
    
    def register_prototype(self, name: str, prototype: Prototype) -> None:
        """æ³¨å†ŒåŸå‹"""
        self.prototypes[name] = prototype
    
    def create_prototype(self, name: str) -> Prototype:
        """åˆ›å»ºåŸå‹"""
        if name not in self.prototypes:
            raise ValueError(f"Prototype {name} not found")
        
        return self.prototypes[name].clone()
    
    def get_available_prototypes(self) -> List[str]:
        """è·å–å¯ç”¨åŸå‹åˆ—è¡¨"""
        return list(self.prototypes.keys())

# ç¤ºä¾‹ï¼šåŸå‹æ¨¡å¼
def prototype_example():
    """åŸå‹æ¨¡å¼ç¤ºä¾‹"""
    print("åŸå‹æ¨¡å¼ç¤ºä¾‹:")
    print("=" * 50)
    
    # åˆ›å»ºåŸå‹
    prototype1 = ConcretePrototype1({"key1": "value1", "key2": [1, 2, 3]})
    prototype2 = ConcretePrototype2(42, "Hello, Prototype!")
    
    print("åŸå§‹åŸå‹:")
    print(f"  {prototype1}")
    print(f"  {prototype2}")
    
    # æµ…æ‹·è´
    clone1 = prototype1.clone()
    clone2 = prototype2.clone()
    
    print("\næµ…æ‹·è´:")
    print(f"  {clone1}")
    print(f"  {clone2}")
    
    # ä¿®æ”¹åŸå§‹å¯¹è±¡
    prototype1.data["key1"] = "modified"
    prototype1.data["key2"].append(4)
    prototype2.value = 100
    
    print("\nä¿®æ”¹åŸå§‹å¯¹è±¡å:")
    print(f"  åŸå§‹: {prototype1}")
    print(f"  æµ…æ‹·è´: {clone1}")
    print(f"  åŸå§‹: {prototype2}")
    print(f"  æµ…æ‹·è´: {clone2}")
    
    # æ·±æ‹·è´
    deep_clone1 = prototype1.deep_clone()
    deep_clone2 = prototype2.deep_clone()
    
    print("\næ·±æ‹·è´:")
    print(f"  {deep_clone1}")
    print(f"  {deep_clone2}")
    
    # åŸå‹æ³¨å†Œè¡¨
    registry = PrototypeRegistry()
    registry.register_prototype("prototype1", prototype1)
    registry.register_prototype("prototype2", prototype2)
    
    print("\nä½¿ç”¨åŸå‹æ³¨å†Œè¡¨:")
    new_prototype1 = registry.create_prototype("prototype1")
    new_prototype2 = registry.create_prototype("prototype2")
    
    print(f"  {new_prototype1}")
    print(f"  {new_prototype2}")

if __name__ == "__main__":
    prototype_example()
```

## ğŸ“š ç†è®ºè¯æ˜

### 1. å•ä¾‹æ¨¡å¼å”¯ä¸€æ€§å®šç†

**å®šç† 1.1** (å•ä¾‹å”¯ä¸€æ€§)
å¦‚æœç±» $C$ æ­£ç¡®å®ç°å•ä¾‹æ¨¡å¼ï¼Œåˆ™ $C$ çš„æ‰€æœ‰å®ä¾‹éƒ½ç›¸ç­‰ã€‚

**è¯æ˜**ï¼š
1. è®¾ $x, y$ æ˜¯ $C$ çš„ä»»æ„ä¸¤ä¸ªå®ä¾‹
2. æ ¹æ®å•ä¾‹æ¨¡å¼çš„å®ç°ï¼Œ$x$ å’Œ $y$ æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡
3. å› æ­¤ $x = y$
4. æ‰€ä»¥å•ä¾‹æ¨¡å¼ä¿è¯äº†å®ä¾‹çš„å”¯ä¸€æ€§

### 2. å·¥å‚æ–¹æ³•æ¨¡å¼æ­£ç¡®æ€§å®šç†

**å®šç† 2.1** (å·¥å‚æ–¹æ³•æ­£ç¡®æ€§)
å¦‚æœå·¥å‚æ–¹æ³• $F$ æ­£ç¡®å®ç°ï¼Œåˆ™ $F$ åˆ›å»ºçš„å¯¹è±¡æ»¡è¶³äº§å“æ¥å£ã€‚

**è¯æ˜**ï¼š
1. å·¥å‚æ–¹æ³•è¿”å›å…·ä½“äº§å“ç±»
2. å…·ä½“äº§å“ç±»å®ç°äº†äº§å“æ¥å£
3. å› æ­¤å·¥å‚æ–¹æ³•åˆ›å»ºçš„å¯¹è±¡æ»¡è¶³äº§å“æ¥å£

## ğŸ”— ç›¸å…³æ¦‚å¿µ

- [ç»“æ„å‹æ¨¡å¼](../02-ç»“æ„å‹æ¨¡å¼/00-ç»“æ„å‹æ¨¡å¼.md)
- [è¡Œä¸ºå‹æ¨¡å¼](../03-è¡Œä¸ºå‹æ¨¡å¼/00-è¡Œä¸ºå‹æ¨¡å¼.md)
- [è®¾è®¡æ¨¡å¼ç†è®ºåŸºç¡€](../../02-ç†è®ºåŸºç¡€/01-è®¾è®¡æ¨¡å¼ç†è®º/00-è®¾è®¡æ¨¡å¼ç†è®ºåŸºç¡€.md)

## ğŸ“– å‚è€ƒæ–‡çŒ®

1. Gamma, E., Helm, R., Johnson, R., & Vlissides, J. (1994). Design Patterns
2. Freeman, E., Robson, E., Sierra, K., & Bates, B. (2004). Head First Design Patterns
3. Larman, C. (2004). Applying UML and Patterns
4. Martin, R. C. (2000). Design Principles and Design Patterns

---

*åˆ›å»ºå‹æ¨¡å¼ä¸ºå¯¹è±¡åˆ›å»ºæä¾›äº†çµæ´»è€Œå¼ºå¤§çš„æœºåˆ¶ï¼Œæ˜¯è½¯ä»¶è®¾è®¡ä¸­ä¸å¯æˆ–ç¼ºçš„é‡è¦æ¨¡å¼ã€‚*
