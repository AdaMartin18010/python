# 03-01-03 è¡Œä¸ºå‹æ¨¡å¼

## ğŸ“‹ æ¦‚è¿°

è¡Œä¸ºå‹æ¨¡å¼å…³æ³¨å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ï¼Œæè¿°å¯¹è±¡å¦‚ä½•åä½œä»¥åŠèŒè´£å¦‚ä½•åˆ†é…ã€‚æœ¬æ–‡æ¡£ä»å½¢å¼åŒ–è§’åº¦é˜è¿°è¡Œä¸ºå‹æ¨¡å¼çš„æ ¸å¿ƒæ¦‚å¿µï¼Œæä¾›ä¸¥æ ¼çš„æ•°å­¦å®šä¹‰å’Œè¯æ˜ï¼Œå¹¶é€šè¿‡Pythonä»£ç å®ç°ç›¸å…³æ¨¡å¼ã€‚

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### 1. è§‚å¯Ÿè€…æ¨¡å¼ (Observer Pattern)

#### 1.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 1.1** (è§‚å¯Ÿè€…æ¨¡å¼)
è§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰å¯¹è±¡é—´çš„ä¸€å¯¹å¤šä¾èµ–å…³ç³»ã€‚å½¢å¼åŒ–å®šä¹‰ä¸ºï¼š
$$O: \text{Subject} \times \text{Observer} \rightarrow \text{Notification}$$
å…¶ä¸­ $O$ æ˜¯è§‚å¯Ÿè€…å…³ç³»ï¼Œ$\text{Subject}$ æ˜¯ä¸»é¢˜é›†åˆï¼Œ$\text{Observer}$ æ˜¯è§‚å¯Ÿè€…é›†åˆã€‚

**å®šä¹‰ 1.2** (é€šçŸ¥æœºåˆ¶)
é€šçŸ¥æœºåˆ¶æ»¡è¶³ï¼š
$$\forall s \in \text{Subject}, o \in \text{Observer}: s \text{ çŠ¶æ€æ”¹å˜} \Rightarrow O(s, o) \text{ è¢«è°ƒç”¨}$$

#### 1.2 è§‚å¯Ÿè€…æ¨¡å¼å®šç†

**å®šç† 1.1** (è§‚å¯Ÿè€…æ­£ç¡®æ€§)
å¦‚æœè§‚å¯Ÿè€…æ¨¡å¼æ­£ç¡®å®ç°ï¼Œåˆ™ä¸»é¢˜çŠ¶æ€æ”¹å˜æ—¶æ‰€æœ‰è§‚å¯Ÿè€…éƒ½ä¼šè¢«é€šçŸ¥ã€‚

**è¯æ˜**:
1. è®¾ $s$ æ˜¯ä¸»é¢˜ï¼Œ$O_s$ æ˜¯ $s$ çš„è§‚å¯Ÿè€…é›†åˆ
2. å½“ $s$ çŠ¶æ€æ”¹å˜æ—¶ï¼Œéå† $O_s$ ä¸­çš„æ¯ä¸ªè§‚å¯Ÿè€…
3. å¯¹æ¯ä¸ªè§‚å¯Ÿè€… $o$ï¼Œè°ƒç”¨ $O(s, o)$
4. å› æ­¤æ‰€æœ‰è§‚å¯Ÿè€…éƒ½è¢«é€šçŸ¥

### 2. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)

#### 2.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 2.1** (ç­–ç•¥æ¨¡å¼)
ç­–ç•¥æ¨¡å¼å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œä½¿å®ƒä»¬å¯ä»¥äº’ç›¸æ›¿æ¢ã€‚å½¢å¼åŒ–å®šä¹‰ä¸ºï¼š
$$S: \text{Context} \times \text{Strategy} \rightarrow \text{Result}$$
å…¶ä¸­ $S$ æ˜¯ç­–ç•¥æ‰§è¡Œï¼Œ$\text{Context}$ æ˜¯ä¸Šä¸‹æ–‡é›†åˆï¼Œ$\text{Strategy}$ æ˜¯ç­–ç•¥é›†åˆã€‚

**å®šä¹‰ 2.2** (ç­–ç•¥å¯æ›¿æ¢æ€§)
ç­–ç•¥çš„å¯æ›¿æ¢æ€§æ¡ä»¶ï¼š
$$\forall c \in \text{Context}, s_1, s_2 \in \text{Strategy}: \text{Compatible}(s_1, s_2) \Rightarrow S(c, s_1) \equiv S(c, s_2)$$

#### 2.2 ç­–ç•¥æ¨¡å¼å®šç†

**å®šç† 2.1** (ç­–ç•¥å¯æ›¿æ¢æ€§)
å¦‚æœç­–ç•¥ $s_1$ å’Œ $s_2$ å…¼å®¹ï¼Œåˆ™å®ƒä»¬åœ¨ç›¸åŒä¸Šä¸‹æ–‡ä¸­äº§ç”Ÿç­‰ä»·ç»“æœã€‚

**è¯æ˜**:
1. è®¾ $c$ æ˜¯ä»»æ„ä¸Šä¸‹æ–‡
2. æ ¹æ®ç­–ç•¥å®šä¹‰ï¼Œ$S(c, s_1)$ å’Œ $S(c, s_2)$ éƒ½æ˜¯æœ‰æ•ˆç»“æœ
3. æ ¹æ®å…¼å®¹æ€§æ¡ä»¶ï¼Œ$s_1$ å’Œ $s_2$ å…¼å®¹
4. å› æ­¤ $S(c, s_1) \equiv S(c, s_2)$

### 3. å‘½ä»¤æ¨¡å¼ (Command Pattern)

#### 3.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 3.1** (å‘½ä»¤æ¨¡å¼)
å‘½ä»¤æ¨¡å¼å°†è¯·æ±‚å°è£…ä¸ºå¯¹è±¡ã€‚å½¢å¼åŒ–å®šä¹‰ä¸ºï¼š
$$C: \text{Command} \rightarrow \text{Action}$$
å…¶ä¸­ $C$ æ˜¯å‘½ä»¤æ‰§è¡Œï¼Œ$\text{Command}$ æ˜¯å‘½ä»¤é›†åˆï¼Œ$\text{Action}$ æ˜¯åŠ¨ä½œé›†åˆã€‚

**å®šä¹‰ 3.2** (å‘½ä»¤å¯æ’¤é”€æ€§)
å‘½ä»¤çš„å¯æ’¤é”€æ€§æ¡ä»¶ï¼š
$$\forall cmd \in \text{Command}: \exists cmd^{-1} \in \text{Command}: C(cmd^{-1}) = C(cmd)^{-1}$$

#### 3.2 å‘½ä»¤æ¨¡å¼å®šç†

**å®šç† 3.1** (å‘½ä»¤å¯æ’¤é”€æ€§)
å¦‚æœå‘½ä»¤ $cmd$ å¯æ’¤é”€ï¼Œåˆ™å­˜åœ¨é€†å‘½ä»¤ $cmd^{-1}$ èƒ½å¤Ÿæ’¤é”€ $cmd$ çš„æ•ˆæœã€‚

**è¯æ˜**:
1. è®¾ $cmd$ æ˜¯å¯æ’¤é”€å‘½ä»¤
2. æ ¹æ®å¯æ’¤é”€æ€§æ¡ä»¶ï¼Œå­˜åœ¨ $cmd^{-1}$
3. æ‰§è¡Œ $C(cmd^{-1})$ äº§ç”Ÿ $C(cmd)^{-1}$
4. å› æ­¤ $cmd$ çš„æ•ˆæœè¢«æ’¤é”€

## ğŸ Pythonå®ç°

### 1. è§‚å¯Ÿè€…æ¨¡å¼å®ç°

```python
from abc import ABC, abstractmethod
from typing import List, Dict, Any, Callable
from dataclasses import dataclass
from enum import Enum

class Subject(ABC):
    """ä¸»é¢˜æŠ½è±¡åŸºç±»"""
    
    def __init__(self):
        self._observers: List[Observer] = []
        self._state: Any = None
    
    def attach(self, observer: 'Observer') -> None:
        """æ·»åŠ è§‚å¯Ÿè€…"""
        if observer not in self._observers:
            self._observers.append(observer)
    
    def detach(self, observer: 'Observer') -> None:
        """ç§»é™¤è§‚å¯Ÿè€…"""
        if observer in self._observers:
            self._observers.remove(observer)
    
    def notify(self) -> None:
        """é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…"""
        for observer in self._observers:
            observer.update(self._state)
    
    @property
    def state(self) -> Any:
        return self._state
    
    @state.setter
    def state(self, value: Any) -> None:
        self._state = value
        self.notify()

class Observer(ABC):
    """è§‚å¯Ÿè€…æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def update(self, state: Any) -> None:
        """æ›´æ–°æ–¹æ³•"""
        pass

class ConcreteSubject(Subject):
    """å…·ä½“ä¸»é¢˜"""
    
    def __init__(self, name: str):
        super().__init__()
        self.name = name

class ConcreteObserver(Observer):
    """å…·ä½“è§‚å¯Ÿè€…"""
    
    def __init__(self, name: str):
        self.name = name
    
    def update(self, state: Any) -> None:
        print(f"è§‚å¯Ÿè€… {self.name} æ”¶åˆ°é€šçŸ¥: çŠ¶æ€ = {state}")

# ä½¿ç”¨ç¤ºä¾‹
def demonstrate_observer_pattern():
    """æ¼”ç¤ºè§‚å¯Ÿè€…æ¨¡å¼"""
    
    # åˆ›å»ºä¸»é¢˜å’Œè§‚å¯Ÿè€…
    subject = ConcreteSubject("æ•°æ®æº")
    observer1 = ConcreteObserver("æ—¥å¿—è®°å½•å™¨")
    observer2 = ConcreteObserver("æ•°æ®éªŒè¯å™¨")
    observer3 = ConcreteObserver("ç»Ÿè®¡åˆ†æå™¨")
    
    # æ·»åŠ è§‚å¯Ÿè€…
    subject.attach(observer1)
    subject.attach(observer2)
    subject.attach(observer3)
    
    # æ”¹å˜çŠ¶æ€ï¼Œè§¦å‘é€šçŸ¥
    subject.state = "æ–°æ•°æ®"
    
    # ç§»é™¤ä¸€ä¸ªè§‚å¯Ÿè€…
    subject.detach(observer2)
    
    # å†æ¬¡æ”¹å˜çŠ¶æ€
    subject.state = "æ›´æ–°æ•°æ®"
    
    return subject, [observer1, observer2, observer3]
```

### 2. ç­–ç•¥æ¨¡å¼å®ç°

```python
from abc import ABC, abstractmethod
from typing import List, Any
from dataclasses import dataclass

class Strategy(ABC):
    """ç­–ç•¥æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def execute(self, data: List[Any]) -> Any:
        """æ‰§è¡Œç­–ç•¥"""
        pass

class BubbleSortStrategy(Strategy):
    """å†’æ³¡æ’åºç­–ç•¥"""
    
    def execute(self, data: List[Any]) -> List[Any]:
        result = data.copy()
        n = len(result)
        for i in range(n):
            for j in range(0, n - i - 1):
                if result[j] > result[j + 1]:
                    result[j], result[j + 1] = result[j + 1], result[j]
        return result

class QuickSortStrategy(Strategy):
    """å¿«é€Ÿæ’åºç­–ç•¥"""
    
    def execute(self, data: List[Any]) -> List[Any]:
        if len(data) <= 1:
            return data
        pivot = data[len(data) // 2]
        left = [x for x in data if x < pivot]
        middle = [x for x in data if x == pivot]
        right = [x for x in data if x > pivot]
        return self.execute(left) + middle + self.execute(right)

class MergeSortStrategy(Strategy):
    """å½’å¹¶æ’åºç­–ç•¥"""
    
    def execute(self, data: List[Any]) -> List[Any]:
        if len(data) <= 1:
            return data
        mid = len(data) // 2
        left = self.execute(data[:mid])
        right = self.execute(data[mid:])
        return self._merge(left, right)
    
    def _merge(self, left: List[Any], right: List[Any]) -> List[Any]:
        result = []
        i = j = 0
        while i < len(left) and j < len(right):
            if left[i] <= right[j]:
                result.append(left[i])
                i += 1
            else:
                result.append(right[j])
                j += 1
        result.extend(left[i:])
        result.extend(right[j:])
        return result

class Context:
    """ä¸Šä¸‹æ–‡ç±»"""
    
    def __init__(self, strategy: Strategy):
        self._strategy = strategy
    
    def set_strategy(self, strategy: Strategy) -> None:
        """è®¾ç½®ç­–ç•¥"""
        self._strategy = strategy
    
    def execute_strategy(self, data: List[Any]) -> Any:
        """æ‰§è¡Œç­–ç•¥"""
        return self._strategy.execute(data)

# ä½¿ç”¨ç¤ºä¾‹
def demonstrate_strategy_pattern():
    """æ¼”ç¤ºç­–ç•¥æ¨¡å¼"""
    
    data = [64, 34, 25, 12, 22, 11, 90]
    
    # ä½¿ç”¨ä¸åŒç­–ç•¥
    strategies = {
        "å†’æ³¡æ’åº": BubbleSortStrategy(),
        "å¿«é€Ÿæ’åº": QuickSortStrategy(),
        "å½’å¹¶æ’åº": MergeSortStrategy()
    }
    
    context = Context(BubbleSortStrategy())
    
    for name, strategy in strategies.items():
        context.set_strategy(strategy)
        result = context.execute_strategy(data)
        print(f"{name}: {result}")
    
    return context, strategies
```

### 3. å‘½ä»¤æ¨¡å¼å®ç°

```python
from abc import ABC, abstractmethod
from typing import List, Any, Dict
from dataclasses import dataclass
from enum import Enum

class Command(ABC):
    """å‘½ä»¤æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def execute(self) -> None:
        """æ‰§è¡Œå‘½ä»¤"""
        pass
    
    @abstractmethod
    def undo(self) -> None:
        """æ’¤é”€å‘½ä»¤"""
        pass

class Light:
    """ç¯ç±»"""
    
    def __init__(self, location: str):
        self.location = location
        self.is_on = False
    
    def turn_on(self) -> None:
        self.is_on = True
        print(f"{self.location} ç¯å·²æ‰“å¼€")
    
    def turn_off(self) -> None:
        self.is_on = False
        print(f"{self.location} ç¯å·²å…³é—­")

class LightOnCommand(Command):
    """å¼€ç¯å‘½ä»¤"""
    
    def __init__(self, light: Light):
        self.light = light
    
    def execute(self) -> None:
        self.light.turn_on()
    
    def undo(self) -> None:
        self.light.turn_off()

class LightOffCommand(Command):
    """å…³ç¯å‘½ä»¤"""
    
    def __init__(self, light: Light):
        self.light = light
    
    def execute(self) -> None:
        self.light.turn_off()
    
    def undo(self) -> None:
        self.light.turn_on()

class RemoteControl:
    """é¥æ§å™¨ç±»"""
    
    def __init__(self):
        self.commands: Dict[int, Command] = {}
        self.undo_stack: List[Command] = []
    
    def set_command(self, slot: int, command: Command) -> None:
        """è®¾ç½®å‘½ä»¤"""
        self.commands[slot] = command
    
    def press_button(self, slot: int) -> None:
        """æŒ‰ä¸‹æŒ‰é’®"""
        if slot in self.commands:
            command = self.commands[slot]
            command.execute()
            self.undo_stack.append(command)
    
    def press_undo(self) -> None:
        """æ’¤é”€æŒ‰é’®"""
        if self.undo_stack:
            command = self.undo_stack.pop()
            command.undo()

# ä½¿ç”¨ç¤ºä¾‹
def demonstrate_command_pattern():
    """æ¼”ç¤ºå‘½ä»¤æ¨¡å¼"""
    
    # åˆ›å»ºè®¾å¤‡
    living_room_light = Light("å®¢å…")
    kitchen_light = Light("å¨æˆ¿")
    
    # åˆ›å»ºå‘½ä»¤
    living_room_on = LightOnCommand(living_room_light)
    living_room_off = LightOffCommand(living_room_light)
    kitchen_on = LightOnCommand(kitchen_light)
    kitchen_off = LightOffCommand(kitchen_light)
    
    # åˆ›å»ºé¥æ§å™¨
    remote = RemoteControl()
    remote.set_command(0, living_room_on)
    remote.set_command(1, living_room_off)
    remote.set_command(2, kitchen_on)
    remote.set_command(3, kitchen_off)
    
    # æ‰§è¡Œå‘½ä»¤
    print("æ‰§è¡Œå‘½ä»¤:")
    remote.press_button(0)  # å¼€å®¢å…ç¯
    remote.press_button(2)  # å¼€å¨æˆ¿ç¯
    remote.press_button(1)  # å…³å®¢å…ç¯
    
    print("\næ’¤é”€å‘½ä»¤:")
    remote.press_undo()  # æ’¤é”€å…³å®¢å…ç¯
    remote.press_undo()  # æ’¤é”€å¼€å¨æˆ¿ç¯
    
    return remote, [living_room_light, kitchen_light]
```

## ğŸ“Š æ•°å­¦è¯æ˜

### 1. è¡Œä¸ºå‹æ¨¡å¼ç»„åˆå®šç†

**å®šç† 1.1** (è¡Œä¸ºå‹æ¨¡å¼ç»„åˆ)
å¦‚æœæ¨¡å¼ $P_1$ å’Œ $P_2$ éƒ½æ˜¯è¡Œä¸ºå‹æ¨¡å¼ï¼Œåˆ™å®ƒä»¬çš„ç»„åˆ $P_1 \circ P_2$ ä¹Ÿæ˜¯è¡Œä¸ºå‹æ¨¡å¼ã€‚

**è¯æ˜**:
1. è®¾ $P_1$ å’Œ $P_2$ éƒ½æ˜¯è¡Œä¸ºå‹æ¨¡å¼
2. æ ¹æ®è¡Œä¸ºå‹æ¨¡å¼å®šä¹‰ï¼Œå®ƒä»¬éƒ½ä¸“æ³¨äºå¯¹è±¡é—´é€šä¿¡
3. ç»„åˆ $P_1 \circ P_2$ ä»ç„¶ä¸“æ³¨äºé€šä¿¡æœºåˆ¶
4. å› æ­¤ $P_1 \circ P_2$ æ˜¯è¡Œä¸ºå‹æ¨¡å¼

### 2. è§‚å¯Ÿè€…æ¨¡å¼æ­£ç¡®æ€§å®šç†

**å®šç† 1.2** (è§‚å¯Ÿè€…æ­£ç¡®æ€§)
å¦‚æœè§‚å¯Ÿè€…æ¨¡å¼æ­£ç¡®å®ç°ï¼Œåˆ™ä¸»é¢˜çŠ¶æ€æ”¹å˜æ—¶æ‰€æœ‰è§‚å¯Ÿè€…éƒ½ä¼šè¢«é€šçŸ¥ã€‚

**è¯æ˜**:
1. è®¾ $s$ æ˜¯ä¸»é¢˜ï¼Œ$O_s$ æ˜¯ $s$ çš„è§‚å¯Ÿè€…é›†åˆ
2. å½“ $s$ çŠ¶æ€æ”¹å˜æ—¶ï¼Œéå† $O_s$ ä¸­çš„æ¯ä¸ªè§‚å¯Ÿè€…
3. å¯¹æ¯ä¸ªè§‚å¯Ÿè€… $o$ï¼Œè°ƒç”¨ $O(s, o)$
4. å› æ­¤æ‰€æœ‰è§‚å¯Ÿè€…éƒ½è¢«é€šçŸ¥

## ğŸ”— ç›¸å…³æ¦‚å¿µ

- [åˆ›å»ºå‹æ¨¡å¼](./03-01-01-åˆ›å»ºå‹æ¨¡å¼.md)
- [ç»“æ„å‹æ¨¡å¼](./03-01-02-ç»“æ„å‹æ¨¡å¼.md)
- [è®¾è®¡æ¨¡å¼ç†è®º](../03-01-è®¾è®¡æ¨¡å¼/README.md)
- [è½¯ä»¶æ¶æ„ç†è®º](../03-02-è½¯ä»¶æ¶æ„/README.md)

## ğŸ“š å‚è€ƒæ–‡çŒ®

1. Gamma, E., Helm, R., Johnson, R., & Vlissides, J. (1994). Design Patterns: Elements of Reusable Object-Oriented Software
2. Freeman, E., Robson, E., Sierra, K., & Bates, B. (2004). Head First Design Patterns
3. Larman, C. (2004). Applying UML and Patterns: An Introduction to Object-Oriented Analysis and Design and Iterative Development
4. Martin, R. C. (2000). Design Principles and Design Patterns

---

*è¡Œä¸ºå‹æ¨¡å¼ä¸ºè½¯ä»¶è®¾è®¡æä¾›äº†çµæ´»çš„å¯¹è±¡é—´é€šä¿¡æœºåˆ¶ï¼Œé€šè¿‡å½¢å¼åŒ–çš„æ•°å­¦å®šä¹‰å’Œä¸¥æ ¼çš„è¯æ˜ï¼Œæˆ‘ä»¬å»ºç«‹äº†è¡Œä¸ºå‹æ¨¡å¼çš„å®Œæ•´ç†è®ºä½“ç³»ã€‚* 