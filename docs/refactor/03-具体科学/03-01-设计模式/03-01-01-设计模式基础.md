# è®¾è®¡æ¨¡å¼åŸºç¡€

## ğŸ“‹ æ¦‚è¿°

è®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­è§£å†³å¸¸è§è®¾è®¡é—®é¢˜çš„æ ‡å‡†è§£å†³æ–¹æ¡ˆã€‚æœ¬æ–‡æ¡£ä»å½¢å¼åŒ–è§’åº¦å®šä¹‰è®¾è®¡æ¨¡å¼çš„ç†è®ºæ¡†æ¶ï¼Œå¹¶æä¾›å®Œæ•´çš„Pythonå®ç°ã€‚

## 1. å½¢å¼åŒ–å®šä¹‰

### 1.1 è®¾è®¡æ¨¡å¼çš„åŸºæœ¬æ¦‚å¿µ

**å®šä¹‰ 1.1** (è®¾è®¡æ¨¡å¼)
è®¾è®¡æ¨¡å¼æ˜¯ä¸€ä¸ªäº”å…ƒç»„ $(N, P, S, C, E)$ï¼Œå…¶ä¸­ï¼š

- $N$ æ˜¯æ¨¡å¼åç§° (Name)
- $P$ æ˜¯é—®é¢˜æè¿° (Problem)
- $S$ æ˜¯è§£å†³æ–¹æ¡ˆ (Solution)
- $C$ æ˜¯åæœ (Consequences)
- $E$ æ˜¯ç¤ºä¾‹ (Examples)

**å®šä¹‰ 1.2** (æ¨¡å¼åˆ†ç±»)
è®¾è®¡æ¨¡å¼æŒ‰ç›®çš„åˆ†ä¸ºä¸‰ç±»ï¼š

1. **åˆ›å»ºå‹æ¨¡å¼** (Creational Patterns): å¤„ç†å¯¹è±¡åˆ›å»º
2. **ç»“æ„å‹æ¨¡å¼** (Structural Patterns): å¤„ç†å¯¹è±¡ç»„åˆ
3. **è¡Œä¸ºå‹æ¨¡å¼** (Behavioral Patterns): å¤„ç†å¯¹è±¡é€šä¿¡

**å®šä¹‰ 1.3** (æ¨¡å¼å…³ç³»)
æ¨¡å¼å…³ç³»æ˜¯ä¸€ä¸ªæœ‰å‘å›¾ $G = (V, E)$ï¼Œå…¶ä¸­ï¼š

- $V$ æ˜¯æ¨¡å¼é›†åˆ
- $E$ æ˜¯æ¨¡å¼é—´çš„ä¾èµ–å…³ç³»

### 1.2 æ¨¡å¼åº”ç”¨åŸåˆ™

**åŸåˆ™ 1.1** (å¼€é—­åŸåˆ™)
è½¯ä»¶å®ä½“åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚

**åŸåˆ™ 1.2** (é‡Œæ°æ›¿æ¢åŸåˆ™)
å­ç±»å¯¹è±¡åº”è¯¥èƒ½å¤Ÿæ›¿æ¢çˆ¶ç±»å¯¹è±¡ã€‚

**åŸåˆ™ 1.3** (ä¾èµ–å€’ç½®åŸåˆ™)
é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚

**åŸåˆ™ 1.4** (æ¥å£éš”ç¦»åŸåˆ™)
å®¢æˆ·ç«¯ä¸åº”è¯¥è¢«è¿«ä¾èµ–å®ƒä¸ä½¿ç”¨çš„æ¥å£ã€‚

**åŸåˆ™ 1.5** (å•ä¸€èŒè´£åŸåˆ™)
ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ã€‚

**åŸåˆ™ 1.6** (è¿ªç±³ç‰¹æ³•åˆ™)
ä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡ä¿æŒæœ€å°‘çš„äº†è§£ã€‚

## 2. æ¨¡å¼åˆ†ç±»ä½“ç³»

### 2.1 åˆ›å»ºå‹æ¨¡å¼

**å®šä¹‰ 2.1** (åˆ›å»ºå‹æ¨¡å¼)
åˆ›å»ºå‹æ¨¡å¼å¤„ç†å¯¹è±¡åˆ›å»ºæœºåˆ¶ï¼Œè¯•å›¾åœ¨é€‚åˆç‰¹å®šæƒ…å†µçš„åœºæ™¯ä¸‹åˆ›å»ºå¯¹è±¡ã€‚

**å®šç† 2.1** (åˆ›å»ºå‹æ¨¡å¼å­˜åœ¨æ€§)
å¯¹äºä»»æ„å¯¹è±¡åˆ›å»ºéœ€æ±‚ï¼Œéƒ½å­˜åœ¨è‡³å°‘ä¸€ä¸ªåˆ›å»ºå‹æ¨¡å¼å¯ä»¥æ»¡è¶³è¯¥éœ€æ±‚ã€‚

**è¯æ˜**:
è®¾ $O$ æ˜¯éœ€è¦åˆ›å»ºçš„å¯¹è±¡ï¼Œ$C$ æ˜¯åˆ›å»ºæ¡ä»¶é›†åˆã€‚
æ ¹æ®å¯¹è±¡åˆ›å»ºçš„å¤æ‚æ€§ï¼Œå¯ä»¥æ„é€ ç›¸åº”çš„åˆ›å»ºå‹æ¨¡å¼ï¼š

1. ç®€å•å¯¹è±¡ï¼šä½¿ç”¨ç®€å•å·¥å‚æ¨¡å¼
2. å¤æ‚å¯¹è±¡ï¼šä½¿ç”¨å»ºé€ è€…æ¨¡å¼
3. å•ä¾‹å¯¹è±¡ï¼šä½¿ç”¨å•ä¾‹æ¨¡å¼
4. åŸå‹å¯¹è±¡ï¼šä½¿ç”¨åŸå‹æ¨¡å¼
5. æŠ½è±¡å¯¹è±¡ï¼šä½¿ç”¨æŠ½è±¡å·¥å‚æ¨¡å¼

å› æ­¤ï¼Œåˆ›å»ºå‹æ¨¡å¼æ˜¯å®Œå¤‡çš„ã€‚$\square$

### 2.2 ç»“æ„å‹æ¨¡å¼

**å®šä¹‰ 2.2** (ç»“æ„å‹æ¨¡å¼)
ç»“æ„å‹æ¨¡å¼å¤„ç†ç±»å’Œå¯¹è±¡çš„ç»„åˆï¼Œé€šè¿‡ç»§æ‰¿å’Œç»„åˆè·å¾—æ–°åŠŸèƒ½ã€‚

**å®šç† 2.2** (ç»“æ„å‹æ¨¡å¼ç»„åˆæ€§)
ä»»æ„ä¸¤ä¸ªç»“æ„å‹æ¨¡å¼å¯ä»¥ç»„åˆå½¢æˆæ–°çš„ç»“æ„å‹æ¨¡å¼ã€‚

**è¯æ˜**:
è®¾ $P_1$ å’Œ $P_2$ æ˜¯ä¸¤ä¸ªç»“æ„å‹æ¨¡å¼ï¼Œå…¶ç»“æ„åˆ†åˆ«ä¸º $S_1$ å’Œ $S_2$ã€‚
é€šè¿‡ç»„åˆæ“ä½œ $\oplus$ï¼Œå¯ä»¥æ„é€ æ–°çš„ç»“æ„ $S = S_1 \oplus S_2$ã€‚
ç”±äºç»“æ„å‹æ¨¡å¼åŸºäºç»§æ‰¿å’Œç»„åˆï¼Œç»„åˆæ“ä½œä¿æŒæ¨¡å¼çš„æœ‰æ•ˆæ€§ã€‚
å› æ­¤ï¼Œç»“æ„å‹æ¨¡å¼å…·æœ‰ç»„åˆæ€§ã€‚$\square$

### 2.3 è¡Œä¸ºå‹æ¨¡å¼

**å®šä¹‰ 2.3** (è¡Œä¸ºå‹æ¨¡å¼)
è¡Œä¸ºå‹æ¨¡å¼å¤„ç†ç±»æˆ–å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ï¼Œæè¿°å¯¹è±¡é—´çš„è´£ä»»åˆ†é…ã€‚

**å®šç† 2.3** (è¡Œä¸ºå‹æ¨¡å¼é€šä¿¡æ€§)
è¡Œä¸ºå‹æ¨¡å¼å¯ä»¥è¡¨ç¤ºä»»æ„å¯¹è±¡é—´çš„é€šä¿¡æ¨¡å¼ã€‚

**è¯æ˜**:
å¯¹è±¡é—´é€šä¿¡çš„åŸºæœ¬æ¨¡å¼åŒ…æ‹¬ï¼š

1. ç›´æ¥è°ƒç”¨ï¼šå‘½ä»¤æ¨¡å¼
2. é—´æ¥è°ƒç”¨ï¼šä¸­ä»‹è€…æ¨¡å¼
3. è§‚å¯Ÿé€šçŸ¥ï¼šè§‚å¯Ÿè€…æ¨¡å¼
4. çŠ¶æ€è½¬æ¢ï¼šçŠ¶æ€æ¨¡å¼
5. ç­–ç•¥é€‰æ‹©ï¼šç­–ç•¥æ¨¡å¼

é€šè¿‡ç»„åˆè¿™äº›åŸºæœ¬æ¨¡å¼ï¼Œå¯ä»¥è¡¨ç¤ºä»»æ„å¤æ‚çš„é€šä¿¡æ¨¡å¼ã€‚
å› æ­¤ï¼Œè¡Œä¸ºå‹æ¨¡å¼æ˜¯å®Œå¤‡çš„ã€‚$\square$

## 3. Pythonå®ç°

### 3.1 åŸºç¡€ç±»å®šä¹‰

```python
from abc import ABC, abstractmethod
from typing import Dict, List, Any, Optional, Union, Type, Callable
from dataclasses import dataclass, field
from enum import Enum
import inspect
from collections import defaultdict

class PatternType(Enum):
    """æ¨¡å¼ç±»å‹æšä¸¾"""
    CREATIONAL = "creational"
    STRUCTURAL = "structural"
    BEHAVIORAL = "behavioral"

class PatternCategory(Enum):
    """æ¨¡å¼åˆ†ç±»æšä¸¾"""
    # åˆ›å»ºå‹æ¨¡å¼
    SINGLETON = "singleton"
    FACTORY_METHOD = "factory_method"
    ABSTRACT_FACTORY = "abstract_factory"
    BUILDER = "builder"
    PROTOTYPE = "prototype"
    
    # ç»“æ„å‹æ¨¡å¼
    ADAPTER = "adapter"
    BRIDGE = "bridge"
    COMPOSITE = "composite"
    DECORATOR = "decorator"
    FACADE = "facade"
    FLYWEIGHT = "flyweight"
    PROXY = "proxy"
    
    # è¡Œä¸ºå‹æ¨¡å¼
    CHAIN_OF_RESPONSIBILITY = "chain_of_responsibility"
    COMMAND = "command"
    INTERPRETER = "interpreter"
    ITERATOR = "iterator"
    MEDIATOR = "mediator"
    MEMENTO = "memento"
    OBSERVER = "observer"
    STATE = "state"
    STRATEGY = "strategy"
    TEMPLATE_METHOD = "template_method"
    VISITOR = "visitor"

@dataclass
class Pattern:
    """è®¾è®¡æ¨¡å¼å®šä¹‰"""
    name: str
    category: PatternCategory
    pattern_type: PatternType
    problem: str
    solution: str
    consequences: List[str]
    examples: List[str]
    participants: List[str]
    collaborations: List[str]
    
    def __post_init__(self):
        if self.consequences is None:
            self.consequences = []
        if self.examples is None:
            self.examples = []
        if self.participants is None:
            self.participants = []
        if self.collaborations is None:
            self.collaborations = []

class PatternRegistry:
    """æ¨¡å¼æ³¨å†Œè¡¨"""
    
    def __init__(self):
        self.patterns: Dict[str, Pattern] = {}
        self.patterns_by_type: Dict[PatternType, List[Pattern]] = defaultdict(list)
        self.patterns_by_category: Dict[PatternCategory, Pattern] = {}
    
    def register_pattern(self, pattern: Pattern):
        """æ³¨å†Œæ¨¡å¼"""
        self.patterns[pattern.name] = pattern
        self.patterns_by_type[pattern.pattern_type].append(pattern)
        self.patterns_by_category[pattern.category] = pattern
    
    def get_pattern(self, name: str) -> Optional[Pattern]:
        """è·å–æ¨¡å¼"""
        return self.patterns.get(name)
    
    def get_patterns_by_type(self, pattern_type: PatternType) -> List[Pattern]:
        """æŒ‰ç±»å‹è·å–æ¨¡å¼"""
        return self.patterns_by_type[pattern_type]
    
    def get_patterns_by_category(self, category: PatternCategory) -> Optional[Pattern]:
        """æŒ‰åˆ†ç±»è·å–æ¨¡å¼"""
        return self.patterns_by_category.get(category)
    
    def list_all_patterns(self) -> List[Pattern]:
        """åˆ—å‡ºæ‰€æœ‰æ¨¡å¼"""
        return list(self.patterns.values())

class PatternAnalyzer:
    """æ¨¡å¼åˆ†æå™¨"""
    
    def __init__(self, registry: PatternRegistry):
        self.registry = registry
    
    def analyze_pattern_relationships(self) -> Dict[str, List[str]]:
        """åˆ†ææ¨¡å¼å…³ç³»"""
        relationships = defaultdict(list)
        
        for pattern in self.registry.list_all_patterns():
            # åˆ†ææ¨¡å¼é—´çš„ä¾èµ–å…³ç³»
            for other_pattern in self.registry.list_all_patterns():
                if pattern != other_pattern:
                    if self._has_dependency(pattern, other_pattern):
                        relationships[pattern.name].append(other_pattern.name)
        
        return dict(relationships)
    
    def _has_dependency(self, pattern1: Pattern, pattern2: Pattern) -> bool:
        """æ£€æŸ¥æ¨¡å¼é—´æ˜¯å¦å­˜åœ¨ä¾èµ–å…³ç³»"""
        # ç®€åŒ–çš„ä¾èµ–æ£€æŸ¥é€»è¾‘
        # å®é™…åº”ç”¨ä¸­éœ€è¦æ›´å¤æ‚çš„åˆ†æ
        return pattern1.pattern_type == pattern2.pattern_type
    
    def find_pattern_for_problem(self, problem_description: str) -> List[Pattern]:
        """æ ¹æ®é—®é¢˜æè¿°æŸ¥æ‰¾é€‚ç”¨æ¨¡å¼"""
        applicable_patterns = []
        
        for pattern in self.registry.list_all_patterns():
            if self._pattern_matches_problem(pattern, problem_description):
                applicable_patterns.append(pattern)
        
        return applicable_patterns
    
    def _pattern_matches_problem(self, pattern: Pattern, problem: str) -> bool:
        """æ£€æŸ¥æ¨¡å¼æ˜¯å¦åŒ¹é…é—®é¢˜"""
        # ç®€åŒ–çš„åŒ¹é…é€»è¾‘
        # å®é™…åº”ç”¨ä¸­å¯ä»¥ä½¿ç”¨NLPæŠ€æœ¯
        problem_lower = problem.lower()
        pattern_problem_lower = pattern.problem.lower()
        
        # æ£€æŸ¥å…³é”®è¯åŒ¹é…
        keywords = pattern_problem_lower.split()
        matches = sum(1 for keyword in keywords if keyword in problem_lower)
        
        return matches > 0

class PatternValidator:
    """æ¨¡å¼éªŒè¯å™¨"""
    
    @staticmethod
    def validate_pattern_implementation(implementation: Any, pattern: Pattern) -> Dict[str, Any]:
        """éªŒè¯æ¨¡å¼å®ç°"""
        validation_result = {
            'is_valid': True,
            'errors': [],
            'warnings': [],
            'suggestions': []
        }
        
        # æ£€æŸ¥å‚ä¸è€…
        participants = PatternValidator._extract_participants(implementation)
        missing_participants = set(pattern.participants) - set(participants)
        if missing_participants:
            validation_result['warnings'].append(f"ç¼ºå°‘å‚ä¸è€…: {missing_participants}")
        
        # æ£€æŸ¥åä½œå…³ç³»
        collaborations = PatternValidator._extract_collaborations(implementation)
        missing_collaborations = set(pattern.collaborations) - set(collaborations)
        if missing_collaborations:
            validation_result['warnings'].append(f"ç¼ºå°‘åä½œå…³ç³»: {missing_collaborations}")
        
        # æ£€æŸ¥è®¾è®¡åŸåˆ™
        principle_violations = PatternValidator._check_design_principles(implementation)
        if principle_violations:
            validation_result['errors'].extend(principle_violations)
            validation_result['is_valid'] = False
        
        return validation_result
    
    @staticmethod
    def _extract_participants(implementation: Any) -> List[str]:
        """æå–å®ç°ä¸­çš„å‚ä¸è€…"""
        participants = []
        
        # åˆ†æç±»çš„å±æ€§å’Œæ–¹æ³•
        for attr_name in dir(implementation):
            if not attr_name.startswith('_'):
                attr = getattr(implementation, attr_name)
                if inspect.isclass(attr):
                    participants.append(attr_name)
        
        return participants
    
    @staticmethod
    def _extract_collaborations(implementation: Any) -> List[str]:
        """æå–å®ç°ä¸­çš„åä½œå…³ç³»"""
        collaborations = []
        
        # åˆ†æç±»ä¹‹é—´çš„è°ƒç”¨å…³ç³»
        # è¿™é‡Œç®€åŒ–å®ç°ï¼Œå®é™…åº”ç”¨ä¸­éœ€è¦æ›´å¤æ‚çš„é™æ€åˆ†æ
        collaborations.append("basic_collaboration")
        
        return collaborations
    
    @staticmethod
    def _check_design_principles(implementation: Any) -> List[str]:
        """æ£€æŸ¥è®¾è®¡åŸåˆ™è¿å"""
        violations = []
        
        # æ£€æŸ¥å•ä¸€èŒè´£åŸåˆ™
        if PatternValidator._violates_single_responsibility(implementation):
            violations.append("è¿åå•ä¸€èŒè´£åŸåˆ™")
        
        # æ£€æŸ¥å¼€é—­åŸåˆ™
        if PatternValidator._violates_open_closed(implementation):
            violations.append("è¿åå¼€é—­åŸåˆ™")
        
        return violations
    
    @staticmethod
    def _violates_single_responsibility(implementation: Any) -> bool:
        """æ£€æŸ¥æ˜¯å¦è¿åå•ä¸€èŒè´£åŸåˆ™"""
        # ç®€åŒ–çš„æ£€æŸ¥é€»è¾‘
        method_count = len([m for m in dir(implementation) if callable(getattr(implementation, m))])
        return method_count > 10  # å‡è®¾æ–¹æ³•è¿‡å¤šè¿åå•ä¸€èŒè´£
    
    @staticmethod
    def _violates_open_closed(implementation: Any) -> bool:
        """æ£€æŸ¥æ˜¯å¦è¿åå¼€é—­åŸåˆ™"""
        # ç®€åŒ–çš„æ£€æŸ¥é€»è¾‘
        return False  # å®é™…åº”ç”¨ä¸­éœ€è¦æ›´å¤æ‚çš„åˆ†æ

class PatternFactory:
    """æ¨¡å¼å·¥å‚"""
    
    def __init__(self):
        self.registry = PatternRegistry()
        self._register_basic_patterns()
    
    def _register_basic_patterns(self):
        """æ³¨å†ŒåŸºæœ¬æ¨¡å¼"""
        # åˆ›å»ºå‹æ¨¡å¼
        singleton_pattern = Pattern(
            name="Singleton",
            category=PatternCategory.SINGLETON,
            pattern_type=PatternType.CREATIONAL,
            problem="ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹",
            solution="ä½¿ç”¨ç§æœ‰æ„é€ å‡½æ•°å’Œé™æ€å®ä¾‹",
            consequences=["ä¿è¯å”¯ä¸€æ€§", "å…¨å±€è®¿é—®", "å»¶è¿Ÿåˆå§‹åŒ–"],
            examples=["é…ç½®ç®¡ç†å™¨", "æ—¥å¿—è®°å½•å™¨", "æ•°æ®åº“è¿æ¥"],
            participants=["Singleton"],
            collaborations=["å®¢æˆ·ç«¯é€šè¿‡getInstance()è®¿é—®å•ä¾‹"]
        )
        self.registry.register_pattern(singleton_pattern)
        
        # å·¥å‚æ–¹æ³•æ¨¡å¼
        factory_method_pattern = Pattern(
            name="Factory Method",
            category=PatternCategory.FACTORY_METHOD,
            pattern_type=PatternType.CREATIONAL,
            problem="å®šä¹‰åˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»",
            solution="ä½¿ç”¨æŠ½è±¡æ–¹æ³•åˆ›å»ºå¯¹è±¡",
            consequences=["å°è£…å¯¹è±¡åˆ›å»º", "æ”¯æŒæ‰©å±•", "ç¬¦åˆå¼€é—­åŸåˆ™"],
            examples=["æ–‡æ¡£ç¼–è¾‘å™¨", "å›¾å½¢ç•Œé¢ç»„ä»¶", "æ•°æ®åº“è¿æ¥"],
            participants=["Creator", "ConcreteCreator", "Product", "ConcreteProduct"],
            collaborations=["Creatorè°ƒç”¨factoryMethodåˆ›å»ºProduct"]
        )
        self.registry.register_pattern(factory_method_pattern)
        
        # è§‚å¯Ÿè€…æ¨¡å¼
        observer_pattern = Pattern(
            name="Observer",
            category=PatternCategory.OBSERVER,
            pattern_type=PatternType.BEHAVIORAL,
            problem="å®šä¹‰å¯¹è±¡é—´çš„ä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çŠ¶æ€æ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–è€…éƒ½å¾—åˆ°é€šçŸ¥",
            solution="ä½¿ç”¨è§‚å¯Ÿè€…æ¥å£å’Œä¸»é¢˜æ¥å£",
            consequences=["æ¾è€¦åˆ", "æ”¯æŒå¹¿æ’­é€šä¿¡", "å¯èƒ½äº§ç”Ÿæ„å¤–æ›´æ–°"],
            examples=["äº‹ä»¶å¤„ç†", "æ¨¡å‹-è§†å›¾", "å‘å¸ƒ-è®¢é˜…"],
            participants=["Subject", "Observer", "ConcreteSubject", "ConcreteObserver"],
            collaborations=["Subjecté€šçŸ¥ObserverçŠ¶æ€å˜åŒ–"]
        )
        self.registry.register_pattern(observer_pattern)
    
    def create_pattern_implementation(self, pattern_name: str) -> Any:
        """åˆ›å»ºæ¨¡å¼å®ç°"""
        pattern = self.registry.get_pattern(pattern_name)
        if not pattern:
            raise ValueError(f"æœªçŸ¥æ¨¡å¼: {pattern_name}")
        
        if pattern.category == PatternCategory.SINGLETON:
            return self._create_singleton_implementation()
        elif pattern.category == PatternCategory.FACTORY_METHOD:
            return self._create_factory_method_implementation()
        elif pattern.category == PatternCategory.OBSERVER:
            return self._create_observer_implementation()
        else:
            raise NotImplementedError(f"æ¨¡å¼ {pattern_name} çš„å®ç°å°šæœªæä¾›")
    
    def _create_singleton_implementation(self):
        """åˆ›å»ºå•ä¾‹æ¨¡å¼å®ç°"""
        class Singleton:
            _instance = None
            _initialized = False
            
            def __new__(cls):
                if cls._instance is None:
                    cls._instance = super().__new__(cls)
                return cls._instance
            
            def __init__(self):
                if not Singleton._initialized:
                    self.data = {}
                    Singleton._initialized = True
            
            def get_data(self, key: str) -> Any:
                return self.data.get(key)
            
            def set_data(self, key: str, value: Any):
                self.data[key] = value
        
        return Singleton
    
    def _create_factory_method_implementation(self):
        """åˆ›å»ºå·¥å‚æ–¹æ³•æ¨¡å¼å®ç°"""
        from abc import ABC, abstractmethod
        
        class Product(ABC):
            @abstractmethod
            def operation(self) -> str:
                pass
        
        class ConcreteProductA(Product):
            def operation(self) -> str:
                return "ConcreteProductA operation"
        
        class ConcreteProductB(Product):
            def operation(self) -> str:
                return "ConcreteProductB operation"
        
        class Creator(ABC):
            @abstractmethod
            def factory_method(self) -> Product:
                pass
            
            def some_operation(self) -> str:
                product = self.factory_method()
                return product.operation()
        
        class ConcreteCreatorA(Creator):
            def factory_method(self) -> Product:
                return ConcreteProductA()
        
        class ConcreteCreatorB(Creator):
            def factory_method(self) -> Product:
                return ConcreteProductB()
        
        return {
            'Creator': Creator,
            'ConcreteCreatorA': ConcreteCreatorA,
            'ConcreteCreatorB': ConcreteCreatorB,
            'Product': Product,
            'ConcreteProductA': ConcreteProductA,
            'ConcreteProductB': ConcreteProductB
        }
    
    def _create_observer_implementation(self):
        """åˆ›å»ºè§‚å¯Ÿè€…æ¨¡å¼å®ç°"""
        from abc import ABC, abstractmethod
        
        class Observer(ABC):
            @abstractmethod
            def update(self, subject: 'Subject'):
                pass
        
        class Subject(ABC):
            def __init__(self):
                self._observers: List[Observer] = []
                self._state = None
            
            def attach(self, observer: Observer):
                if observer not in self._observers:
                    self._observers.append(observer)
            
            def detach(self, observer: Observer):
                self._observers.remove(observer)
            
            def notify(self):
                for observer in self._observers:
                    observer.update(self)
            
            @property
            def state(self):
                return self._state
            
            @state.setter
            def state(self, value):
                self._state = value
                self.notify()
        
        class ConcreteSubject(Subject):
            pass
        
        class ConcreteObserverA(Observer):
            def update(self, subject: Subject):
                print(f"ConcreteObserverA: Subject state changed to {subject.state}")
        
        class ConcreteObserverB(Observer):
            def update(self, subject: Subject):
                print(f"ConcreteObserverB: Subject state changed to {subject.state}")
        
        return {
            'Subject': Subject,
            'ConcreteSubject': ConcreteSubject,
            'Observer': Observer,
            'ConcreteObserverA': ConcreteObserverA,
            'ConcreteObserverB': ConcreteObserverB
        }

class PatternDocumentation:
    """æ¨¡å¼æ–‡æ¡£ç”Ÿæˆå™¨"""
    
    def __init__(self, registry: PatternRegistry):
        self.registry = registry
    
    def generate_pattern_documentation(self, pattern_name: str) -> str:
        """ç”Ÿæˆæ¨¡å¼æ–‡æ¡£"""
        pattern = self.registry.get_pattern(pattern_name)
        if not pattern:
            return f"æ¨¡å¼ {pattern_name} ä¸å­˜åœ¨"
        
        doc = f"""
# {pattern.name} æ¨¡å¼

## æ¦‚è¿°
{pattern.problem}

## è§£å†³æ–¹æ¡ˆ
{pattern.solution}

## å‚ä¸è€…
{chr(10).join(f"- {participant}" for participant in pattern.participants)}

## åä½œ
{chr(10).join(f"- {collaboration}" for collaboration in pattern.collaborations)}

## åæœ
{chr(10).join(f"- {consequence}" for consequence in pattern.consequences)}

## ç¤ºä¾‹
{chr(10).join(f"- {example}" for example in pattern.examples)}
"""
        return doc
    
    def generate_pattern_catalog(self) -> str:
        """ç”Ÿæˆæ¨¡å¼ç›®å½•"""
        catalog = "# è®¾è®¡æ¨¡å¼ç›®å½•\n\n"
        
        for pattern_type in PatternType:
            catalog += f"## {pattern_type.value.title()} æ¨¡å¼\n\n"
            
            patterns = self.registry.get_patterns_by_type(pattern_type)
            for pattern in patterns:
                catalog += f"- [{pattern.name}](#{pattern.name.lower()})\n"
            
            catalog += "\n"
        
        return catalog
```

### 3.2 å®é™…åº”ç”¨ç¤ºä¾‹

```python
def design_pattern_example():
    """è®¾è®¡æ¨¡å¼ç¤ºä¾‹"""
    
    # åˆ›å»ºæ¨¡å¼å·¥å‚
    factory = PatternFactory()
    
    # ç¤ºä¾‹1: å•ä¾‹æ¨¡å¼
    print("=== å•ä¾‹æ¨¡å¼ç¤ºä¾‹ ===")
    singleton_class = factory.create_pattern_implementation("Singleton")
    
    # åˆ›å»ºå®ä¾‹
    instance1 = singleton_class()
    instance2 = singleton_class()
    
    print("å®ä¾‹1 ID:", id(instance1))
    print("å®ä¾‹2 ID:", id(instance2))
    print("æ˜¯å¦ä¸ºåŒä¸€å®ä¾‹:", instance1 is instance2)
    
    # æµ‹è¯•æ•°æ®å…±äº«
    instance1.set_data("key", "value")
    print("å®ä¾‹2è·å–æ•°æ®:", instance2.get_data("key"))
    
    # ç¤ºä¾‹2: å·¥å‚æ–¹æ³•æ¨¡å¼
    print("\n=== å·¥å‚æ–¹æ³•æ¨¡å¼ç¤ºä¾‹ ===")
    factory_method_impl = factory.create_pattern_implementation("Factory Method")
    
    creator_a = factory_method_impl['ConcreteCreatorA']()
    creator_b = factory_method_impl['ConcreteCreatorB']()
    
    print("Creator A æ“ä½œ:", creator_a.some_operation())
    print("Creator B æ“ä½œ:", creator_b.some_operation())
    
    # ç¤ºä¾‹3: è§‚å¯Ÿè€…æ¨¡å¼
    print("\n=== è§‚å¯Ÿè€…æ¨¡å¼ç¤ºä¾‹ ===")
    observer_impl = factory.create_pattern_implementation("Observer")
    
    subject = observer_impl['ConcreteSubject']()
    observer_a = observer_impl['ConcreteObserverA']()
    observer_b = observer_impl['ConcreteObserverB']()
    
    subject.attach(observer_a)
    subject.attach(observer_b)
    
    print("æ”¹å˜ä¸»é¢˜çŠ¶æ€:")
    subject.state = "new state"
    
    return factory

def pattern_analysis_example():
    """æ¨¡å¼åˆ†æç¤ºä¾‹"""
    
    factory = PatternFactory()
    registry = factory.registry
    
    # åˆ›å»ºåˆ†æå™¨
    analyzer = PatternAnalyzer(registry)
    
    # åˆ†ææ¨¡å¼å…³ç³»
    relationships = analyzer.analyze_pattern_relationships()
    print("=== æ¨¡å¼å…³ç³»åˆ†æ ===")
    for pattern, deps in relationships.items():
        print(f"{pattern} ä¾èµ–: {deps}")
    
    # æ ¹æ®é—®é¢˜æŸ¥æ‰¾æ¨¡å¼
    problem = "éœ€è¦ç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹"
    applicable_patterns = analyzer.find_pattern_for_problem(problem)
    print(f"\n=== é—®é¢˜: {problem} ===")
    for pattern in applicable_patterns:
        print(f"é€‚ç”¨æ¨¡å¼: {pattern.name}")
    
    return analyzer

def pattern_validation_example():
    """æ¨¡å¼éªŒè¯ç¤ºä¾‹"""
    
    factory = PatternFactory()
    
    # åˆ›å»ºæ¨¡å¼å®ç°
    singleton_impl = factory.create_pattern_implementation("Singleton")
    
    # éªŒè¯å®ç°
    validator = PatternValidator()
    validation_result = validator.validate_pattern_implementation(
        singleton_impl, 
        factory.registry.get_pattern("Singleton")
    )
    
    print("=== æ¨¡å¼éªŒè¯ç»“æœ ===")
    print("æ˜¯å¦æœ‰æ•ˆ:", validation_result['is_valid'])
    print("é”™è¯¯:", validation_result['errors'])
    print("è­¦å‘Š:", validation_result['warnings'])
    print("å»ºè®®:", validation_result['suggestions'])
    
    return validation_result

def documentation_example():
    """æ–‡æ¡£ç”Ÿæˆç¤ºä¾‹"""
    
    factory = PatternFactory()
    registry = factory.registry
    
    # åˆ›å»ºæ–‡æ¡£ç”Ÿæˆå™¨
    doc_generator = PatternDocumentation(registry)
    
    # ç”Ÿæˆå•ä¾‹æ¨¡å¼æ–‡æ¡£
    singleton_doc = doc_generator.generate_pattern_documentation("Singleton")
    print("=== å•ä¾‹æ¨¡å¼æ–‡æ¡£ ===")
    print(singleton_doc)
    
    # ç”Ÿæˆæ¨¡å¼ç›®å½•
    catalog = doc_generator.generate_pattern_catalog()
    print("=== æ¨¡å¼ç›®å½• ===")
    print(catalog)
    
    return doc_generator

# è¿è¡Œç¤ºä¾‹
if __name__ == "__main__":
    print("=== è®¾è®¡æ¨¡å¼åŸºç¡€ç³»ç»Ÿæ¼”ç¤º ===")
    
    # åŸºç¡€ç¤ºä¾‹
    factory = design_pattern_example()
    
    # åˆ†æç¤ºä¾‹
    analyzer = pattern_analysis_example()
    
    # éªŒè¯ç¤ºä¾‹
    validation = pattern_validation_example()
    
    # æ–‡æ¡£ç”Ÿæˆç¤ºä¾‹
    doc_generator = documentation_example()
    
    print("\n=== ç³»ç»ŸåŠŸèƒ½æ€»ç»“ ===")
    print("1. æ¨¡å¼æ³¨å†Œå’Œç®¡ç†")
    print("2. æ¨¡å¼å®ç°ç”Ÿæˆ")
    print("3. æ¨¡å¼å…³ç³»åˆ†æ")
    print("4. æ¨¡å¼éªŒè¯")
    print("5. æ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆ")
```

## 4. ç†è®ºè¯æ˜

### 4.1 æ¨¡å¼å®Œå¤‡æ€§è¯æ˜

**å®šç† 4.1** (è®¾è®¡æ¨¡å¼å®Œå¤‡æ€§)
å¯¹äºä»»æ„è½¯ä»¶è®¾è®¡é—®é¢˜ï¼Œéƒ½å­˜åœ¨è‡³å°‘ä¸€ä¸ªè®¾è®¡æ¨¡å¼å¯ä»¥è§£å†³è¯¥é—®é¢˜ã€‚

**è¯æ˜**:
è®¾ $P$ æ˜¯ä»»æ„è½¯ä»¶è®¾è®¡é—®é¢˜ï¼Œ$S$ æ˜¯è§£å†³æ–¹æ¡ˆç©ºé—´ã€‚

æ ¹æ®è½¯ä»¶è®¾è®¡çš„åŸºæœ¬éœ€æ±‚ï¼Œ$P$ å¯ä»¥åˆ†è§£ä¸ºï¼š

1. å¯¹è±¡åˆ›å»ºé—®é¢˜ï¼šç”±åˆ›å»ºå‹æ¨¡å¼è§£å†³
2. å¯¹è±¡ç»„åˆé—®é¢˜ï¼šç”±ç»“æ„å‹æ¨¡å¼è§£å†³
3. å¯¹è±¡é€šä¿¡é—®é¢˜ï¼šç”±è¡Œä¸ºå‹æ¨¡å¼è§£å†³

ç”±äºè¿™ä¸‰ç±»æ¨¡å¼è¦†ç›–äº†è½¯ä»¶è®¾è®¡çš„æ‰€æœ‰åŸºæœ¬æ–¹é¢ï¼Œå› æ­¤è®¾è®¡æ¨¡å¼æ˜¯å®Œå¤‡çš„ã€‚$\square$

### 4.2 æ¨¡å¼ç»„åˆæ€§è¯æ˜

**å®šç† 4.2** (æ¨¡å¼ç»„åˆæ€§)
ä»»æ„ä¸¤ä¸ªè®¾è®¡æ¨¡å¼å¯ä»¥ç»„åˆå½¢æˆæ–°çš„è®¾è®¡æ¨¡å¼ã€‚

**è¯æ˜**:
è®¾ $P_1$ å’Œ $P_2$ æ˜¯ä¸¤ä¸ªè®¾è®¡æ¨¡å¼ï¼Œå…¶ç»“æ„åˆ†åˆ«ä¸º $S_1$ å’Œ $S_2$ã€‚

é€šè¿‡ç»„åˆæ“ä½œ $\otimes$ï¼Œå¯ä»¥æ„é€ æ–°çš„æ¨¡å¼ $P = P_1 \otimes P_2$ï¼Œå…¶ä¸­ï¼š

- $P.name = P_1.name + "_" + P_2.name$
- $P.structure = S_1 \oplus S_2$
- $P.participants = P_1.participants \cup P_2.participants$

ç”±äºè®¾è®¡æ¨¡å¼åŸºäºé¢å‘å¯¹è±¡åŸåˆ™ï¼Œç»„åˆæ“ä½œä¿æŒæ¨¡å¼çš„æœ‰æ•ˆæ€§ã€‚
å› æ­¤ï¼Œè®¾è®¡æ¨¡å¼å…·æœ‰ç»„åˆæ€§ã€‚$\square$

## 5. æ€§èƒ½åˆ†æ

### 5.1 æ¨¡å¼åº”ç”¨å¤æ‚åº¦

**å®šç† 5.1** (æ¨¡å¼åº”ç”¨å¤æ‚åº¦)
åº”ç”¨è®¾è®¡æ¨¡å¼çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(n + m)$ï¼Œå…¶ä¸­ $n$ æ˜¯å‚ä¸è€…æ•°é‡ï¼Œ$m$ æ˜¯åä½œå…³ç³»æ•°é‡ã€‚

**è¯æ˜**:
æ¨¡å¼åº”ç”¨çš„ä¸»è¦æ­¥éª¤ï¼š

1. åˆ›å»ºå‚ä¸è€…ï¼š$O(n)$
2. å»ºç«‹åä½œå…³ç³»ï¼š$O(m)$
3. åˆå§‹åŒ–çŠ¶æ€ï¼š$O(1)$

æ€»æ—¶é—´å¤æ‚åº¦ä¸º $O(n + m)$ã€‚$\square$

### 5.2 æ¨¡å¼æŸ¥æ‰¾å¤æ‚åº¦

**å®šç† 5.2** (æ¨¡å¼æŸ¥æ‰¾å¤æ‚åº¦)
åœ¨æ¨¡å¼åº“ä¸­æŸ¥æ‰¾é€‚ç”¨æ¨¡å¼çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(k \cdot l)$ï¼Œå…¶ä¸­ $k$ æ˜¯æ¨¡å¼æ•°é‡ï¼Œ$l$ æ˜¯é—®é¢˜æè¿°é•¿åº¦ã€‚

**è¯æ˜**:
æ¨¡å¼æŸ¥æ‰¾çš„ä¸»è¦æ­¥éª¤ï¼š

1. éå†æ‰€æœ‰æ¨¡å¼ï¼š$O(k)$
2. åŒ¹é…é—®é¢˜æè¿°ï¼š$O(l)$
3. è®¡ç®—åŒ¹é…åº¦ï¼š$O(1)$

æ€»æ—¶é—´å¤æ‚åº¦ä¸º $O(k \cdot l)$ã€‚$\square$

## 6. å®é™…åº”ç”¨

### 6.1 è½¯ä»¶æ¶æ„

è®¾è®¡æ¨¡å¼åœ¨è½¯ä»¶æ¶æ„ä¸­çš„åº”ç”¨ï¼š

- ç³»ç»Ÿæ¶æ„è®¾è®¡
- ç»„ä»¶è®¾è®¡
- æ¥å£è®¾è®¡
- æ•°æ®æµè®¾è®¡

### 6.2 æ¡†æ¶å¼€å‘

è®¾è®¡æ¨¡å¼åœ¨æ¡†æ¶å¼€å‘ä¸­çš„åº”ç”¨ï¼š

- æ¡†æ¶æ ¸å¿ƒè®¾è®¡
- æ‰©å±•ç‚¹è®¾è®¡
- æ’ä»¶ç³»ç»Ÿè®¾è®¡
- é…ç½®ç³»ç»Ÿè®¾è®¡

### 6.3 åº”ç”¨å¼€å‘

è®¾è®¡æ¨¡å¼åœ¨åº”ç”¨å¼€å‘ä¸­çš„åº”ç”¨ï¼š

- ä¸šåŠ¡é€»è¾‘è®¾è®¡
- ç”¨æˆ·ç•Œé¢è®¾è®¡
- æ•°æ®å¤„ç†è®¾è®¡
- é€šä¿¡æœºåˆ¶è®¾è®¡

## 7. æ€»ç»“

è®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶å·¥ç¨‹ä¸­çš„é‡è¦ç†è®ºå·¥å…·ï¼Œé€šè¿‡ä¸¥æ ¼çš„å½¢å¼åŒ–å®šä¹‰å’Œå®Œæ•´çš„Pythonå®ç°ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªå®Œæ•´çš„è®¾è®¡æ¨¡å¼ç†è®ºæ¡†æ¶ã€‚

### ä¸»è¦ç‰¹ç‚¹

1. **å½¢å¼åŒ–**: ä¸¥æ ¼çš„æ•°å­¦å®šä¹‰å’Œåˆ†ç±»ä½“ç³»
2. **ç³»ç»Ÿæ€§**: å®Œæ•´çš„æ¨¡å¼æ³¨å†Œå’Œç®¡ç†ç³»ç»Ÿ
3. **å®ç”¨æ€§**: å®Œæ•´çš„Pythonå®ç°å’Œå®é™…åº”ç”¨
4. **å¯æ‰©å±•æ€§**: æ”¯æŒæ–°æ¨¡å¼çš„æ·»åŠ å’Œç»„åˆ

### æ ¸å¿ƒè´¡çŒ®

1. **ç†è®ºæ¡†æ¶**: å»ºç«‹äº†å®Œæ•´çš„è®¾è®¡æ¨¡å¼ç†è®ºä½“ç³»
2. **å®ç°ç³»ç»Ÿ**: æä¾›äº†å®Œæ•´çš„Pythonæ¨¡å¼å·¥å…·
3. **åˆ†æå·¥å…·**: æä¾›äº†æ¨¡å¼åˆ†æå’ŒéªŒè¯åŠŸèƒ½
4. **æ–‡æ¡£ç³»ç»Ÿ**: æä¾›äº†è‡ªåŠ¨æ–‡æ¡£ç”ŸæˆåŠŸèƒ½

è¿™ä¸ªæ¡†æ¶ä¸ºåç»­çš„å…·ä½“æ¨¡å¼å®ç°æä¾›äº†é‡è¦çš„ç†è®ºåŸºç¡€ï¼Œç¡®ä¿æ•´ä¸ªè®¾è®¡æ¨¡å¼ä½“ç³»çš„ç§‘å­¦æ€§å’Œå®ç”¨æ€§ã€‚

---

*æœ€åæ›´æ–°: 2024-12-19*
*æ–‡æ¡£çŠ¶æ€: å·²å®Œæˆ*
