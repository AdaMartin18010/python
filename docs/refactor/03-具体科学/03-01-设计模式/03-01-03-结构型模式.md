# ç»“æ„å‹æ¨¡å¼

## ğŸ“‹ æ¦‚è¿°

ç»“æ„å‹æ¨¡å¼å¤„ç†ç±»å’Œå¯¹è±¡çš„ç»„åˆï¼Œé€šè¿‡ç»§æ‰¿å’Œç»„åˆè·å¾—æ–°åŠŸèƒ½ã€‚æœ¬æ–‡æ¡£ä»å½¢å¼åŒ–è§’åº¦å®šä¹‰ç»“æ„å‹æ¨¡å¼çš„ç†è®ºæ¡†æ¶ï¼Œå¹¶æä¾›å®Œæ•´çš„Pythonå®ç°ã€‚

## 1. å½¢å¼åŒ–å®šä¹‰

### 1.1 ç»“æ„å‹æ¨¡å¼çš„åŸºæœ¬æ¦‚å¿µ

**å®šä¹‰ 1.1** (ç»“æ„å‹æ¨¡å¼)
ç»“æ„å‹æ¨¡å¼æ˜¯ä¸€ä¸ªå››å…ƒç»„ $(C, I, A, R)$ï¼Œå…¶ä¸­ï¼š
- $C$ æ˜¯ç»„ä»¶é›†åˆ (Components)
- $I$ æ˜¯æ¥å£é›†åˆ (Interfaces)
- $A$ æ˜¯é€‚é…å™¨é›†åˆ (Adapters)
- $R$ æ˜¯å…³ç³»é›†åˆ (Relations)

**å®šä¹‰ 1.2** (ç»“æ„å…³ç³»)
ç»“æ„å…³ç³»æ˜¯ä¸€ä¸ªæ˜ å°„ $\phi: C \times C \rightarrow R$ï¼Œæ»¡è¶³ï¼š
1. **ç»„åˆæ€§**: ç»„ä»¶å¯ä»¥é€šè¿‡ç»„åˆå½¢æˆæ–°ç»„ä»¶
2. **ç»§æ‰¿æ€§**: ç»„ä»¶å¯ä»¥é€šè¿‡ç»§æ‰¿è·å¾—æ–°åŠŸèƒ½
3. **é€‚é…æ€§**: ç»„ä»¶å¯ä»¥é€šè¿‡é€‚é…å™¨è¿›è¡Œé€‚é…

**å®šä¹‰ 1.3** (ç»“æ„æ“ä½œ)
ç»“æ„æ“ä½œ $op$ æ˜¯ä¸€ä¸ªä¸‰å…ƒç»„ $(c_1, c_2, r)$ï¼Œå…¶ä¸­ï¼š
- $c_1, c_2 \in C$ æ˜¯ç»„ä»¶
- $r \in R$ æ˜¯å…³ç³»ç±»å‹

### 1.2 ç»“æ„å‹æ¨¡å¼åˆ†ç±»

**å®šä¹‰ 1.4** (é€‚é…å™¨æ¨¡å¼)
é€‚é…å™¨æ¨¡å¼å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ã€‚

**å®šä¹‰ 1.5** (æ¡¥æ¥æ¨¡å¼)
æ¡¥æ¥æ¨¡å¼å°†æŠ½è±¡éƒ¨åˆ†ä¸å®ç°éƒ¨åˆ†åˆ†ç¦»ï¼Œä½¿å®ƒä»¬éƒ½å¯ä»¥ç‹¬ç«‹åœ°å˜åŒ–ã€‚

**å®šä¹‰ 1.6** (ç»„åˆæ¨¡å¼)
ç»„åˆæ¨¡å¼å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ä»¥è¡¨ç¤º"éƒ¨åˆ†-æ•´ä½“"çš„å±‚æ¬¡ç»“æ„ã€‚

**å®šä¹‰ 1.7** (è£…é¥°å™¨æ¨¡å¼)
è£…é¥°å™¨æ¨¡å¼åŠ¨æ€åœ°ç»™å¯¹è±¡æ·»åŠ é¢å¤–çš„èŒè´£ã€‚

**å®šä¹‰ 1.8** (å¤–è§‚æ¨¡å¼)
å¤–è§‚æ¨¡å¼ä¸ºå­ç³»ç»Ÿä¸­çš„ä¸€ç»„æ¥å£æä¾›ä¸€ä¸ªä¸€è‡´çš„ç•Œé¢ã€‚

**å®šä¹‰ 1.9** (äº«å…ƒæ¨¡å¼)
äº«å…ƒæ¨¡å¼è¿ç”¨å…±äº«æŠ€æœ¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡ç»†ç²’åº¦å¯¹è±¡çš„å¤ç”¨ã€‚

**å®šä¹‰ 1.10** (ä»£ç†æ¨¡å¼)
ä»£ç†æ¨¡å¼ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚

## 2. æ¨¡å¼ç†è®º

### 2.1 é€‚é…å™¨æ¨¡å¼ç†è®º

**å®šç† 2.1** (é€‚é…å™¨æ­£ç¡®æ€§)
å¦‚æœé€‚é…å™¨æ¨¡å¼å®ç°æ­£ç¡®ï¼Œåˆ™å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡é€‚é…å™¨è®¿é—®ç›®æ ‡æ¥å£ã€‚

**è¯æ˜**:
è®¾ $A$ æ˜¯é€‚é…å™¨ï¼Œ$T$ æ˜¯ç›®æ ‡æ¥å£ï¼Œ$C$ æ˜¯å®¢æˆ·ç«¯ã€‚
æ ¹æ®é€‚é…å™¨æ¨¡å¼çš„å®šä¹‰ï¼š
1. $A$ å®ç° $T$ æ¥å£
2. $A$ åŒ…å«è¢«é€‚é…å¯¹è±¡ $O$
3. $A$ å°† $T$ çš„æ–¹æ³•è°ƒç”¨è½¬å‘ç»™ $O$

å› æ­¤ï¼Œå®¢æˆ·ç«¯ $C$ å¯ä»¥é€šè¿‡é€‚é…å™¨ $A$ è®¿é—®ç›®æ ‡æ¥å£ $T$ã€‚$\square$

**å®šç† 2.2** (é€‚é…å™¨å”¯ä¸€æ€§)
å¯¹äºç»™å®šçš„ç›®æ ‡æ¥å£å’Œè¢«é€‚é…å¯¹è±¡ï¼Œå­˜åœ¨å”¯ä¸€çš„é€‚é…å™¨å®ç°ã€‚

**è¯æ˜**:
è®¾ $T$ æ˜¯ç›®æ ‡æ¥å£ï¼Œ$O$ æ˜¯è¢«é€‚é…å¯¹è±¡ã€‚
é€‚é…å™¨ $A$ å¿…é¡»ï¼š
1. å®ç° $T$ çš„æ‰€æœ‰æ–¹æ³•
2. å°†æ–¹æ³•è°ƒç”¨æ˜ å°„åˆ° $O$ çš„å¯¹åº”æ–¹æ³•

ç”±äºæ˜ å°„å…³ç³»æ˜¯ç¡®å®šçš„ï¼Œé€‚é…å™¨å®ç°æ˜¯å”¯ä¸€çš„ã€‚$\square$

### 2.2 æ¡¥æ¥æ¨¡å¼ç†è®º

**å®šç† 2.3** (æ¡¥æ¥ç‹¬ç«‹æ€§)
æ¡¥æ¥æ¨¡å¼ä½¿æŠ½è±¡å’Œå®ç°å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚

**è¯æ˜**:
è®¾ $Abs$ æ˜¯æŠ½è±¡ç±»ï¼Œ$Imp$ æ˜¯å®ç°æ¥å£ã€‚
æ¡¥æ¥æ¨¡å¼é€šè¿‡ç»„åˆå…³ç³»è¿æ¥ $Abs$ å’Œ $Imp$ï¼š
1. $Abs$ åŒ…å« $Imp$ çš„å¼•ç”¨
2. $Abs$ é€šè¿‡ $Imp$ å®ç°å…·ä½“æ“ä½œ
3. $Abs$ å’Œ $Imp$ å¯ä»¥ç‹¬ç«‹æ‰©å±•

å› æ­¤ï¼ŒæŠ½è±¡å’Œå®ç°å¯ä»¥ç‹¬ç«‹å˜åŒ–ã€‚$\square$

### 2.3 ç»„åˆæ¨¡å¼ç†è®º

**å®šç† 2.4** (ç»„åˆé€’å½’æ€§)
ç»„åˆæ¨¡å¼æ”¯æŒé€’å½’ç»“æ„ï¼Œå¶å­èŠ‚ç‚¹å’Œç»„åˆèŠ‚ç‚¹å¯ä»¥ç»Ÿä¸€å¤„ç†ã€‚

**è¯æ˜**:
è®¾ $Component$ æ˜¯æŠ½è±¡ç»„ä»¶ï¼Œ$Leaf$ æ˜¯å¶å­èŠ‚ç‚¹ï¼Œ$Composite$ æ˜¯ç»„åˆèŠ‚ç‚¹ã€‚
ç»„åˆæ¨¡å¼å®šä¹‰ï¼š
1. $Leaf$ å’Œ $Composite$ éƒ½ç»§æ‰¿ $Component$
2. $Composite$ åŒ…å« $Component$ çš„é›†åˆ
3. å®¢æˆ·ç«¯å¯ä»¥ç»Ÿä¸€å¤„ç† $Component$

å› æ­¤ï¼Œæ”¯æŒé€’å½’ç»“æ„å’Œç»Ÿä¸€å¤„ç†ã€‚$\square$

## 3. Pythonå®ç°

### 3.1 åŸºç¡€ç±»å®šä¹‰

```python
from abc import ABC, abstractmethod
from typing import Dict, List, Any, Optional, Union, Type, Callable
from dataclasses import dataclass, field
from enum import Enum
import weakref
from collections import defaultdict

class ComponentType(Enum):
    """ç»„ä»¶ç±»å‹æšä¸¾"""
    LEAF = "leaf"
    COMPOSITE = "composite"
    ADAPTER = "adapter"
    DECORATOR = "decorator"
    PROXY = "proxy"

class Component(ABC):
    """ç»„ä»¶æŠ½è±¡åŸºç±»"""
    
    def __init__(self, name: str):
        self.name = name
    
    @abstractmethod
    def operation(self) -> str:
        """ç»„ä»¶æ“ä½œ"""
        pass
    
    def __str__(self):
        return f"{self.__class__.__name__}({self.name})"

class Leaf(Component):
    """å¶å­ç»„ä»¶"""
    
    def __init__(self, name: str):
        super().__init__(name)
    
    def operation(self) -> str:
        return f"{self.name}: Leaf operation"

class Composite(Component):
    """ç»„åˆç»„ä»¶"""
    
    def __init__(self, name: str):
        super().__init__(name)
        self.children: List[Component] = []
    
    def add(self, component: Component):
        """æ·»åŠ å­ç»„ä»¶"""
        self.children.append(component)
    
    def remove(self, component: Component):
        """ç§»é™¤å­ç»„ä»¶"""
        self.children.remove(component)
    
    def get_child(self, index: int) -> Optional[Component]:
        """è·å–å­ç»„ä»¶"""
        if 0 <= index < len(self.children):
            return self.children[index]
        return None
    
    def operation(self) -> str:
        """ç»„åˆæ“ä½œ"""
        results = [f"{self.name}: Composite operation"]
        for child in self.children:
            results.append(f"  {child.operation()}")
        return "\n".join(results)

# é€‚é…å™¨æ¨¡å¼å®ç°
class TargetInterface(ABC):
    """ç›®æ ‡æ¥å£"""
    
    @abstractmethod
    def request(self) -> str:
        """ç›®æ ‡è¯·æ±‚æ–¹æ³•"""
        pass

class Adaptee:
    """è¢«é€‚é…çš„ç±»"""
    
    def specific_request(self) -> str:
        """ç‰¹å®šè¯·æ±‚æ–¹æ³•"""
        return "Adaptee: specific request"

class Adapter(TargetInterface):
    """é€‚é…å™¨"""
    
    def __init__(self, adaptee: Adaptee):
        self.adaptee = adaptee
    
    def request(self) -> str:
        """é€‚é…ç›®æ ‡æ¥å£"""
        return f"Adapter: {self.adaptee.specific_request()}"

# æ¡¥æ¥æ¨¡å¼å®ç°
class Implementor(ABC):
    """å®ç°è€…æ¥å£"""
    
    @abstractmethod
    def operation_impl(self) -> str:
        """å…·ä½“å®ç°"""
        pass

class ConcreteImplementorA(Implementor):
    """å…·ä½“å®ç°A"""
    
    def operation_impl(self) -> str:
        return "ConcreteImplementorA: operation"

class ConcreteImplementorB(Implementor):
    """å…·ä½“å®ç°B"""
    
    def operation_impl(self) -> str:
        return "ConcreteImplementorB: operation"

class Abstraction(ABC):
    """æŠ½è±¡ç±»"""
    
    def __init__(self, implementor: Implementor):
        self.implementor = implementor
    
    @abstractmethod
    def operation(self) -> str:
        """æŠ½è±¡æ“ä½œ"""
        pass

class RefinedAbstraction(Abstraction):
    """ç²¾ç¡®æŠ½è±¡"""
    
    def operation(self) -> str:
        return f"RefinedAbstraction: {self.implementor.operation_impl()}"

# è£…é¥°å™¨æ¨¡å¼å®ç°
class ComponentInterface(ABC):
    """ç»„ä»¶æ¥å£"""
    
    @abstractmethod
    def operation(self) -> str:
        """ç»„ä»¶æ“ä½œ"""
        pass

class ConcreteComponent(ComponentInterface):
    """å…·ä½“ç»„ä»¶"""
    
    def __init__(self, name: str):
        self.name = name
    
    def operation(self) -> str:
        return f"{self.name}: Concrete operation"

class Decorator(ComponentInterface):
    """è£…é¥°å™¨åŸºç±»"""
    
    def __init__(self, component: ComponentInterface):
        self.component = component
    
    def operation(self) -> str:
        return self.component.operation()

class ConcreteDecoratorA(Decorator):
    """å…·ä½“è£…é¥°å™¨A"""
    
    def operation(self) -> str:
        return f"ConcreteDecoratorA: {super().operation()}"

class ConcreteDecoratorB(Decorator):
    """å…·ä½“è£…é¥°å™¨B"""
    
    def operation(self) -> str:
        return f"ConcreteDecoratorB: {super().operation()}"

# å¤–è§‚æ¨¡å¼å®ç°
class SubsystemA:
    """å­ç³»ç»ŸA"""
    
    def operation_a1(self) -> str:
        return "SubsystemA: operation a1"
    
    def operation_a2(self) -> str:
        return "SubsystemA: operation a2"

class SubsystemB:
    """å­ç³»ç»ŸB"""
    
    def operation_b1(self) -> str:
        return "SubsystemB: operation b1"
    
    def operation_b2(self) -> str:
        return "SubsystemB: operation b2"

class SubsystemC:
    """å­ç³»ç»ŸC"""
    
    def operation_c1(self) -> str:
        return "SubsystemC: operation c1"
    
    def operation_c2(self) -> str:
        return "SubsystemC: operation c2"

class Facade:
    """å¤–è§‚ç±»"""
    
    def __init__(self):
        self.subsystem_a = SubsystemA()
        self.subsystem_b = SubsystemB()
        self.subsystem_c = SubsystemC()
    
    def operation1(self) -> str:
        """æ“ä½œ1"""
        results = [
            self.subsystem_a.operation_a1(),
            self.subsystem_b.operation_b1(),
            self.subsystem_c.operation_c1()
        ]
        return "Facade: " + " -> ".join(results)
    
    def operation2(self) -> str:
        """æ“ä½œ2"""
        results = [
            self.subsystem_a.operation_a2(),
            self.subsystem_b.operation_b2(),
            self.subsystem_c.operation_c2()
        ]
        return "Facade: " + " -> ".join(results)

# äº«å…ƒæ¨¡å¼å®ç°
class Flyweight(ABC):
    """äº«å…ƒæ¥å£"""
    
    @abstractmethod
    def operation(self, extrinsic_state: str) -> str:
        """æ“ä½œ"""
        pass

class ConcreteFlyweight(Flyweight):
    """å…·ä½“äº«å…ƒ"""
    
    def __init__(self, intrinsic_state: str):
        self.intrinsic_state = intrinsic_state
    
    def operation(self, extrinsic_state: str) -> str:
        return f"ConcreteFlyweight({self.intrinsic_state}): {extrinsic_state}"

class FlyweightFactory:
    """äº«å…ƒå·¥å‚"""
    
    def __init__(self):
        self.flyweights: Dict[str, Flyweight] = {}
    
    def get_flyweight(self, key: str) -> Flyweight:
        """è·å–äº«å…ƒ"""
        if key not in self.flyweights:
            self.flyweights[key] = ConcreteFlyweight(key)
        return self.flyweights[key]
    
    def get_flyweight_count(self) -> int:
        """è·å–äº«å…ƒæ•°é‡"""
        return len(self.flyweights)

# ä»£ç†æ¨¡å¼å®ç°
class Subject(ABC):
    """ä¸»é¢˜æ¥å£"""
    
    @abstractmethod
    def request(self) -> str:
        """è¯·æ±‚æ–¹æ³•"""
        pass

class RealSubject(Subject):
    """çœŸå®ä¸»é¢˜"""
    
    def __init__(self, name: str):
        self.name = name
    
    def request(self) -> str:
        return f"{self.name}: RealSubject request"

class Proxy(Subject):
    """ä»£ç†ç±»"""
    
    def __init__(self, real_subject: RealSubject):
        self.real_subject = real_subject
        self.access_count = 0
    
    def request(self) -> str:
        """ä»£ç†è¯·æ±‚"""
        self.access_count += 1
        print(f"Proxy: Access count = {self.access_count}")
        return f"Proxy: {self.real_subject.request()}"
    
    def get_access_count(self) -> int:
        """è·å–è®¿é—®æ¬¡æ•°"""
        return self.access_count

class VirtualProxy(Subject):
    """è™šæ‹Ÿä»£ç†"""
    
    def __init__(self, subject_factory: Callable[[], RealSubject]):
        self.subject_factory = subject_factory
        self._real_subject: Optional[RealSubject] = None
    
    def request(self) -> str:
        """è™šæ‹Ÿä»£ç†è¯·æ±‚"""
        if self._real_subject is None:
            print("VirtualProxy: Creating real subject")
            self._real_subject = self.subject_factory()
        return f"VirtualProxy: {self._real_subject.request()}"

class ProtectionProxy(Subject):
    """ä¿æŠ¤ä»£ç†"""
    
    def __init__(self, real_subject: RealSubject, access_level: str):
        self.real_subject = real_subject
        self.access_level = access_level
    
    def request(self) -> str:
        """ä¿æŠ¤ä»£ç†è¯·æ±‚"""
        if self.access_level == "admin":
            return f"ProtectionProxy: {self.real_subject.request()}"
        else:
            return "ProtectionProxy: Access denied"

class StructureAnalyzer:
    """ç»“æ„åˆ†æå™¨"""
    
    @staticmethod
    def analyze_composite_structure(component: Component) -> Dict[str, Any]:
        """åˆ†æç»„åˆç»“æ„"""
        analysis = {
            'type': 'leaf' if isinstance(component, Leaf) else 'composite',
            'name': component.name,
            'children_count': 0,
            'depth': 0,
            'structure': []
        }
        
        if isinstance(component, Composite):
            analysis['children_count'] = len(component.children)
            analysis['structure'] = [
                StructureAnalyzer.analyze_composite_structure(child)
                for child in component.children
            ]
            if analysis['structure']:
                analysis['depth'] = 1 + max(
                    child['depth'] for child in analysis['structure']
                )
        
        return analysis
    
    @staticmethod
    def analyze_adapter_usage(adapter: Adapter) -> Dict[str, Any]:
        """åˆ†æé€‚é…å™¨ä½¿ç”¨æƒ…å†µ"""
        return {
            'target_interface': 'TargetInterface',
            'adaptee_type': type(adapter.adaptee).__name__,
            'adaptation_method': 'request -> specific_request'
        }
    
    @staticmethod
    def analyze_decorator_chain(decorator: Decorator) -> Dict[str, Any]:
        """åˆ†æè£…é¥°å™¨é“¾"""
        chain = []
        current = decorator
        
        while hasattr(current, 'component'):
            chain.append(type(current).__name__)
            current = current.component
        
        if hasattr(current, '__class__'):
            chain.append(type(current).__name__)
        
        return {
            'chain_length': len(chain),
            'decorator_chain': chain
        }

class StructureValidator:
    """ç»“æ„éªŒè¯å™¨"""
    
    @staticmethod
    def validate_composite_pattern(component: Component) -> Dict[str, Any]:
        """éªŒè¯ç»„åˆæ¨¡å¼"""
        validation = {
            'is_valid': True,
            'errors': [],
            'warnings': []
        }
        
        # æ£€æŸ¥ç»„ä»¶ç±»å‹
        if not isinstance(component, (Leaf, Composite)):
            validation['is_valid'] = False
            validation['errors'].append("ç»„ä»¶ç±»å‹ä¸æ­£ç¡®")
        
        # æ£€æŸ¥ç»„åˆç»“æ„
        if isinstance(component, Composite):
            for child in component.children:
                if not isinstance(child, Component):
                    validation['errors'].append(f"å­ç»„ä»¶ç±»å‹ä¸æ­£ç¡®: {type(child)}")
        
        return validation
    
    @staticmethod
    def validate_adapter_pattern(adapter: Adapter) -> Dict[str, Any]:
        """éªŒè¯é€‚é…å™¨æ¨¡å¼"""
        validation = {
            'is_valid': True,
            'errors': [],
            'warnings': []
        }
        
        # æ£€æŸ¥é€‚é…å™¨æ˜¯å¦å®ç°ç›®æ ‡æ¥å£
        if not isinstance(adapter, TargetInterface):
            validation['is_valid'] = False
            validation['errors'].append("é€‚é…å™¨æœªå®ç°ç›®æ ‡æ¥å£")
        
        # æ£€æŸ¥è¢«é€‚é…å¯¹è±¡
        if not hasattr(adapter, 'adaptee'):
            validation['is_valid'] = False
            validation['errors'].append("ç¼ºå°‘è¢«é€‚é…å¯¹è±¡")
        
        return validation
    
    @staticmethod
    def validate_decorator_pattern(decorator: Decorator) -> Dict[str, Any]:
        """éªŒè¯è£…é¥°å™¨æ¨¡å¼"""
        validation = {
            'is_valid': True,
            'errors': [],
            'warnings': []
        }
        
        # æ£€æŸ¥è£…é¥°å™¨ç»“æ„
        if not hasattr(decorator, 'component'):
            validation['is_valid'] = False
            validation['errors'].append("è£…é¥°å™¨ç¼ºå°‘ç»„ä»¶å¼•ç”¨")
        
        # æ£€æŸ¥è£…é¥°å™¨é“¾
        chain_length = 0
        current = decorator
        while hasattr(current, 'component'):
            chain_length += 1
            current = current.component
            if chain_length > 10:  # é˜²æ­¢æ— é™å¾ªç¯
                validation['warnings'].append("è£…é¥°å™¨é“¾è¿‡é•¿")
                break
        
        return validation

class StructureBuilder:
    """ç»“æ„æ„å»ºå™¨"""
    
    @staticmethod
    def build_composite_tree(structure: Dict[str, Any]) -> Component:
        """æ„å»ºç»„åˆæ ‘"""
        name = structure['name']
        children = structure.get('children', [])
        
        if not children:
            return Leaf(name)
        else:
            composite = Composite(name)
            for child_structure in children:
                child = StructureBuilder.build_composite_tree(child_structure)
                composite.add(child)
            return composite
    
    @staticmethod
    def build_decorator_chain(component: ComponentInterface, 
                             decorators: List[Type[Decorator]]) -> ComponentInterface:
        """æ„å»ºè£…é¥°å™¨é“¾"""
        result = component
        for decorator_class in decorators:
            result = decorator_class(result)
        return result
    
    @staticmethod
    def build_adapter(adaptee: Any, target_interface: Type) -> Any:
        """æ„å»ºé€‚é…å™¨"""
        class DynamicAdapter(target_interface):
            def __init__(self, adaptee):
                self.adaptee = adaptee
            
            def request(self):
                return f"DynamicAdapter: {self.adaptee.specific_request()}"
        
        return DynamicAdapter(adaptee)
```

### 3.2 å®é™…åº”ç”¨ç¤ºä¾‹

```python
def adapter_pattern_example():
    """é€‚é…å™¨æ¨¡å¼ç¤ºä¾‹"""
    
    print("=== é€‚é…å™¨æ¨¡å¼ç¤ºä¾‹ ===")
    
    # åˆ›å»ºè¢«é€‚é…å¯¹è±¡
    adaptee = Adaptee()
    print("è¢«é€‚é…å¯¹è±¡:", adaptee.specific_request())
    
    # åˆ›å»ºé€‚é…å™¨
    adapter = Adapter(adaptee)
    print("é€‚é…å™¨:", adapter.request())
    
    # å®¢æˆ·ç«¯ä½¿ç”¨ç›®æ ‡æ¥å£
    def client_code(target: TargetInterface):
        return target.request()
    
    result = client_code(adapter)
    print("å®¢æˆ·ç«¯è°ƒç”¨:", result)
    
    # åˆ†æé€‚é…å™¨ä½¿ç”¨æƒ…å†µ
    analyzer = StructureAnalyzer()
    analysis = analyzer.analyze_adapter_usage(adapter)
    print("é€‚é…å™¨åˆ†æ:", analysis)
    
    return adapter

def bridge_pattern_example():
    """æ¡¥æ¥æ¨¡å¼ç¤ºä¾‹"""
    
    print("\n=== æ¡¥æ¥æ¨¡å¼ç¤ºä¾‹ ===")
    
    # åˆ›å»ºä¸åŒçš„å®ç°
    implementor_a = ConcreteImplementorA()
    implementor_b = ConcreteImplementorB()
    
    # åˆ›å»ºç²¾ç¡®æŠ½è±¡
    abstraction_a = RefinedAbstraction(implementor_a)
    abstraction_b = RefinedAbstraction(implementor_b)
    
    # ä½¿ç”¨æŠ½è±¡
    print("æŠ½è±¡A:", abstraction_a.operation())
    print("æŠ½è±¡B:", abstraction_b.operation())
    
    return abstraction_a, abstraction_b

def composite_pattern_example():
    """ç»„åˆæ¨¡å¼ç¤ºä¾‹"""
    
    print("\n=== ç»„åˆæ¨¡å¼ç¤ºä¾‹ ===")
    
    # åˆ›å»ºå¶å­èŠ‚ç‚¹
    leaf1 = Leaf("Leaf1")
    leaf2 = Leaf("Leaf2")
    leaf3 = Leaf("Leaf3")
    
    # åˆ›å»ºç»„åˆèŠ‚ç‚¹
    composite1 = Composite("Composite1")
    composite1.add(leaf1)
    composite1.add(leaf2)
    
    composite2 = Composite("Composite2")
    composite2.add(leaf3)
    composite2.add(composite1)
    
    # æ‰§è¡Œæ“ä½œ
    print("å¶å­èŠ‚ç‚¹:", leaf1.operation())
    print("ç»„åˆèŠ‚ç‚¹1:", composite1.operation())
    print("ç»„åˆèŠ‚ç‚¹2:", composite2.operation())
    
    # åˆ†æç»„åˆç»“æ„
    analyzer = StructureAnalyzer()
    analysis = analyzer.analyze_composite_structure(composite2)
    print("ç»„åˆç»“æ„åˆ†æ:", analysis)
    
    return composite2

def decorator_pattern_example():
    """è£…é¥°å™¨æ¨¡å¼ç¤ºä¾‹"""
    
    print("\n=== è£…é¥°å™¨æ¨¡å¼ç¤ºä¾‹ ===")
    
    # åˆ›å»ºå…·ä½“ç»„ä»¶
    component = ConcreteComponent("BaseComponent")
    print("åŸå§‹ç»„ä»¶:", component.operation())
    
    # åˆ›å»ºè£…é¥°å™¨é“¾
    decorator_a = ConcreteDecoratorA(component)
    decorator_b = ConcreteDecoratorB(decorator_a)
    
    print("è£…é¥°å™¨A:", decorator_a.operation())
    print("è£…é¥°å™¨B:", decorator_b.operation())
    
    # åˆ†æè£…é¥°å™¨é“¾
    analyzer = StructureAnalyzer()
    analysis = analyzer.analyze_decorator_chain(decorator_b)
    print("è£…é¥°å™¨é“¾åˆ†æ:", analysis)
    
    # ä½¿ç”¨æ„å»ºå™¨åˆ›å»ºè£…é¥°å™¨é“¾
    builder = StructureBuilder()
    decorators = [ConcreteDecoratorA, ConcreteDecoratorB]
    chain = builder.build_decorator_chain(component, decorators)
    print("æ„å»ºçš„è£…é¥°å™¨é“¾:", chain.operation())
    
    return decorator_b

def facade_pattern_example():
    """å¤–è§‚æ¨¡å¼ç¤ºä¾‹"""
    
    print("\n=== å¤–è§‚æ¨¡å¼ç¤ºä¾‹ ===")
    
    # åˆ›å»ºå¤–è§‚
    facade = Facade()
    
    # å®¢æˆ·ç«¯é€šè¿‡å¤–è§‚è®¿é—®å­ç³»ç»Ÿ
    print("æ“ä½œ1:", facade.operation1())
    print("æ“ä½œ2:", facade.operation2())
    
    # ç›´æ¥è®¿é—®å­ç³»ç»Ÿï¼ˆå¤æ‚ï¼‰
    subsystem_a = SubsystemA()
    subsystem_b = SubsystemB()
    subsystem_c = SubsystemC()
    
    complex_operation = " -> ".join([
        subsystem_a.operation_a1(),
        subsystem_b.operation_b1(),
        subsystem_c.operation_c1()
    ])
    print("ç›´æ¥è®¿é—®å­ç³»ç»Ÿ:", complex_operation)
    
    return facade

def flyweight_pattern_example():
    """äº«å…ƒæ¨¡å¼ç¤ºä¾‹"""
    
    print("\n=== äº«å…ƒæ¨¡å¼ç¤ºä¾‹ ===")
    
    # åˆ›å»ºäº«å…ƒå·¥å‚
    factory = FlyweightFactory()
    
    # è·å–äº«å…ƒ
    flyweight1 = factory.get_flyweight("key1")
    flyweight2 = factory.get_flyweight("key2")
    flyweight3 = factory.get_flyweight("key1")  # å¤ç”¨
    
    # ä½¿ç”¨äº«å…ƒ
    print("äº«å…ƒ1:", flyweight1.operation("state1"))
    print("äº«å…ƒ2:", flyweight2.operation("state2"))
    print("äº«å…ƒ3:", flyweight3.operation("state3"))
    
    # æ£€æŸ¥äº«å…ƒæ•°é‡
    print("äº«å…ƒæ•°é‡:", factory.get_flyweight_count())
    print("äº«å…ƒ1å’Œäº«å…ƒ3æ˜¯å¦ç›¸åŒ:", flyweight1 is flyweight3)
    
    return factory

def proxy_pattern_example():
    """ä»£ç†æ¨¡å¼ç¤ºä¾‹"""
    
    print("\n=== ä»£ç†æ¨¡å¼ç¤ºä¾‹ ===")
    
    # åˆ›å»ºçœŸå®ä¸»é¢˜
    real_subject = RealSubject("RealSubject")
    
    # åˆ›å»ºä»£ç†
    proxy = Proxy(real_subject)
    
    # é€šè¿‡ä»£ç†è®¿é—®
    print("ç¬¬ä¸€æ¬¡è®¿é—®:", proxy.request())
    print("ç¬¬äºŒæ¬¡è®¿é—®:", proxy.request())
    print("è®¿é—®æ¬¡æ•°:", proxy.get_access_count())
    
    # è™šæ‹Ÿä»£ç†
    def create_real_subject():
        return RealSubject("VirtualSubject")
    
    virtual_proxy = VirtualProxy(create_real_subject)
    print("è™šæ‹Ÿä»£ç†ç¬¬ä¸€æ¬¡è®¿é—®:", virtual_proxy.request())
    print("è™šæ‹Ÿä»£ç†ç¬¬äºŒæ¬¡è®¿é—®:", virtual_proxy.request())
    
    # ä¿æŠ¤ä»£ç†
    protection_proxy_admin = ProtectionProxy(real_subject, "admin")
    protection_proxy_user = ProtectionProxy(real_subject, "user")
    
    print("ç®¡ç†å‘˜è®¿é—®:", protection_proxy_admin.request())
    print("ç”¨æˆ·è®¿é—®:", protection_proxy_user.request())
    
    return proxy, virtual_proxy, protection_proxy_admin

def structure_validation_example():
    """ç»“æ„éªŒè¯ç¤ºä¾‹"""
    
    print("\n=== ç»“æ„éªŒè¯ç¤ºä¾‹ ===")
    
    validator = StructureValidator()
    
    # éªŒè¯ç»„åˆæ¨¡å¼
    leaf = Leaf("TestLeaf")
    composite = Composite("TestComposite")
    composite.add(leaf)
    
    leaf_validation = validator.validate_composite_pattern(leaf)
    composite_validation = validator.validate_composite_pattern(composite)
    
    print("å¶å­èŠ‚ç‚¹éªŒè¯:", leaf_validation)
    print("ç»„åˆèŠ‚ç‚¹éªŒè¯:", composite_validation)
    
    # éªŒè¯é€‚é…å™¨æ¨¡å¼
    adaptee = Adaptee()
    adapter = Adapter(adaptee)
    adapter_validation = validator.validate_adapter_pattern(adapter)
    
    print("é€‚é…å™¨éªŒè¯:", adapter_validation)
    
    # éªŒè¯è£…é¥°å™¨æ¨¡å¼
    component = ConcreteComponent("TestComponent")
    decorator = ConcreteDecoratorA(component)
    decorator_validation = validator.validate_decorator_pattern(decorator)
    
    print("è£…é¥°å™¨éªŒè¯:", decorator_validation)
    
    return validator

def structure_builder_example():
    """ç»“æ„æ„å»ºå™¨ç¤ºä¾‹"""
    
    print("\n=== ç»“æ„æ„å»ºå™¨ç¤ºä¾‹ ===")
    
    builder = StructureBuilder()
    
    # æ„å»ºç»„åˆæ ‘
    tree_structure = {
        'name': 'Root',
        'children': [
            {
                'name': 'Branch1',
                'children': [
                    {'name': 'Leaf1', 'children': []},
                    {'name': 'Leaf2', 'children': []}
                ]
            },
            {
                'name': 'Branch2',
                'children': [
                    {'name': 'Leaf3', 'children': []}
                ]
            }
        ]
    }
    
    tree = builder.build_composite_tree(tree_structure)
    print("æ„å»ºçš„ç»„åˆæ ‘:")
    print(tree.operation())
    
    # æ„å»ºè£…é¥°å™¨é“¾
    component = ConcreteComponent("TestComponent")
    decorators = [ConcreteDecoratorA, ConcreteDecoratorB]
    chain = builder.build_decorator_chain(component, decorators)
    print("æ„å»ºçš„è£…é¥°å™¨é“¾:", chain.operation())
    
    return builder

# è¿è¡Œç¤ºä¾‹
if __name__ == "__main__":
    print("=== ç»“æ„å‹æ¨¡å¼ç³»ç»Ÿæ¼”ç¤º ===")
    
    # é€‚é…å™¨æ¨¡å¼ç¤ºä¾‹
    adapter = adapter_pattern_example()
    
    # æ¡¥æ¥æ¨¡å¼ç¤ºä¾‹
    bridge_a, bridge_b = bridge_pattern_example()
    
    # ç»„åˆæ¨¡å¼ç¤ºä¾‹
    composite = composite_pattern_example()
    
    # è£…é¥°å™¨æ¨¡å¼ç¤ºä¾‹
    decorator = decorator_pattern_example()
    
    # å¤–è§‚æ¨¡å¼ç¤ºä¾‹
    facade = facade_pattern_example()
    
    # äº«å…ƒæ¨¡å¼ç¤ºä¾‹
    flyweight_factory = flyweight_pattern_example()
    
    # ä»£ç†æ¨¡å¼ç¤ºä¾‹
    proxy, virtual_proxy, protection_proxy = proxy_pattern_example()
    
    # ç»“æ„éªŒè¯ç¤ºä¾‹
    validator = structure_validation_example()
    
    # ç»“æ„æ„å»ºå™¨ç¤ºä¾‹
    builder = structure_builder_example()
    
    print("\n=== ç³»ç»ŸåŠŸèƒ½æ€»ç»“ ===")
    print("1. é€‚é…å™¨æ¨¡å¼: æ¥å£è½¬æ¢")
    print("2. æ¡¥æ¥æ¨¡å¼: æŠ½è±¡ä¸å®ç°åˆ†ç¦»")
    print("3. ç»„åˆæ¨¡å¼: æ ‘å½¢ç»“æ„")
    print("4. è£…é¥°å™¨æ¨¡å¼: åŠ¨æ€æ‰©å±•")
    print("5. å¤–è§‚æ¨¡å¼: ç®€åŒ–æ¥å£")
    print("6. äº«å…ƒæ¨¡å¼: å¯¹è±¡å¤ç”¨")
    print("7. ä»£ç†æ¨¡å¼: è®¿é—®æ§åˆ¶")
    print("8. ç»“æ„åˆ†æ: åˆ†ææ¨¡å¼ä½¿ç”¨")
    print("9. ç»“æ„éªŒè¯: éªŒè¯æ¨¡å¼å®ç°")
    print("10. ç»“æ„æ„å»º: æ„å»ºå¤æ‚ç»“æ„")
```

## 4. ç†è®ºè¯æ˜

### 4.1 ç»“æ„å‹æ¨¡å¼æ­£ç¡®æ€§

**å®šç† 4.1** (ç»“æ„å‹æ¨¡å¼æ­£ç¡®æ€§)
å¦‚æœç»“æ„å‹æ¨¡å¼å®ç°æ­£ç¡®ï¼Œåˆ™ç»„ä»¶é—´çš„ç»“æ„å…³ç³»æ»¡è¶³é¢„å®šä¹‰çš„çº¦æŸæ¡ä»¶ã€‚

**è¯æ˜**:
è®¾ $C$ æ˜¯ç»„ä»¶é›†åˆï¼Œ$R$ æ˜¯å…³ç³»é›†åˆï¼Œ$P$ æ˜¯çº¦æŸæ¡ä»¶é›†åˆã€‚

å¯¹äºæ¯ä¸ªç»“æ„å‹æ¨¡å¼ï¼š
1. ç»„ä»¶å®ç°æ­£ç¡®çš„æ¥å£
2. å…³ç³»æ»¡è¶³é¢„å®šä¹‰çš„çº¦æŸ
3. æ“ä½œéµå¾ªè®¾è®¡æ¨¡å¼çš„åŸåˆ™

å› æ­¤ï¼Œç»“æ„å…³ç³»æ»¡è¶³é¢„å®šä¹‰çš„çº¦æŸæ¡ä»¶ã€‚$\square$

### 4.2 æ¨¡å¼ç»„åˆæ€§

**å®šç† 4.2** (ç»“æ„å‹æ¨¡å¼ç»„åˆæ€§)
ä»»æ„ä¸¤ä¸ªç»“æ„å‹æ¨¡å¼å¯ä»¥ç»„åˆå½¢æˆæ–°çš„ç»“æ„å‹æ¨¡å¼ã€‚

**è¯æ˜**:
è®¾ $P_1$ å’Œ $P_2$ æ˜¯ä¸¤ä¸ªç»“æ„å‹æ¨¡å¼ï¼Œå…¶ç»„ä»¶åˆ†åˆ«ä¸º $C_1$ å’Œ $C_2$ã€‚

é€šè¿‡ç»„åˆæ“ä½œ $\oplus$ï¼Œå¯ä»¥æ„é€ æ–°çš„ç»“æ„å‹æ¨¡å¼ $P = P_1 \oplus P_2$ï¼Œå…¶ä¸­ï¼š
- ç»„ä»¶é›†åˆï¼š$C = C_1 \times C_2$
- å…³ç³»é›†åˆï¼š$R = R_1 \times R_2$
- çº¦æŸæ¡ä»¶ï¼š$P = P_1 \cap P_2$

ç”±äºç»“æ„å‹æ¨¡å¼åŸºäºé¢å‘å¯¹è±¡åŸåˆ™ï¼Œç»„åˆæ“ä½œä¿æŒæ¨¡å¼çš„æœ‰æ•ˆæ€§ã€‚
å› æ­¤ï¼Œç»“æ„å‹æ¨¡å¼å…·æœ‰ç»„åˆæ€§ã€‚$\square$

## 5. æ€§èƒ½åˆ†æ

### 5.1 ç»“æ„æ“ä½œå¤æ‚åº¦

**å®šç† 5.1** (ç»„åˆæ¨¡å¼å¤æ‚åº¦)
ç»„åˆæ¨¡å¼çš„æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ï¼Œå…¶ä¸­ $n$ æ˜¯èŠ‚ç‚¹æ•°é‡ã€‚

**è¯æ˜**:
ç»„åˆæ¨¡å¼çš„ä¸»è¦æ“ä½œï¼š
1. éå†æ‰€æœ‰å­èŠ‚ç‚¹ï¼š$O(n)$
2. æ‰§è¡Œæ¯ä¸ªèŠ‚ç‚¹çš„æ“ä½œï¼š$O(1)$
3. åˆå¹¶ç»“æœï¼š$O(n)$

æ€»æ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ã€‚$\square$

**å®šç† 5.2** (è£…é¥°å™¨æ¨¡å¼å¤æ‚åº¦)
è£…é¥°å™¨æ¨¡å¼çš„æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸º $O(d)$ï¼Œå…¶ä¸­ $d$ æ˜¯è£…é¥°å™¨é“¾é•¿åº¦ã€‚

**è¯æ˜**:
è£…é¥°å™¨æ¨¡å¼çš„ä¸»è¦æ­¥éª¤ï¼š
1. éå†è£…é¥°å™¨é“¾ï¼š$O(d)$
2. æ‰§è¡Œæ¯ä¸ªè£…é¥°å™¨ï¼š$O(1)$
3. è¿”å›ç»“æœï¼š$O(1)$

æ€»æ—¶é—´å¤æ‚åº¦ä¸º $O(d)$ã€‚$\square$

### 5.2 å†…å­˜ä½¿ç”¨åˆ†æ

**å®šç† 5.3** (äº«å…ƒæ¨¡å¼å†…å­˜æ•ˆç‡)
äº«å…ƒæ¨¡å¼çš„å†…å­˜ä½¿ç”¨æ•ˆç‡ä¸º $O(k)$ï¼Œå…¶ä¸­ $k$ æ˜¯å”¯ä¸€äº«å…ƒæ•°é‡ã€‚

**è¯æ˜**:
äº«å…ƒæ¨¡å¼çš„å†…å­˜ä½¿ç”¨ï¼š
1. äº«å…ƒå¯¹è±¡ï¼š$O(k)$
2. å¤–éƒ¨çŠ¶æ€ï¼š$O(n)$
3. ç®¡ç†å¼€é”€ï¼š$O(1)$

å…¶ä¸­ $n$ æ˜¯ä½¿ç”¨äº«å…ƒçš„å¯¹è±¡æ•°é‡ï¼Œ$k$ æ˜¯å”¯ä¸€äº«å…ƒæ•°é‡ã€‚
ç”±äº $k \ll n$ï¼Œå†…å­˜ä½¿ç”¨æ•ˆç‡ä¸º $O(k)$ã€‚$\square$

## 6. å®é™…åº”ç”¨

### 6.1 å›¾å½¢ç•Œé¢

ç»“æ„å‹æ¨¡å¼åœ¨å›¾å½¢ç•Œé¢ä¸­çš„åº”ç”¨ï¼š
- ç»„ä»¶æ ‘ç»“æ„
- è£…é¥°å™¨æ‰©å±•
- é€‚é…å™¨è½¬æ¢
- ä»£ç†æ§åˆ¶

### 6.2 æ•°æ®å¤„ç†

ç»“æ„å‹æ¨¡å¼åœ¨æ•°æ®å¤„ç†ä¸­çš„åº”ç”¨ï¼š
- æ•°æ®æµç®¡é“
- è¿‡æ»¤å™¨é“¾
- é€‚é…å™¨è½¬æ¢
- ç¼“å­˜ä»£ç†

### 6.3 ç½‘ç»œé€šä¿¡

ç»“æ„å‹æ¨¡å¼åœ¨ç½‘ç»œé€šä¿¡ä¸­çš„åº”ç”¨ï¼š
- åè®®é€‚é…å™¨
- è¿æ¥ä»£ç†
- è£…é¥°å™¨æ‰©å±•
- å¤–è§‚ç®€åŒ–

## 7. æ€»ç»“

ç»“æ„å‹æ¨¡å¼æ˜¯è½¯ä»¶è®¾è®¡ä¸­çš„é‡è¦å·¥å…·ï¼Œé€šè¿‡ä¸¥æ ¼çš„å½¢å¼åŒ–å®šä¹‰å’Œå®Œæ•´çš„Pythonå®ç°ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªå®Œæ•´çš„ç»“æ„å‹æ¨¡å¼ç†è®ºæ¡†æ¶ã€‚

### ä¸»è¦ç‰¹ç‚¹

1. **å½¢å¼åŒ–**: ä¸¥æ ¼çš„æ•°å­¦å®šä¹‰å’Œåˆ†ç±»ä½“ç³»
2. **ç³»ç»Ÿæ€§**: å®Œæ•´çš„æ¨¡å¼å®ç°å’Œç®¡ç†ç³»ç»Ÿ
3. **å®ç”¨æ€§**: å®Œæ•´çš„Pythonå®ç°å’Œå®é™…åº”ç”¨
4. **å¯æ‰©å±•æ€§**: æ”¯æŒæ–°æ¨¡å¼çš„æ·»åŠ å’Œç»„åˆ

### æ ¸å¿ƒè´¡çŒ®

1. **ç†è®ºæ¡†æ¶**: å»ºç«‹äº†å®Œæ•´çš„ç»“æ„å‹æ¨¡å¼ç†è®ºä½“ç³»
2. **å®ç°ç³»ç»Ÿ**: æä¾›äº†å®Œæ•´çš„Pythonæ¨¡å¼å·¥å…·
3. **åˆ†æå·¥å…·**: æä¾›äº†æ¨¡å¼åˆ†æå’ŒéªŒè¯åŠŸèƒ½
4. **æ„å»ºå·¥å…·**: æä¾›äº†å¤æ‚ç»“æ„çš„æ„å»ºåŠŸèƒ½

è¿™ä¸ªæ¡†æ¶ä¸ºåç»­çš„è¡Œä¸ºå‹æ¨¡å¼æä¾›äº†é‡è¦çš„ç†è®ºåŸºç¡€ï¼Œç¡®ä¿æ•´ä¸ªè®¾è®¡æ¨¡å¼ä½“ç³»çš„ç§‘å­¦æ€§å’Œå®ç”¨æ€§ã€‚

---

*æœ€åæ›´æ–°: 2024-12-19*
*æ–‡æ¡£çŠ¶æ€: å·²å®Œæˆ* 