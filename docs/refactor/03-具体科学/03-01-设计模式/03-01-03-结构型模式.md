# ç»“æ„å‹æ¨¡å¼ (Structural Patterns)

## ğŸ“‹ æ¦‚è¿°

ç»“æ„å‹æ¨¡å¼å…³æ³¨ç±»å’Œå¯¹è±¡çš„ç»„åˆï¼Œå½¢æˆæ›´å¤§çš„ç»“æ„ï¼Œé‡ç‚¹åœ¨äºå¦‚ä½•ç»„ç»‡ç±»å’Œå¯¹è±¡ä»¥å½¢æˆæ›´å¤æ‚çš„ç»“æ„ï¼ŒåŒæ—¶ä¿æŒç»“æ„çš„çµæ´»æ€§å’Œå¯å¤ç”¨æ€§ã€‚

## 1. å½¢å¼åŒ–å®šä¹‰

### 1.1 ç»“æ„å‹æ¨¡å¼çš„å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 1.1** (ç»“æ„å‹æ¨¡å¼)
ç»“æ„å‹æ¨¡å¼æ˜¯ä¸€ä¸ªä¸‰å…ƒç»„ $\mathcal{S} = (C, R, \mathcal{F})$ï¼Œå…¶ä¸­ï¼š

- $C$ æ˜¯ç±»çš„é›†åˆ
- $R$ æ˜¯ç±»ä¹‹é—´å…³ç³»çš„é›†åˆ
- $\mathcal{F}$ æ˜¯ç»“æ„å˜æ¢å‡½æ•°çš„é›†åˆ

**å®šä¹‰ 1.2** (ç»“æ„å…³ç³»)
å¯¹äºç±» $c_1, c_2 \in C$ï¼Œç»“æ„å…³ç³» $r \in R$ å®šä¹‰ä¸ºï¼š
$$r: C \times C \rightarrow \{composition, inheritance, association, dependency\}$$

**å®šä¹‰ 1.3** (ç»“æ„å˜æ¢)
ç»“æ„å˜æ¢å‡½æ•° $f \in \mathcal{F}$ å®šä¹‰ä¸ºï¼š
$$f: (C, R) \rightarrow (C', R')$$
å…¶ä¸­ $C' \subseteq C$ ä¸” $R' \subseteq R$

### 1.2 ç»“æ„å‹æ¨¡å¼çš„åˆ†ç±»

ç»“æ„å‹æ¨¡å¼å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š

1. **æ¥å£é€‚é…ç±»**: é€‚é…å™¨æ¨¡å¼
2. **ç»“æ„ç»„åˆç±»**: ç»„åˆæ¨¡å¼ã€è£…é¥°å™¨æ¨¡å¼
3. **ç»“æ„åˆ†ç¦»ç±»**: æ¡¥æ¥æ¨¡å¼ã€å¤–è§‚æ¨¡å¼
4. **ç»“æ„æ§åˆ¶ç±»**: ä»£ç†æ¨¡å¼ã€äº«å…ƒæ¨¡å¼

## 2. é€‚é…å™¨æ¨¡å¼ (Adapter Pattern)

### 2.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 2.1** (é€‚é…å™¨æ¨¡å¼)
é€‚é…å™¨æ¨¡å¼æ˜¯ä¸€ä¸ªå››å…ƒç»„ $\mathcal{A} = (T, A, C, \phi)$ï¼Œå…¶ä¸­ï¼š

- $T$ æ˜¯ç›®æ ‡æ¥å£
- $A$ æ˜¯é€‚é…å™¨ç±»
- $C$ æ˜¯è¢«é€‚é…çš„ç±»
- $\phi: C \rightarrow T$ æ˜¯é€‚é…å‡½æ•°

**å®šç† 2.1** (é€‚é…å™¨å­˜åœ¨æ€§)
å¯¹äºä»»æ„ä¸å…¼å®¹çš„æ¥å£ $I_1$ å’Œ $I_2$ï¼Œå­˜åœ¨é€‚é…å™¨ $A$ ä½¿å¾—ï¼š
$$\forall x \in I_1, \exists y \in I_2: A(x) = y$$

### 2.2 Pythonå®ç°

```python
from abc import ABC, abstractmethod
from typing import Protocol, TypeVar, Generic
import logging

# ç±»å‹å˜é‡
T = TypeVar('T')
U = TypeVar('U')

class TargetInterface(Protocol[T]):
    """ç›®æ ‡æ¥å£"""
    
    def request(self, data: T) -> str:
        """è¯·æ±‚æ–¹æ³•"""
        ...

class Adaptee:
    """è¢«é€‚é…çš„ç±»"""
    
    def specific_request(self, data: str) -> str:
        """ç‰¹å®šçš„è¯·æ±‚æ–¹æ³•"""
        return f"Adaptee: {data}"

class Adapter:
    """é€‚é…å™¨ç±»"""
    
    def __init__(self, adaptee: Adaptee):
        self._adaptee = adaptee
    
    def request(self, data: str) -> str:
        """é€‚é…ç›®æ ‡æ¥å£çš„è¯·æ±‚æ–¹æ³•"""
        # è½¬æ¢æ•°æ®æ ¼å¼
        converted_data = self._convert_data(data)
        # è°ƒç”¨è¢«é€‚é…å¯¹è±¡çš„æ–¹æ³•
        result = self._adaptee.specific_request(converted_data)
        # è½¬æ¢è¿”å›ç»“æœ
        return self._convert_result(result)
    
    def _convert_data(self, data: str) -> str:
        """è½¬æ¢è¾“å…¥æ•°æ®"""
        return f"converted_{data}"
    
    def _convert_result(self, result: str) -> str:
        """è½¬æ¢è¾“å‡ºç»“æœ"""
        return f"Adapter: {result}"

class GenericAdapter(Generic[T, U]):
    """æ³›å‹é€‚é…å™¨"""
    
    def __init__(self, adaptee: T):
        self._adaptee = adaptee
    
    def adapt(self, data: U) -> str:
        """æ³›å‹é€‚é…æ–¹æ³•"""
        raise NotImplementedError

# ä½¿ç”¨ç¤ºä¾‹
def adapter_example():
    """é€‚é…å™¨æ¨¡å¼ä½¿ç”¨ç¤ºä¾‹"""
    # åˆ›å»ºè¢«é€‚é…å¯¹è±¡
    adaptee = Adaptee()
    
    # åˆ›å»ºé€‚é…å™¨
    adapter = Adapter(adaptee)
    
    # é€šè¿‡ç›®æ ‡æ¥å£ä½¿ç”¨
    result = adapter.request("test_data")
    print(result)  # è¾“å‡º: Adapter: Adaptee: converted_test_data

if __name__ == "__main__":
    adapter_example()
```

### 2.3 æ€§èƒ½åˆ†æ

**å®šç† 2.2** (é€‚é…å™¨å¤æ‚åº¦)
é€‚é…å™¨æ¨¡å¼çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(1)$ï¼Œç©ºé—´å¤æ‚åº¦ä¸º $O(1)$ã€‚

**è¯æ˜**:

- é€‚é…å™¨åªè¿›è¡Œç®€å•çš„æ•°æ®è½¬æ¢ï¼Œä¸æ¶‰åŠå¤æ‚è®¡ç®—
- é¢å¤–å­˜å‚¨ç©ºé—´ä»…ä¸ºé€‚é…å™¨å¯¹è±¡æœ¬èº«

## 3. æ¡¥æ¥æ¨¡å¼ (Bridge Pattern)

### 3.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 3.1** (æ¡¥æ¥æ¨¡å¼)
æ¡¥æ¥æ¨¡å¼æ˜¯ä¸€ä¸ªäº”å…ƒç»„ $\mathcal{B} = (A, I, R, \mathcal{M}, \phi)$ï¼Œå…¶ä¸­ï¼š

- $A$ æ˜¯æŠ½è±¡ç±»é›†åˆ
- $I$ æ˜¯å®ç°ç±»é›†åˆ
- $R$ æ˜¯æŠ½è±¡ä¸å®ç°çš„å…³ç³»é›†åˆ
- $\mathcal{M}$ æ˜¯æ–¹æ³•é›†åˆ
- $\phi: A \times I \rightarrow R$ æ˜¯æ¡¥æ¥å‡½æ•°

**å®šç† 3.1** (æ¡¥æ¥ç‹¬ç«‹æ€§)
åœ¨æ¡¥æ¥æ¨¡å¼ä¸­ï¼ŒæŠ½è±¡å’Œå®ç°å¯ä»¥ç‹¬ç«‹å˜åŒ–ï¼š
$$\forall a \in A, \forall i_1, i_2 \in I: \phi(a, i_1) \neq \phi(a, i_2) \Rightarrow i_1 \neq i_2$$

### 3.2 Pythonå®ç°

```python
from abc import ABC, abstractmethod
from typing import Protocol, TypeVar, Generic
from dataclasses import dataclass

T = TypeVar('T')

class Implementation(Protocol):
    """å®ç°æ¥å£"""
    
    def operation_impl(self) -> str:
        """å…·ä½“å®ç°"""
        ...

class Abstraction(ABC):
    """æŠ½è±¡ç±»"""
    
    def __init__(self, implementation: Implementation):
        self._implementation = implementation
    
    def operation(self) -> str:
        """æŠ½è±¡æ“ä½œ"""
        return f"Abstraction: {self._implementation.operation_impl()}"
    
    @abstractmethod
    def extended_operation(self) -> str:
        """æ‰©å±•æ“ä½œ"""
        pass

class RefinedAbstraction(Abstraction):
    """ç²¾åŒ–æŠ½è±¡ç±»"""
    
    def extended_operation(self) -> str:
        """æ‰©å±•æ“ä½œå®ç°"""
        return f"Refined: {self.operation()}"

class ConcreteImplementationA:
    """å…·ä½“å®ç°A"""
    
    def operation_impl(self) -> str:
        return "ConcreteImplementationA"

class ConcreteImplementationB:
    """å…·ä½“å®ç°B"""
    
    def operation_impl(self) -> str:
        return "ConcreteImplementationB"

@dataclass
class BridgeContext:
    """æ¡¥æ¥ä¸Šä¸‹æ–‡"""
    abstraction: Abstraction
    implementation: Implementation

class BridgeManager:
    """æ¡¥æ¥ç®¡ç†å™¨"""
    
    def __init__(self):
        self._bridges: dict[str, BridgeContext] = {}
    
    def create_bridge(self, name: str, abstraction: Abstraction, 
                     implementation: Implementation) -> None:
        """åˆ›å»ºæ¡¥æ¥"""
        self._bridges[name] = BridgeContext(abstraction, implementation)
    
    def execute_operation(self, name: str) -> str:
        """æ‰§è¡Œæ“ä½œ"""
        if name not in self._bridges:
            raise ValueError(f"Bridge {name} not found")
        
        bridge = self._bridges[name]
        return bridge.abstraction.operation()

# ä½¿ç”¨ç¤ºä¾‹
def bridge_example():
    """æ¡¥æ¥æ¨¡å¼ä½¿ç”¨ç¤ºä¾‹"""
    # åˆ›å»ºå®ç°
    impl_a = ConcreteImplementationA()
    impl_b = ConcreteImplementationB()
    
    # åˆ›å»ºæŠ½è±¡
    abstraction_a = RefinedAbstraction(impl_a)
    abstraction_b = RefinedAbstraction(impl_b)
    
    # åˆ›å»ºæ¡¥æ¥ç®¡ç†å™¨
    manager = BridgeManager()
    manager.create_bridge("bridge_a", abstraction_a, impl_a)
    manager.create_bridge("bridge_b", abstraction_b, impl_b)
    
    # æ‰§è¡Œæ“ä½œ
    print(manager.execute_operation("bridge_a"))
    print(manager.execute_operation("bridge_b"))
    print(abstraction_a.extended_operation())

if __name__ == "__main__":
    bridge_example()
```

## 4. ç»„åˆæ¨¡å¼ (Composite Pattern)

### 4.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 4.1** (ç»„åˆæ¨¡å¼)
ç»„åˆæ¨¡å¼æ˜¯ä¸€ä¸ªå››å…ƒç»„ $\mathcal{C} = (C, \mathcal{O}, \mathcal{R}, \mathcal{T})$ï¼Œå…¶ä¸­ï¼š

- $C$ æ˜¯ç»„ä»¶é›†åˆ
- $\mathcal{O}$ æ˜¯æ“ä½œé›†åˆ
- $\mathcal{R}$ æ˜¯å…³ç³»é›†åˆ
- $\mathcal{T}$ æ˜¯æ ‘å½¢ç»“æ„

**å®šä¹‰ 4.2** (ç»„ä»¶æ ‘)
ç»„ä»¶æ ‘ $T$ å®šä¹‰ä¸ºï¼š
$$T = (V, E)$$
å…¶ä¸­ $V \subseteq C$ æ˜¯é¡¶ç‚¹é›†åˆï¼Œ$E \subseteq V \times V$ æ˜¯è¾¹é›†åˆ

**å®šç† 4.1** (ç»„åˆä¸€è‡´æ€§)
å¯¹äºç»„åˆæ¨¡å¼ä¸­çš„ä»»æ„ç»„ä»¶ $c \in C$ï¼š
$$\forall o \in \mathcal{O}: c.operation() = \bigcup_{child \in children(c)} child.operation()$$

### 4.2 Pythonå®ç°

```python
from abc import ABC, abstractmethod
from typing import List, Iterator, Optional
from dataclasses import dataclass, field
import uuid

@dataclass
class Component(ABC):
    """ç»„ä»¶æŠ½è±¡åŸºç±»"""
    name: str
    id: str = field(default_factory=lambda: str(uuid.uuid4()))
    
    @abstractmethod
    def operation(self) -> str:
        """æ“ä½œ"""
        pass
    
    @abstractmethod
    def add(self, component: 'Component') -> None:
        """æ·»åŠ å­ç»„ä»¶"""
        pass
    
    @abstractmethod
    def remove(self, component: 'Component') -> None:
        """ç§»é™¤å­ç»„ä»¶"""
        pass
    
    @abstractmethod
    def get_child(self, index: int) -> Optional['Component']:
        """è·å–å­ç»„ä»¶"""
        pass
    
    @abstractmethod
    def is_composite(self) -> bool:
        """æ˜¯å¦ä¸ºç»„åˆå¯¹è±¡"""
        pass

class Leaf(Component):
    """å¶å­èŠ‚ç‚¹"""
    
    def operation(self) -> str:
        return f"Leaf({self.name})"
    
    def add(self, component: Component) -> None:
        raise NotImplementedError("Leaf cannot add children")
    
    def remove(self, component: Component) -> None:
        raise NotImplementedError("Leaf cannot remove children")
    
    def get_child(self, index: int) -> Optional[Component]:
        return None
    
    def is_composite(self) -> bool:
        return False

class Composite(Component):
    """ç»„åˆèŠ‚ç‚¹"""
    
    def __init__(self, name: str):
        super().__init__(name)
        self._children: List[Component] = []
    
    def operation(self) -> str:
        results = [child.operation() for child in self._children]
        return f"Composite({self.name})[{', '.join(results)}]"
    
    def add(self, component: Component) -> None:
        self._children.append(component)
    
    def remove(self, component: Component) -> None:
        self._children.remove(component)
    
    def get_child(self, index: int) -> Optional[Component]:
        if 0 <= index < len(self._children):
            return self._children[index]
        return None
    
    def is_composite(self) -> bool:
        return True
    
    def __iter__(self) -> Iterator[Component]:
        return iter(self._children)
    
    def __len__(self) -> int:
        return len(self._children)

class CompositeTree:
    """ç»„åˆæ ‘ç®¡ç†å™¨"""
    
    def __init__(self, root: Component):
        self._root = root
    
    def traverse(self, visitor: 'ComponentVisitor') -> None:
        """éå†ç»„ä»¶æ ‘"""
        self._traverse_recursive(self._root, visitor)
    
    def _traverse_recursive(self, component: Component, visitor: 'ComponentVisitor') -> None:
        """é€’å½’éå†"""
        visitor.visit(component)
        
        if component.is_composite():
            for child in component:
                self._traverse_recursive(child, visitor)

class ComponentVisitor(ABC):
    """ç»„ä»¶è®¿é—®è€…"""
    
    @abstractmethod
    def visit(self, component: Component) -> None:
        """è®¿é—®ç»„ä»¶"""
        pass

class PrintVisitor(ComponentVisitor):
    """æ‰“å°è®¿é—®è€…"""
    
    def __init__(self):
        self._depth = 0
    
    def visit(self, component: Component) -> None:
        indent = "  " * self._depth
        print(f"{indent}{component.operation()}")
        
        if component.is_composite():
            self._depth += 1

# ä½¿ç”¨ç¤ºä¾‹
def composite_example():
    """ç»„åˆæ¨¡å¼ä½¿ç”¨ç¤ºä¾‹"""
    # åˆ›å»ºå¶å­èŠ‚ç‚¹
    leaf1 = Leaf("Leaf1")
    leaf2 = Leaf("Leaf2")
    leaf3 = Leaf("Leaf3")
    
    # åˆ›å»ºç»„åˆèŠ‚ç‚¹
    composite1 = Composite("Composite1")
    composite2 = Composite("Composite2")
    root = Composite("Root")
    
    # æ„å»ºæ ‘ç»“æ„
    composite1.add(leaf1)
    composite1.add(leaf2)
    composite2.add(leaf3)
    root.add(composite1)
    root.add(composite2)
    
    # æ‰§è¡Œæ“ä½œ
    print("Tree structure:")
    tree = CompositeTree(root)
    visitor = PrintVisitor()
    tree.traverse(visitor)
    
    print(f"\nRoot operation: {root.operation()}")

if __name__ == "__main__":
    composite_example()
```

## 5. è£…é¥°å™¨æ¨¡å¼ (Decorator Pattern)

### 5.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 5.1** (è£…é¥°å™¨æ¨¡å¼)
è£…é¥°å™¨æ¨¡å¼æ˜¯ä¸€ä¸ªå››å…ƒç»„ $\mathcal{D} = (C, D, \mathcal{W}, \mathcal{F})$ï¼Œå…¶ä¸­ï¼š

- $C$ æ˜¯ç»„ä»¶æ¥å£
- $D$ æ˜¯è£…é¥°å™¨é›†åˆ
- $\mathcal{W}$ æ˜¯åŒ…è£…å…³ç³»
- $\mathcal{F}$ æ˜¯åŠŸèƒ½æ‰©å±•é›†åˆ

**å®šä¹‰ 5.2** (è£…é¥°å™¨é“¾)
è£…é¥°å™¨é“¾å®šä¹‰ä¸ºï¼š
$$chain(c) = d_n \circ d_{n-1} \circ \cdots \circ d_1 \circ c$$
å…¶ä¸­ $d_i \in D$ æ˜¯è£…é¥°å™¨ï¼Œ$c \in C$ æ˜¯ç»„ä»¶

**å®šç† 5.1** (è£…é¥°å™¨å¯ç»„åˆæ€§)
è£…é¥°å™¨æ»¡è¶³ç»“åˆå¾‹ï¼š
$$\forall d_1, d_2, d_3 \in D: (d_1 \circ d_2) \circ d_3 = d_1 \circ (d_2 \circ d_3)$$

### 5.2 Pythonå®ç°

```python
from abc import ABC, abstractmethod
from typing import Protocol, TypeVar, Generic, Callable
from dataclasses import dataclass
from functools import wraps

T = TypeVar('T')

class Component(Protocol):
    """ç»„ä»¶æ¥å£"""
    
    def operation(self) -> str:
        """åŸºç¡€æ“ä½œ"""
        ...

class ConcreteComponent:
    """å…·ä½“ç»„ä»¶"""
    
    def operation(self) -> str:
        return "ConcreteComponent"

class Decorator(ABC):
    """è£…é¥°å™¨æŠ½è±¡åŸºç±»"""
    
    def __init__(self, component: Component):
        self._component = component
    
    def operation(self) -> str:
        return self._component.operation()

class ConcreteDecoratorA(Decorator):
    """å…·ä½“è£…é¥°å™¨A"""
    
    def operation(self) -> str:
        return f"ConcreteDecoratorA({super().operation()})"

class ConcreteDecoratorB(Decorator):
    """å…·ä½“è£…é¥°å™¨B"""
    
    def operation(self) -> str:
        return f"ConcreteDecoratorB({super().operation()})"

# å‡½æ•°å¼è£…é¥°å™¨
def decorator_function(func: Callable[[], str]) -> Callable[[], str]:
    """å‡½æ•°å¼è£…é¥°å™¨"""
    @wraps(func)
    def wrapper() -> str:
        result = func()
        return f"Decorated({result})"
    return wrapper

# ç±»è£…é¥°å™¨
class ClassDecorator:
    """ç±»è£…é¥°å™¨"""
    
    def __init__(self, cls: type):
        self._cls = cls
    
    def __call__(self, *args, **kwargs):
        instance = self._cls(*args, **kwargs)
        # æ·»åŠ è£…é¥°åŠŸèƒ½
        original_operation = instance.operation
        
        def decorated_operation() -> str:
            return f"ClassDecorated({original_operation()})"
        
        instance.operation = decorated_operation
        return instance

# è£…é¥°å™¨ç®¡ç†å™¨
class DecoratorManager:
    """è£…é¥°å™¨ç®¡ç†å™¨"""
    
    def __init__(self):
        self._decorators: List[Callable[[Component], Component]] = []
    
    def add_decorator(self, decorator: Callable[[Component], Component]) -> None:
        """æ·»åŠ è£…é¥°å™¨"""
        self._decorators.append(decorator)
    
    def apply_decorators(self, component: Component) -> Component:
        """åº”ç”¨è£…é¥°å™¨"""
        result = component
        for decorator in self._decorators:
            result = decorator(result)
        return result

# ä½¿ç”¨ç¤ºä¾‹
def decorator_example():
    """è£…é¥°å™¨æ¨¡å¼ä½¿ç”¨ç¤ºä¾‹"""
    # åˆ›å»ºåŸºç¡€ç»„ä»¶
    component = ConcreteComponent()
    
    # åº”ç”¨è£…é¥°å™¨
    decorated_a = ConcreteDecoratorA(component)
    decorated_b = ConcreteDecoratorB(decorated_a)
    
    print(f"Original: {component.operation()}")
    print(f"Decorated A: {decorated_a.operation()}")
    print(f"Decorated B: {decorated_b.operation()}")
    
    # ä½¿ç”¨è£…é¥°å™¨ç®¡ç†å™¨
    manager = DecoratorManager()
    manager.add_decorator(lambda c: ConcreteDecoratorA(c))
    manager.add_decorator(lambda c: ConcreteDecoratorB(c))
    
    final_component = manager.apply_decorators(component)
    print(f"Managed: {final_component.operation()}")

if __name__ == "__main__":
    decorator_example()
```

## 6. å¤–è§‚æ¨¡å¼ (Facade Pattern)

### 6.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 6.1** (å¤–è§‚æ¨¡å¼)
å¤–è§‚æ¨¡å¼æ˜¯ä¸€ä¸ªå››å…ƒç»„ $\mathcal{F} = (F, S, \mathcal{I}, \mathcal{M})$ï¼Œå…¶ä¸­ï¼š

- $F$ æ˜¯å¤–è§‚ç±»
- $S$ æ˜¯å­ç³»ç»Ÿé›†åˆ
- $\mathcal{I}$ æ˜¯æ¥å£é›†åˆ
- $\mathcal{M}$ æ˜¯æ˜ å°„å‡½æ•°é›†åˆ

**å®šç† 6.1** (å¤–è§‚ç®€åŒ–æ€§)
å¤–è§‚æ¨¡å¼å°†å¤æ‚åº¦ä» $O(n^2)$ é™ä½åˆ° $O(n)$ï¼š
$$\forall s_1, s_2 \in S: F.interface(s_1, s_2) = \mathcal{M}(s_1, s_2)$$

### 6.2 Pythonå®ç°

```python
from abc import ABC, abstractmethod
from typing import List, Dict, Any
from dataclasses import dataclass
import logging

class SubsystemA:
    """å­ç³»ç»ŸA"""
    
    def operation_a1(self) -> str:
        return "SubsystemA: operation_a1"
    
    def operation_a2(self) -> str:
        return "SubsystemA: operation_a2"

class SubsystemB:
    """å­ç³»ç»ŸB"""
    
    def operation_b1(self) -> str:
        return "SubsystemB: operation_b1"
    
    def operation_b2(self) -> str:
        return "SubsystemB: operation_b2"

class SubsystemC:
    """å­ç³»ç»ŸC"""
    
    def operation_c1(self) -> str:
        return "SubsystemC: operation_c1"
    
    def operation_c2(self) -> str:
        return "SubsystemC: operation_c2"

class Facade:
    """å¤–è§‚ç±»"""
    
    def __init__(self):
        self._subsystem_a = SubsystemA()
        self._subsystem_b = SubsystemB()
        self._subsystem_c = SubsystemC()
        self._logger = logging.getLogger(__name__)
    
    def operation1(self) -> str:
        """æ“ä½œ1ï¼šä½¿ç”¨å­ç³»ç»ŸAå’ŒB"""
        self._logger.info("Starting operation1")
        result_a = self._subsystem_a.operation_a1()
        result_b = self._subsystem_b.operation_b1()
        self._logger.info("Completed operation1")
        return f"{result_a} + {result_b}"
    
    def operation2(self) -> str:
        """æ“ä½œ2ï¼šä½¿ç”¨å­ç³»ç»ŸBå’ŒC"""
        self._logger.info("Starting operation2")
        result_b = self._subsystem_b.operation_b2()
        result_c = self._subsystem_c.operation_c1()
        self._logger.info("Completed operation2")
        return f"{result_b} + {result_c}"
    
    def complex_operation(self) -> str:
        """å¤æ‚æ“ä½œï¼šä½¿ç”¨æ‰€æœ‰å­ç³»ç»Ÿ"""
        self._logger.info("Starting complex operation")
        results = [
            self._subsystem_a.operation_a2(),
            self._subsystem_b.operation_b1(),
            self._subsystem_c.operation_c2()
        ]
        self._logger.info("Completed complex operation")
        return " + ".join(results)

class FacadeManager:
    """å¤–è§‚ç®¡ç†å™¨"""
    
    def __init__(self):
        self._facades: Dict[str, Facade] = {}
    
    def create_facade(self, name: str) -> Facade:
        """åˆ›å»ºå¤–è§‚"""
        facade = Facade()
        self._facades[name] = facade
        return facade
    
    def get_facade(self, name: str) -> Facade:
        """è·å–å¤–è§‚"""
        if name not in self._facades:
            raise ValueError(f"Facade {name} not found")
        return self._facades[name]
    
    def execute_operation(self, name: str, operation: str) -> str:
        """æ‰§è¡Œæ“ä½œ"""
        facade = self.get_facade(name)
        
        if operation == "operation1":
            return facade.operation1()
        elif operation == "operation2":
            return facade.operation2()
        elif operation == "complex":
            return facade.complex_operation()
        else:
            raise ValueError(f"Unknown operation: {operation}")

# ä½¿ç”¨ç¤ºä¾‹
def facade_example():
    """å¤–è§‚æ¨¡å¼ä½¿ç”¨ç¤ºä¾‹"""
    # é…ç½®æ—¥å¿—
    logging.basicConfig(level=logging.INFO)
    
    # åˆ›å»ºå¤–è§‚ç®¡ç†å™¨
    manager = FacadeManager()
    facade = manager.create_facade("main")
    
    # ä½¿ç”¨å¤–è§‚ç®€åŒ–æ¥å£
    print("Operation1:", facade.operation1())
    print("Operation2:", facade.operation2())
    print("Complex operation:", facade.complex_operation())
    
    # é€šè¿‡ç®¡ç†å™¨æ‰§è¡Œæ“ä½œ
    print("Managed operation1:", manager.execute_operation("main", "operation1"))

if __name__ == "__main__":
    facade_example()
```

## 7. äº«å…ƒæ¨¡å¼ (Flyweight Pattern)

### 7.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 7.1** (äº«å…ƒæ¨¡å¼)
äº«å…ƒæ¨¡å¼æ˜¯ä¸€ä¸ªäº”å…ƒç»„ $\mathcal{F} = (F, S, \mathcal{E}, \mathcal{I}, \mathcal{C})$ï¼Œå…¶ä¸­ï¼š

- $F$ æ˜¯äº«å…ƒå·¥å‚
- $S$ æ˜¯äº«å…ƒçŠ¶æ€é›†åˆ
- $\mathcal{E}$ æ˜¯å¤–éƒ¨çŠ¶æ€é›†åˆ
- $\mathcal{I}$ æ˜¯å†…éƒ¨çŠ¶æ€é›†åˆ
- $\mathcal{C}$ æ˜¯ç¼“å­˜é›†åˆ

**å®šç† 7.1** (äº«å…ƒå†…å­˜ä¼˜åŒ–)
äº«å…ƒæ¨¡å¼å°†å†…å­˜ä½¿ç”¨ä» $O(n \times m)$ é™ä½åˆ° $O(n + m)$ï¼š
$$Memory_{flyweight} = |\mathcal{I}| + |\mathcal{E}| \times n$$

### 7.2 Pythonå®ç°

```python
from abc import ABC, abstractmethod
from typing import Dict, Any, Tuple, Optional
from dataclasses import dataclass
from enum import Enum
import weakref

class Color(Enum):
    """é¢œè‰²æšä¸¾"""
    RED = "red"
    GREEN = "blue"
    BLUE = "blue"
    YELLOW = "yellow"
    BLACK = "black"
    WHITE = "white"

@dataclass(frozen=True)
class IntrinsicState:
    """å†…éƒ¨çŠ¶æ€ï¼ˆä¸å¯å˜ï¼‰"""
    color: Color
    texture: str
    shape: str

class Flyweight(ABC):
    """äº«å…ƒæŠ½è±¡åŸºç±»"""
    
    def __init__(self, intrinsic_state: IntrinsicState):
        self._intrinsic_state = intrinsic_state
    
    @abstractmethod
    def operation(self, extrinsic_state: Dict[str, Any]) -> str:
        """æ“ä½œ"""
        pass

class ConcreteFlyweight(Flyweight):
    """å…·ä½“äº«å…ƒ"""
    
    def operation(self, extrinsic_state: Dict[str, Any]) -> str:
        x = extrinsic_state.get('x', 0)
        y = extrinsic_state.get('y', 0)
        return f"ConcreteFlyweight({self._intrinsic_state.color.value}) at ({x}, {y})"

class FlyweightFactory:
    """äº«å…ƒå·¥å‚"""
    
    def __init__(self):
        self._flyweights: Dict[IntrinsicState, Flyweight] = {}
        self._cache_stats = {"hits": 0, "misses": 0}
    
    def get_flyweight(self, intrinsic_state: IntrinsicState) -> Flyweight:
        """è·å–äº«å…ƒ"""
        if intrinsic_state in self._flyweights:
            self._cache_stats["hits"] += 1
            return self._flyweights[intrinsic_state]
        else:
            self._cache_stats["misses"] += 1
            flyweight = ConcreteFlyweight(intrinsic_state)
            self._flyweights[intrinsic_state] = flyweight
            return flyweight
    
    def get_cache_stats(self) -> Dict[str, int]:
        """è·å–ç¼“å­˜ç»Ÿè®¡"""
        return self._cache_stats.copy()
    
    def get_flyweight_count(self) -> int:
        """è·å–äº«å…ƒæ•°é‡"""
        return len(self._flyweights)

class FlyweightContext:
    """äº«å…ƒä¸Šä¸‹æ–‡"""
    
    def __init__(self, flyweight: Flyweight, extrinsic_state: Dict[str, Any]):
        self._flyweight = flyweight
        self._extrinsic_state = extrinsic_state
    
    def operation(self) -> str:
        """æ‰§è¡Œæ“ä½œ"""
        return self._flyweight.operation(self._extrinsic_state)

class FlyweightManager:
    """äº«å…ƒç®¡ç†å™¨"""
    
    def __init__(self):
        self._factory = FlyweightFactory()
        self._contexts: List[FlyweightContext] = []
    
    def create_object(self, color: Color, texture: str, shape: str, 
                     x: int, y: int) -> FlyweightContext:
        """åˆ›å»ºå¯¹è±¡"""
        intrinsic_state = IntrinsicState(color, texture, shape)
        flyweight = self._factory.get_flyweight(intrinsic_state)
        context = FlyweightContext(flyweight, {"x": x, "y": y})
        self._contexts.append(context)
        return context
    
    def render_all(self) -> List[str]:
        """æ¸²æŸ“æ‰€æœ‰å¯¹è±¡"""
        return [context.operation() for context in self._contexts]
    
    def get_memory_usage(self) -> Dict[str, int]:
        """è·å–å†…å­˜ä½¿ç”¨æƒ…å†µ"""
        stats = self._factory.get_cache_stats()
        stats["total_objects"] = len(self._contexts)
        stats["unique_flyweights"] = self._factory.get_flyweight_count()
        return stats

# ä½¿ç”¨ç¤ºä¾‹
def flyweight_example():
    """äº«å…ƒæ¨¡å¼ä½¿ç”¨ç¤ºä¾‹"""
    # åˆ›å»ºç®¡ç†å™¨
    manager = FlyweightManager()
    
    # åˆ›å»ºå¤§é‡å¯¹è±¡ï¼ˆå…±äº«å†…éƒ¨çŠ¶æ€ï¼‰
    colors = [Color.RED, Color.GREEN, Color.BLUE, Color.YELLOW]
    textures = ["smooth", "rough", "bumpy"]
    shapes = ["circle", "square", "triangle"]
    
    # åˆ›å»º1000ä¸ªå¯¹è±¡
    for i in range(1000):
        color = colors[i % len(colors)]
        texture = textures[i % len(textures)]
        shape = shapes[i % len(shapes)]
        x, y = i % 100, i // 100
        
        manager.create_object(color, texture, shape, x, y)
    
    # æ¸²æŸ“å‰10ä¸ªå¯¹è±¡
    results = manager.render_all()[:10]
    for i, result in enumerate(results):
        print(f"Object {i}: {result}")
    
    # æ˜¾ç¤ºå†…å­˜ä½¿ç”¨æƒ…å†µ
    memory_stats = manager.get_memory_usage()
    print(f"\nMemory usage: {memory_stats}")
    print(f"Memory efficiency: {memory_stats['unique_flyweights']} unique flyweights for {memory_stats['total_objects']} objects")

if __name__ == "__main__":
    flyweight_example()
```

## 8. ä»£ç†æ¨¡å¼ (Proxy Pattern)

### 8.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 8.1** (ä»£ç†æ¨¡å¼)
ä»£ç†æ¨¡å¼æ˜¯ä¸€ä¸ªå››å…ƒç»„ $\mathcal{P} = (S, P, \mathcal{A}, \mathcal{C})$ï¼Œå…¶ä¸­ï¼š

- $S$ æ˜¯ä¸»ä½“æ¥å£
- $P$ æ˜¯ä»£ç†ç±»
- $\mathcal{A}$ æ˜¯è®¿é—®æ§åˆ¶é›†åˆ
- $\mathcal{C}$ æ˜¯ç¼“å­˜é›†åˆ

**å®šç† 8.1** (ä»£ç†é€æ˜æ€§)
ä»£ç†æ¨¡å¼ä¿æŒæ¥å£ä¸€è‡´æ€§ï¼š
$$\forall s \in S, \forall p \in P: p.interface() = s.interface()$$

### 8.2 Pythonå®ç°

```python
from abc import ABC, abstractmethod
from typing import Protocol, Optional, Dict, Any, Callable
from dataclasses import dataclass
from functools import wraps
import time
import logging
from enum import Enum

class AccessLevel(Enum):
    """è®¿é—®çº§åˆ«"""
    PUBLIC = "public"
    PROTECTED = "protected"
    PRIVATE = "private"

class Subject(Protocol):
    """ä¸»ä½“æ¥å£"""
    
    def request(self, data: str) -> str:
        """è¯·æ±‚æ–¹æ³•"""
        ...

class RealSubject:
    """çœŸå®ä¸»ä½“"""
    
    def __init__(self):
        self._logger = logging.getLogger(__name__)
    
    def request(self, data: str) -> str:
        """çœŸå®è¯·æ±‚"""
        self._logger.info(f"RealSubject: Processing request with data: {data}")
        # æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
        time.sleep(0.1)
        return f"RealSubject: Processed {data}"

class Proxy(ABC):
    """ä»£ç†æŠ½è±¡åŸºç±»"""
    
    def __init__(self, subject: Subject):
        self._subject = subject
    
    @abstractmethod
    def request(self, data: str) -> str:
        """ä»£ç†è¯·æ±‚"""
        pass

class VirtualProxy(Proxy):
    """è™šæ‹Ÿä»£ç†ï¼ˆå»¶è¿ŸåŠ è½½ï¼‰"""
    
    def __init__(self):
        self._subject: Optional[Subject] = None
        self._logger = logging.getLogger(__name__)
    
    def request(self, data: str) -> str:
        """è™šæ‹Ÿä»£ç†è¯·æ±‚"""
        if self._subject is None:
            self._logger.info("VirtualProxy: Creating RealSubject")
            self._subject = RealSubject()
        
        return self._subject.request(data)

class ProtectionProxy(Proxy):
    """ä¿æŠ¤ä»£ç†"""
    
    def __init__(self, subject: Subject, access_level: AccessLevel):
        super().__init__(subject)
        self._access_level = access_level
        self._logger = logging.getLogger(__name__)
    
    def request(self, data: str) -> str:
        """ä¿æŠ¤ä»£ç†è¯·æ±‚"""
        if self._check_access():
            return self._subject.request(data)
        else:
            return "ProtectionProxy: Access denied"
    
    def _check_access(self) -> bool:
        """æ£€æŸ¥è®¿é—®æƒé™"""
        # ç®€åŒ–çš„æƒé™æ£€æŸ¥
        return self._access_level in [AccessLevel.PUBLIC, AccessLevel.PROTECTED]

class CachingProxy(Proxy):
    """ç¼“å­˜ä»£ç†"""
    
    def __init__(self, subject: Subject):
        super().__init__(subject)
        self._cache: Dict[str, str] = {}
        self._logger = logging.getLogger(__name__)
    
    def request(self, data: str) -> str:
        """ç¼“å­˜ä»£ç†è¯·æ±‚"""
        if data in self._cache:
            self._logger.info(f"CachingProxy: Cache hit for {data}")
            return self._cache[data]
        
        self._logger.info(f"CachingProxy: Cache miss for {data}")
        result = self._subject.request(data)
        self._cache[data] = result
        return result
    
    def clear_cache(self) -> None:
        """æ¸…é™¤ç¼“å­˜"""
        self._cache.clear()
        self._logger.info("CachingProxy: Cache cleared")

class LoggingProxy(Proxy):
    """æ—¥å¿—ä»£ç†"""
    
    def __init__(self, subject: Subject):
        super().__init__(subject)
        self._logger = logging.getLogger(__name__)
    
    def request(self, data: str) -> str:
        """æ—¥å¿—ä»£ç†è¯·æ±‚"""
        self._logger.info(f"LoggingProxy: Request started with data: {data}")
        
        try:
            result = self._subject.request(data)
            self._logger.info(f"LoggingProxy: Request completed successfully")
            return result
        except Exception as e:
            self._logger.error(f"LoggingProxy: Request failed with error: {e}")
            raise

# ä»£ç†è£…é¥°å™¨
def proxy_decorator(func: Callable) -> Callable:
    """ä»£ç†è£…é¥°å™¨"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        print(f"Proxy: Before calling {func.__name__}")
        result = func(*args, **kwargs)
        print(f"Proxy: After calling {func.__name__}")
        return result
    return wrapper

class ProxyManager:
    """ä»£ç†ç®¡ç†å™¨"""
    
    def __init__(self):
        self._proxies: Dict[str, Proxy] = {}
        self._logger = logging.getLogger(__name__)
    
    def create_proxy(self, name: str, proxy_type: str, **kwargs) -> Proxy:
        """åˆ›å»ºä»£ç†"""
        if proxy_type == "virtual":
            proxy = VirtualProxy()
        elif proxy_type == "protection":
            subject = RealSubject()
            access_level = kwargs.get('access_level', AccessLevel.PUBLIC)
            proxy = ProtectionProxy(subject, access_level)
        elif proxy_type == "caching":
            subject = RealSubject()
            proxy = CachingProxy(subject)
        elif proxy_type == "logging":
            subject = RealSubject()
            proxy = LoggingProxy(subject)
        else:
            raise ValueError(f"Unknown proxy type: {proxy_type}")
        
        self._proxies[name] = proxy
        return proxy
    
    def execute_request(self, name: str, data: str) -> str:
        """æ‰§è¡Œè¯·æ±‚"""
        if name not in self._proxies:
            raise ValueError(f"Proxy {name} not found")
        
        return self._proxies[name].request(data)

# ä½¿ç”¨ç¤ºä¾‹
def proxy_example():
    """ä»£ç†æ¨¡å¼ä½¿ç”¨ç¤ºä¾‹"""
    # é…ç½®æ—¥å¿—
    logging.basicConfig(level=logging.INFO)
    
    # åˆ›å»ºä»£ç†ç®¡ç†å™¨
    manager = ProxyManager()
    
    # åˆ›å»ºä¸åŒç±»å‹çš„ä»£ç†
    virtual_proxy = manager.create_proxy("virtual", "virtual")
    protection_proxy = manager.create_proxy("protection", "protection", 
                                          access_level=AccessLevel.PROTECTED)
    caching_proxy = manager.create_proxy("caching", "caching")
    logging_proxy = manager.create_proxy("logging", "logging")
    
    # æµ‹è¯•è™šæ‹Ÿä»£ç†
    print("=== Virtual Proxy ===")
    print(virtual_proxy.request("test_data"))
    
    # æµ‹è¯•ä¿æŠ¤ä»£ç†
    print("\n=== Protection Proxy ===")
    print(protection_proxy.request("test_data"))
    
    # æµ‹è¯•ç¼“å­˜ä»£ç†
    print("\n=== Caching Proxy ===")
    print("First request:", caching_proxy.request("cached_data"))
    print("Second request:", caching_proxy.request("cached_data"))
    
    # æµ‹è¯•æ—¥å¿—ä»£ç†
    print("\n=== Logging Proxy ===")
    print(logging_proxy.request("test_data"))

if __name__ == "__main__":
    proxy_example()
```

## 9. æ€§èƒ½åˆ†æä¸ä¼˜åŒ–

### 9.1 æ—¶é—´å¤æ‚åº¦åˆ†æ

| æ¨¡å¼ | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ |
|------|------------|------------|----------|
| é€‚é…å™¨ | O(1) | O(1) | æ¥å£ä¸å…¼å®¹ |
| æ¡¥æ¥ | O(1) | O(1) | æŠ½è±¡ä¸å®ç°åˆ†ç¦» |
| ç»„åˆ | O(n) | O(n) | æ ‘å½¢ç»“æ„ |
| è£…é¥°å™¨ | O(1) | O(1) | åŠ¨æ€æ‰©å±•åŠŸèƒ½ |
| å¤–è§‚ | O(1) | O(1) | ç®€åŒ–å¤æ‚æ¥å£ |
| äº«å…ƒ | O(1) | O(k) | å¤§é‡ç›¸ä¼¼å¯¹è±¡ |
| ä»£ç† | O(1) | O(1) | è®¿é—®æ§åˆ¶ |

### 9.2 å†…å­˜ä¼˜åŒ–ç­–ç•¥

1. **äº«å…ƒæ¨¡å¼**: å…±äº«å†…éƒ¨çŠ¶æ€ï¼Œå‡å°‘å†…å­˜å ç”¨
2. **å¯¹è±¡æ± **: é‡ç”¨å¯¹è±¡ï¼Œé¿å…é¢‘ç¹åˆ›å»ºé”€æ¯
3. **å»¶è¿ŸåŠ è½½**: æŒ‰éœ€åˆ›å»ºå¯¹è±¡ï¼Œå‡å°‘åˆå§‹å†…å­˜å ç”¨
4. **ç¼“å­˜ç­–ç•¥**: ç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—

### 9.3 å¹¶å‘å®‰å…¨è€ƒè™‘

```python
from threading import Lock
from typing import Dict, Any

class ThreadSafeProxy:
    """çº¿ç¨‹å®‰å…¨ä»£ç†"""
    
    def __init__(self, subject: Subject):
        self._subject = subject
        self._lock = Lock()
        self._cache: Dict[str, str] = {}
    
    def request(self, data: str) -> str:
        """çº¿ç¨‹å®‰å…¨è¯·æ±‚"""
        with self._lock:
            if data in self._cache:
                return self._cache[data]
            
            result = self._subject.request(data)
            self._cache[data] = result
            return result
```

## 10. å®é™…åº”ç”¨æ¡ˆä¾‹

### 10.1 å›¾å½¢ç•Œé¢ç³»ç»Ÿ

```python
from abc import ABC, abstractmethod
from typing import List, Tuple

class GUIComponent(ABC):
    """GUIç»„ä»¶æ¥å£"""
    
    @abstractmethod
    def draw(self, x: int, y: int) -> None:
        pass
    
    @abstractmethod
    def resize(self, width: int, height: int) -> None:
        pass

class Window(GUIComponent):
    """çª—å£ç»„ä»¶"""
    
    def __init__(self, title: str):
        self.title = title
        self.width = 100
        self.height = 100
    
    def draw(self, x: int, y: int) -> None:
        print(f"Drawing window '{self.title}' at ({x}, {y})")
    
    def resize(self, width: int, height: int) -> None:
        self.width = width
        self.height = height
        print(f"Resizing window to {width}x{height}")

class WindowDecorator(GUIComponent):
    """çª—å£è£…é¥°å™¨"""
    
    def __init__(self, component: GUIComponent):
        self._component = component
    
    def draw(self, x: int, y: int) -> None:
        self._component.draw(x, y)
    
    def resize(self, width: int, height: int) -> None:
        self._component.resize(width, height)

class BorderDecorator(WindowDecorator):
    """è¾¹æ¡†è£…é¥°å™¨"""
    
    def draw(self, x: int, y: int) -> None:
        print(f"Drawing border at ({x}, {y})")
        super().draw(x + 1, y + 1)
        print(f"Drawing border at ({x + self._component.width}, {y + self._component.height})")

class ScrollBarDecorator(WindowDecorator):
    """æ»šåŠ¨æ¡è£…é¥°å™¨"""
    
    def draw(self, x: int, y: int) -> None:
        super().draw(x, y)
        print(f"Drawing scrollbar at ({x + self._component.width - 10}, {y})")

# ä½¿ç”¨ç¤ºä¾‹
def gui_example():
    """GUIç³»ç»Ÿç¤ºä¾‹"""
    # åˆ›å»ºåŸºç¡€çª—å£
    window = Window("My Window")
    
    # æ·»åŠ è£…é¥°å™¨
    bordered_window = BorderDecorator(window)
    scrollable_window = ScrollBarDecorator(bordered_window)
    
    # ç»˜åˆ¶çª—å£
    scrollable_window.draw(10, 10)
    scrollable_window.resize(200, 150)
```

### 10.2 æ–‡ä»¶ç³»ç»Ÿ

```python
from abc import ABC, abstractmethod
from typing import List, Optional
from dataclasses import dataclass
from datetime import datetime

@dataclass
class FileInfo:
    """æ–‡ä»¶ä¿¡æ¯"""
    name: str
    size: int
    created: datetime
    modified: datetime

class FileSystemComponent(ABC):
    """æ–‡ä»¶ç³»ç»Ÿç»„ä»¶"""
    
    @abstractmethod
    def get_info(self) -> FileInfo:
        pass
    
    @abstractmethod
    def list_contents(self) -> List[str]:
        pass

class File(FileSystemComponent):
    """æ–‡ä»¶"""
    
    def __init__(self, name: str, size: int):
        self._info = FileInfo(
            name=name,
            size=size,
            created=datetime.now(),
            modified=datetime.now()
        )
    
    def get_info(self) -> FileInfo:
        return self._info
    
    def list_contents(self) -> List[str]:
        return [self._info.name]

class Directory(FileSystemComponent):
    """ç›®å½•"""
    
    def __init__(self, name: str):
        self._name = name
        self._children: List[FileSystemComponent] = []
        self._created = datetime.now()
    
    def add(self, component: FileSystemComponent) -> None:
        self._children.append(component)
    
    def remove(self, component: FileSystemComponent) -> None:
        self._children.remove(component)
    
    def get_info(self) -> FileInfo:
        total_size = sum(child.get_info().size for child in self._children)
        return FileInfo(
            name=self._name,
            size=total_size,
            created=self._created,
            modified=datetime.now()
        )
    
    def list_contents(self) -> List[str]:
        contents = [self._name + "/"]
        for child in self._children:
            contents.extend(child.list_contents())
        return contents

# ä½¿ç”¨ç¤ºä¾‹
def filesystem_example():
    """æ–‡ä»¶ç³»ç»Ÿç¤ºä¾‹"""
    # åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿç»“æ„
    root = Directory("root")
    
    docs = Directory("docs")
    docs.add(File("readme.txt", 1024))
    docs.add(File("manual.pdf", 2048576))
    
    src = Directory("src")
    src.add(File("main.py", 512))
    src.add(File("utils.py", 256))
    
    root.add(docs)
    root.add(src)
    
    # åˆ—å‡ºå†…å®¹
    print("File system structure:")
    for item in root.list_contents():
        print(f"  {item}")
    
    # è·å–ä¿¡æ¯
    info = root.get_info()
    print(f"\nRoot directory size: {info.size} bytes")

if __name__ == "__main__":
    filesystem_example()
```

## 11. æ€»ç»“

ç»“æ„å‹æ¨¡å¼æä¾›äº†ç»„ç»‡ç±»å’Œå¯¹è±¡çš„å¼ºå¤§å·¥å…·ï¼Œæ¯ç§æ¨¡å¼éƒ½æœ‰å…¶ç‰¹å®šçš„åº”ç”¨åœºæ™¯å’Œä¼˜åŠ¿ï¼š

1. **é€‚é…å™¨æ¨¡å¼**: è§£å†³æ¥å£ä¸å…¼å®¹é—®é¢˜
2. **æ¡¥æ¥æ¨¡å¼**: åˆ†ç¦»æŠ½è±¡ä¸å®ç°
3. **ç»„åˆæ¨¡å¼**: ç»Ÿä¸€å¤„ç†å•ä¸ªå¯¹è±¡å’Œå¯¹è±¡ç»„åˆ
4. **è£…é¥°å™¨æ¨¡å¼**: åŠ¨æ€æ‰©å±•å¯¹è±¡åŠŸèƒ½
5. **å¤–è§‚æ¨¡å¼**: ç®€åŒ–å¤æ‚å­ç³»ç»Ÿæ¥å£
6. **äº«å…ƒæ¨¡å¼**: ä¼˜åŒ–å†…å­˜ä½¿ç”¨
7. **ä»£ç†æ¨¡å¼**: æ§åˆ¶å¯¹è±¡è®¿é—®

è¿™äº›æ¨¡å¼å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ç»„åˆä½¿ç”¨ï¼Œä¸ºè½¯ä»¶è®¾è®¡æä¾›äº†çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ã€‚

---

*æœ€åæ›´æ–°: 2024-12-19*
*æ–‡æ¡£çŠ¶æ€: å®Œæˆ*
