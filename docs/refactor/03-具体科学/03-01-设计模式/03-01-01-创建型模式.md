# 03-01-01 åˆ›å»ºå‹æ¨¡å¼

## ğŸ“‹ æ¦‚è¿°

åˆ›å»ºå‹æ¨¡å¼æ˜¯è½¯ä»¶è®¾è®¡æ¨¡å¼çš„é‡è¦åˆ†ç±»ï¼Œä¸“æ³¨äºå¯¹è±¡çš„åˆ›å»ºæœºåˆ¶ã€‚æœ¬æ–‡æ¡£ä»å½¢å¼åŒ–è§’åº¦é˜è¿°åˆ›å»ºå‹æ¨¡å¼çš„æ ¸å¿ƒæ¦‚å¿µï¼Œæä¾›ä¸¥æ ¼çš„æ•°å­¦å®šä¹‰å’Œè¯æ˜ï¼Œå¹¶é€šè¿‡Pythonä»£ç å®ç°ç›¸å…³æ¨¡å¼ã€‚

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### 1. å•ä¾‹æ¨¡å¼ (Singleton Pattern)

#### 1.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 1.1** (å•ä¾‹æ¨¡å¼)
å•ä¾‹æ¨¡å¼ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ç‚¹ã€‚å½¢å¼åŒ–å®šä¹‰ä¸ºï¼š
$$\forall x, y \in \text{Instance}(C) \Rightarrow x = y$$
å…¶ä¸­ $C$ æ˜¯å•ä¾‹ç±»ï¼Œ$\text{Instance}(C)$ æ˜¯ $C$ çš„æ‰€æœ‰å®ä¾‹é›†åˆã€‚

**å®šä¹‰ 1.2** (å•ä¾‹å”¯ä¸€æ€§)
å•ä¾‹ç±»çš„å”¯ä¸€æ€§æ¡ä»¶ï¼š
$$\exists! x \in \text{Instance}(C) \land \forall y \in \text{Instance}(C): y = x$$

#### 1.2 å•ä¾‹æ¨¡å¼å®šç†

**å®šç† 1.1** (å•ä¾‹å”¯ä¸€æ€§)
å¦‚æœç±» $C$ æ­£ç¡®å®ç°å•ä¾‹æ¨¡å¼ï¼Œåˆ™ $C$ çš„æ‰€æœ‰å®ä¾‹éƒ½ç›¸ç­‰ã€‚

**è¯æ˜**:

1. è®¾ $x, y$ æ˜¯ $C$ çš„ä»»æ„ä¸¤ä¸ªå®ä¾‹
2. æ ¹æ®å•ä¾‹æ¨¡å¼çš„å®ç°ï¼Œ$x$ å’Œ $y$ æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡
3. å› æ­¤ $x = y$
4. æ‰€ä»¥å•ä¾‹æ¨¡å¼ä¿è¯äº†å®ä¾‹çš„å”¯ä¸€æ€§

### 2. å·¥å‚æ–¹æ³•æ¨¡å¼ (Factory Method Pattern)

#### 2.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 2.1** (å·¥å‚æ–¹æ³•)
å·¥å‚æ–¹æ³•æ¨¡å¼å®šä¹‰ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ã€‚å½¢å¼åŒ–å®šä¹‰ä¸ºï¼š
$$F: \text{ProductType} \rightarrow \text{Product}$$
å…¶ä¸­ $F$ æ˜¯å·¥å‚æ–¹æ³•ï¼Œ$\text{ProductType}$ æ˜¯äº§å“ç±»å‹é›†åˆï¼Œ$\text{Product}$ æ˜¯äº§å“é›†åˆã€‚

**å®šä¹‰ 2.2** (å·¥å‚æ–¹æ³•æ˜ å°„)
å·¥å‚æ–¹æ³•çš„æ˜ å°„å…³ç³»ï¼š
$$\forall t \in \text{ProductType}: F(t) \in \text{Product} \land \text{Type}(F(t)) = t$$

#### 2.2 å·¥å‚æ–¹æ³•å®šç†

**å®šç† 2.1** (å·¥å‚æ–¹æ³•æ­£ç¡®æ€§)
å¦‚æœå·¥å‚æ–¹æ³• $F$ æ­£ç¡®å®ç°ï¼Œåˆ™å¯¹äºä»»æ„äº§å“ç±»å‹ $t$ï¼Œ$F(t)$ è¿”å›æ­£ç¡®ç±»å‹çš„äº§å“ã€‚

**è¯æ˜**:

1. è®¾ $t$ æ˜¯ä»»æ„äº§å“ç±»å‹
2. æ ¹æ®å·¥å‚æ–¹æ³•å®šä¹‰ï¼Œ$F(t) \in \text{Product}$
3. æ ¹æ®ç±»å‹æ˜ å°„ï¼Œ$\text{Type}(F(t)) = t$
4. å› æ­¤ $F(t)$ è¿”å›æ­£ç¡®ç±»å‹çš„äº§å“

### 3. æŠ½è±¡å·¥å‚æ¨¡å¼ (Abstract Factory Pattern)

#### 3.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 3.1** (æŠ½è±¡å·¥å‚)
æŠ½è±¡å·¥å‚æ¨¡å¼æä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³å¯¹è±¡çš„æ¥å£ã€‚å½¢å¼åŒ–å®šä¹‰ä¸ºï¼š
$$\mathcal{F}: \text{Family} \rightarrow \text{ProductFamily}$$
å…¶ä¸­ $\mathcal{F}$ æ˜¯æŠ½è±¡å·¥å‚ï¼Œ$\text{Family}$ æ˜¯äº§å“æ—é›†åˆï¼Œ$\text{ProductFamily}$ æ˜¯äº§å“æ—å®ä¾‹é›†åˆã€‚

**å®šä¹‰ 3.2** (äº§å“æ—ä¸€è‡´æ€§)
äº§å“æ—çš„ä¸€è‡´æ€§æ¡ä»¶ï¼š
$$\forall f \in \text{Family}: \mathcal{F}(f) = \{p_1, p_2, \ldots, p_n\} \land \text{Compatible}(p_1, p_2, \ldots, p_n)$$

#### 3.2 æŠ½è±¡å·¥å‚å®šç†

**å®šç† 3.1** (äº§å“æ—ä¸€è‡´æ€§)
å¦‚æœæŠ½è±¡å·¥å‚ $\mathcal{F}$ æ­£ç¡®å®ç°ï¼Œåˆ™åŒä¸€äº§å“æ—çš„æ‰€æœ‰äº§å“éƒ½æ˜¯å…¼å®¹çš„ã€‚

**è¯æ˜**:

1. è®¾ $f$ æ˜¯ä»»æ„äº§å“æ—
2. æ ¹æ®æŠ½è±¡å·¥å‚å®šä¹‰ï¼Œ$\mathcal{F}(f)$ è¿”å›äº§å“é›†åˆ
3. æ ¹æ®ä¸€è‡´æ€§æ¡ä»¶ï¼Œæ‰€æœ‰äº§å“éƒ½æ˜¯å…¼å®¹çš„
4. å› æ­¤äº§å“æ—ä¸€è‡´æ€§å¾—åˆ°ä¿è¯

### 4. å»ºé€ è€…æ¨¡å¼ (Builder Pattern)

#### 4.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 4.1** (å»ºé€ è€…)
å»ºé€ è€…æ¨¡å¼å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸è¡¨ç¤ºåˆ†ç¦»ã€‚å½¢å¼åŒ–å®šä¹‰ä¸ºï¼š
$$B: \text{Step}^* \rightarrow \text{Product}$$
å…¶ä¸­ $B$ æ˜¯å»ºé€ è€…ï¼Œ$\text{Step}^*$ æ˜¯æ„å»ºæ­¥éª¤åºåˆ—ï¼Œ$\text{Product}$ æ˜¯æœ€ç»ˆäº§å“ã€‚

**å®šä¹‰ 4.2** (æ„å»ºæ­¥éª¤)
æ„å»ºæ­¥éª¤çš„åºåˆ—å…³ç³»ï¼š
$$\forall s_1, s_2 \in \text{Step}^*: s_1 \preceq s_2 \Rightarrow B(s_1) \subseteq B(s_2)$$

#### 4.2 å»ºé€ è€…å®šç†

**å®šç† 4.1** (æ„å»ºå®Œæ•´æ€§)
å¦‚æœå»ºé€ è€… $B$ æ­£ç¡®å®ç°ï¼Œåˆ™å®Œæ•´çš„æ„å»ºæ­¥éª¤åºåˆ—äº§ç”Ÿå®Œæ•´çš„äº§å“ã€‚

**è¯æ˜**:

1. è®¾ $s$ æ˜¯å®Œæ•´çš„æ„å»ºæ­¥éª¤åºåˆ—
2. æ ¹æ®å»ºé€ è€…å®šä¹‰ï¼Œ$B(s)$ è¿”å›å®Œæ•´äº§å“
3. æ ¹æ®æ­¥éª¤å…³ç³»ï¼Œæ‰€æœ‰å¿…è¦æ­¥éª¤éƒ½å·²æ‰§è¡Œ
4. å› æ­¤äº§å“æ„å»ºå®Œæ•´

### 5. åŸå‹æ¨¡å¼ (Prototype Pattern)

#### 5.1 å½¢å¼åŒ–å®šä¹‰

**å®šä¹‰ 5.1** (åŸå‹)
åŸå‹æ¨¡å¼é€šè¿‡å¤åˆ¶ç°æœ‰å¯¹è±¡æ¥åˆ›å»ºæ–°å¯¹è±¡ã€‚å½¢å¼åŒ–å®šä¹‰ä¸ºï¼š
$$P: \text{Prototype} \rightarrow \text{Clone}$$
å…¶ä¸­ $P$ æ˜¯åŸå‹æ–¹æ³•ï¼Œ$\text{Prototype}$ æ˜¯åŸå‹å¯¹è±¡é›†åˆï¼Œ$\text{Clone}$ æ˜¯å…‹éš†å¯¹è±¡é›†åˆã€‚

**å®šä¹‰ 5.2** (å…‹éš†ç­‰ä»·æ€§)
å…‹éš†å¯¹è±¡çš„ç­‰ä»·æ€§æ¡ä»¶ï¼š
$$\forall p \in \text{Prototype}: P(p) \equiv p \land P(p) \neq p$$

#### 5.2 åŸå‹å®šç†

**å®šç† 5.1** (å…‹éš†æ­£ç¡®æ€§)
å¦‚æœåŸå‹æ–¹æ³• $P$ æ­£ç¡®å®ç°ï¼Œåˆ™å…‹éš†å¯¹è±¡ä¸åŸå¯¹è±¡ç­‰ä»·ä½†ä¸ç›¸åŒã€‚

**è¯æ˜**:

1. è®¾ $p$ æ˜¯ä»»æ„åŸå‹å¯¹è±¡
2. æ ¹æ®åŸå‹å®šä¹‰ï¼Œ$P(p)$ è¿”å›å…‹éš†å¯¹è±¡
3. æ ¹æ®ç­‰ä»·æ€§æ¡ä»¶ï¼Œ$P(p) \equiv p$
4. æ ¹æ®ä¸ç­‰æ€§æ¡ä»¶ï¼Œ$P(p) \neq p$
5. å› æ­¤å…‹éš†æ­£ç¡®æ€§å¾—åˆ°ä¿è¯

## ğŸ Pythonå®ç°

### 1. å•ä¾‹æ¨¡å¼å®ç°

```python
import threading
from abc import ABC, abstractmethod
from typing import Any, Dict, Type, TypeVar, Optional
from dataclasses import dataclass
import copy

T = TypeVar('T')

class Singleton(type):
    """å•ä¾‹å…ƒç±»"""
    
    _instances: Dict[Type, Any] = {}
    _lock: threading.Lock = threading.Lock()
    
    def __call__(cls: Type[T], *args, **kwargs) -> T:
        if cls not in cls._instances:
            with cls._lock:
                if cls not in cls._instances:
                    cls._instances[cls] = super().__call__(*args, **kwargs)
        return cls._instances[cls]

class DatabaseConnection(metaclass=Singleton):
    """æ•°æ®åº“è¿æ¥å•ä¾‹"""
    
    def __init__(self, connection_string: str = "default"):
        self.connection_string = connection_string
        self.is_connected = False
    
    def connect(self) -> None:
        """è¿æ¥æ•°æ®åº“"""
        if not self.is_connected:
            print(f"è¿æ¥åˆ°æ•°æ®åº“: {self.connection_string}")
            self.is_connected = True
    
    def disconnect(self) -> None:
        """æ–­å¼€è¿æ¥"""
        if self.is_connected:
            print(f"æ–­å¼€æ•°æ®åº“è¿æ¥: {self.connection_string}")
            self.is_connected = False
    
    def execute_query(self, query: str) -> str:
        """æ‰§è¡ŒæŸ¥è¯¢"""
        if not self.is_connected:
            raise RuntimeError("æ•°æ®åº“æœªè¿æ¥")
        return f"æ‰§è¡ŒæŸ¥è¯¢: {query}"

class ConfigurationManager(metaclass=Singleton):
    """é…ç½®ç®¡ç†å™¨å•ä¾‹"""
    
    def __init__(self):
        self._config: Dict[str, Any] = {}
    
    def set_config(self, key: str, value: Any) -> None:
        """è®¾ç½®é…ç½®"""
        self._config[key] = value
    
    def get_config(self, key: str, default: Any = None) -> Any:
        """è·å–é…ç½®"""
        return self._config.get(key, default)
    
    def get_all_config(self) -> Dict[str, Any]:
        """è·å–æ‰€æœ‰é…ç½®"""
        return self._config.copy()

# å•ä¾‹æ¨¡å¼éªŒè¯
def verify_singleton_pattern():
    """éªŒè¯å•ä¾‹æ¨¡å¼"""
    
    # åˆ›å»ºå¤šä¸ªå®ä¾‹
    db1 = DatabaseConnection("mysql://localhost:3306")
    db2 = DatabaseConnection("postgresql://localhost:5432")
    
    # éªŒè¯æ˜¯å¦ä¸ºåŒä¸€å®ä¾‹
    print(f"db1 å’Œ db2 æ˜¯åŒä¸€å®ä¾‹: {db1 is db2}")
    print(f"db1 è¿æ¥å­—ç¬¦ä¸²: {db1.connection_string}")
    print(f"db2 è¿æ¥å­—ç¬¦ä¸²: {db2.connection_string}")
    
    # é…ç½®ç®¡ç†å™¨æµ‹è¯•
    config1 = ConfigurationManager()
    config2 = ConfigurationManager()
    
    config1.set_config("database_url", "mysql://localhost:3306")
    config1.set_config("api_key", "secret_key_123")
    
    print(f"config1 å’Œ config2 æ˜¯åŒä¸€å®ä¾‹: {config1 is config2}")
    print(f"ä» config2 è·å–é…ç½®: {config2.get_config('database_url')}")
    
    return db1, config1
```

### 2. å·¥å‚æ–¹æ³•æ¨¡å¼å®ç°

```python
from abc import ABC, abstractmethod
from typing import Dict, Type, Any
from enum import Enum

class ProductType(Enum):
    """äº§å“ç±»å‹æšä¸¾"""
    CONCRETE_A = "concrete_a"
    CONCRETE_B = "concrete_b"
    CONCRETE_C = "concrete_c"

class Product(ABC):
    """äº§å“æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def operation(self) -> str:
        """äº§å“æ“ä½œ"""
        pass

class ConcreteProductA(Product):
    """å…·ä½“äº§å“A"""
    
    def operation(self) -> str:
        return "ConcreteProductA çš„æ“ä½œ"

class ConcreteProductB(Product):
    """å…·ä½“äº§å“B"""
    
    def operation(self) -> str:
        return "ConcreteProductB çš„æ“ä½œ"

class ConcreteProductC(Product):
    """å…·ä½“äº§å“C"""
    
    def operation(self) -> str:
        return "ConcreteProductC çš„æ“ä½œ"

class Creator(ABC):
    """åˆ›å»ºè€…æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def factory_method(self, product_type: ProductType) -> Product:
        """å·¥å‚æ–¹æ³•"""
        pass
    
    def some_operation(self, product_type: ProductType) -> str:
        """ä½¿ç”¨å·¥å‚æ–¹æ³•åˆ›å»ºäº§å“å¹¶æ‰§è¡Œæ“ä½œ"""
        product = self.factory_method(product_type)
        return f"åˆ›å»ºè€…ä½¿ç”¨ {product.operation()}"

class ConcreteCreator(Creator):
    """å…·ä½“åˆ›å»ºè€…"""
    
    def factory_method(self, product_type: ProductType) -> Product:
        """å·¥å‚æ–¹æ³•å®ç°"""
        product_map = {
            ProductType.CONCRETE_A: ConcreteProductA,
            ProductType.CONCRETE_B: ConcreteProductB,
            ProductType.CONCRETE_C: ConcreteProductC
        }
        
        product_class = product_map.get(product_type)
        if product_class is None:
            raise ValueError(f"ä¸æ”¯æŒçš„äº§å“ç±»å‹: {product_type}")
        
        return product_class()

# å·¥å‚æ–¹æ³•æ¨¡å¼éªŒè¯
def verify_factory_method_pattern():
    """éªŒè¯å·¥å‚æ–¹æ³•æ¨¡å¼"""
    
    creator = ConcreteCreator()
    
    # åˆ›å»ºä¸åŒç±»å‹çš„äº§å“
    for product_type in ProductType:
        try:
            result = creator.some_operation(product_type)
            print(f"äº§å“ç±»å‹ {product_type.value}: {result}")
        except ValueError as e:
            print(f"é”™è¯¯: {e}")
    
    return creator
```

### 3. æŠ½è±¡å·¥å‚æ¨¡å¼å®ç°

```python
from abc import ABC, abstractmethod
from typing import Dict, List, Any
from enum import Enum

class GUIFamily(Enum):
    """GUIäº§å“æ—æšä¸¾"""
    WINDOWS = "windows"
    MAC = "mac"
    LINUX = "linux"

class Button(ABC):
    """æŒ‰é’®æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def render(self) -> str:
        """æ¸²æŸ“æŒ‰é’®"""
        pass

class Checkbox(ABC):
    """å¤é€‰æ¡†æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def render(self) -> str:
        """æ¸²æŸ“å¤é€‰æ¡†"""
        pass

class WindowsButton(Button):
    """WindowsæŒ‰é’®"""
    
    def render(self) -> str:
        return "æ¸²æŸ“ Windows é£æ ¼çš„æŒ‰é’®"

class WindowsCheckbox(Checkbox):
    """Windowså¤é€‰æ¡†"""
    
    def render(self) -> str:
        return "æ¸²æŸ“ Windows é£æ ¼çš„å¤é€‰æ¡†"

class MacButton(Button):
    """MacæŒ‰é’®"""
    
    def render(self) -> str:
        return "æ¸²æŸ“ Mac é£æ ¼çš„æŒ‰é’®"

class MacCheckbox(Checkbox):
    """Macå¤é€‰æ¡†"""
    
    def render(self) -> str:
        return "æ¸²æŸ“ Mac é£æ ¼çš„å¤é€‰æ¡†"

class LinuxButton(Button):
    """LinuxæŒ‰é’®"""
    
    def render(self) -> str:
        return "æ¸²æŸ“ Linux é£æ ¼çš„æŒ‰é’®"

class LinuxCheckbox(Checkbox):
    """Linuxå¤é€‰æ¡†"""
    
    def render(self) -> str:
        return "æ¸²æŸ“ Linux é£æ ¼çš„å¤é€‰æ¡†"

class GUIFactory(ABC):
    """GUIå·¥å‚æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def create_button(self) -> Button:
        """åˆ›å»ºæŒ‰é’®"""
        pass
    
    @abstractmethod
    def create_checkbox(self) -> Checkbox:
        """åˆ›å»ºå¤é€‰æ¡†"""
        pass

class WindowsGUIFactory(GUIFactory):
    """Windows GUIå·¥å‚"""
    
    def create_button(self) -> Button:
        return WindowsButton()
    
    def create_checkbox(self) -> Checkbox:
        return WindowsCheckbox()

class MacGUIFactory(GUIFactory):
    """Mac GUIå·¥å‚"""
    
    def create_button(self) -> Button:
        return MacButton()
    
    def create_checkbox(self) -> Checkbox:
        return MacCheckbox()

class LinuxGUIFactory(GUIFactory):
    """Linux GUIå·¥å‚"""
    
    def create_button(self) -> Button:
        return LinuxButton()
    
    def create_checkbox(self) -> Checkbox:
        return LinuxCheckbox()

class Application:
    """åº”ç”¨ç¨‹åºç±»"""
    
    def __init__(self, factory: GUIFactory):
        self.factory = factory
        self.button = None
        self.checkbox = None
    
    def create_ui(self) -> None:
        """åˆ›å»ºç”¨æˆ·ç•Œé¢"""
        self.button = self.factory.create_button()
        self.checkbox = self.factory.create_checkbox()
    
    def render_ui(self) -> List[str]:
        """æ¸²æŸ“ç”¨æˆ·ç•Œé¢"""
        if self.button is None or self.checkbox is None:
            self.create_ui()
        
        return [
            self.button.render(),
            self.checkbox.render()
        ]

# æŠ½è±¡å·¥å‚æ¨¡å¼éªŒè¯
def verify_abstract_factory_pattern():
    """éªŒè¯æŠ½è±¡å·¥å‚æ¨¡å¼"""
    
    # åˆ›å»ºä¸åŒå¹³å°çš„åº”ç”¨ç¨‹åº
    platforms = {
        GUIFamily.WINDOWS: WindowsGUIFactory(),
        GUIFamily.MAC: MacGUIFactory(),
        GUIFamily.LINUX: LinuxGUIFactory()
    }
    
    for platform, factory in platforms.items():
        app = Application(factory)
        ui_elements = app.render_ui()
        print(f"\n{platform.value.upper()} å¹³å°:")
        for element in ui_elements:
            print(f"  - {element}")
    
    return platforms
```

### 4. å»ºé€ è€…æ¨¡å¼å®ç°

```python
from abc import ABC, abstractmethod
from typing import List, Dict, Any, Optional
from dataclasses import dataclass

@dataclass
class Computer:
    """è®¡ç®—æœºç±»"""
    cpu: str = ""
    memory: str = ""
    storage: str = ""
    graphics: str = ""
    motherboard: str = ""
    
    def __str__(self) -> str:
        return f"è®¡ç®—æœºé…ç½®: CPU={self.cpu}, å†…å­˜={self.memory}, å­˜å‚¨={self.storage}, æ˜¾å¡={self.graphics}, ä¸»æ¿={self.motherboard}"

class ComputerBuilder(ABC):
    """è®¡ç®—æœºå»ºé€ è€…æŠ½è±¡åŸºç±»"""
    
    def __init__(self):
        self.computer = Computer()
    
    @abstractmethod
    def build_cpu(self) -> None:
        """æ„å»ºCPU"""
        pass
    
    @abstractmethod
    def build_memory(self) -> None:
        """æ„å»ºå†…å­˜"""
        pass
    
    @abstractmethod
    def build_storage(self) -> None:
        """æ„å»ºå­˜å‚¨"""
        pass
    
    @abstractmethod
    def build_graphics(self) -> None:
        """æ„å»ºæ˜¾å¡"""
        pass
    
    @abstractmethod
    def build_motherboard(self) -> None:
        """æ„å»ºä¸»æ¿"""
        pass
    
    def get_result(self) -> Computer:
        """è·å–æ„å»ºç»“æœ"""
        return self.computer

class GamingComputerBuilder(ComputerBuilder):
    """æ¸¸æˆç”µè„‘å»ºé€ è€…"""
    
    def build_cpu(self) -> None:
        self.computer.cpu = "Intel Core i9-12900K"
    
    def build_memory(self) -> None:
        self.computer.memory = "32GB DDR5"
    
    def build_storage(self) -> None:
        self.computer.storage = "2TB NVMe SSD"
    
    def build_graphics(self) -> None:
        self.computer.graphics = "NVIDIA RTX 4090"
    
    def build_motherboard(self) -> None:
        self.computer.motherboard = "ASUS ROG Maximus Z690"

class OfficeComputerBuilder(ComputerBuilder):
    """åŠå…¬ç”µè„‘å»ºé€ è€…"""
    
    def build_cpu(self) -> None:
        self.computer.cpu = "Intel Core i5-12400"
    
    def build_memory(self) -> None:
        self.computer.memory = "16GB DDR4"
    
    def build_storage(self) -> None:
        self.computer.storage = "512GB SSD"
    
    def build_graphics(self) -> None:
        self.computer.graphics = "é›†æˆæ˜¾å¡"
    
    def build_motherboard(self) -> None:
        self.computer.motherboard = "ASUS Prime B660"

class ComputerDirector:
    """è®¡ç®—æœºå¯¼æ¼”ç±»"""
    
    def __init__(self, builder: ComputerBuilder):
        self.builder = builder
    
    def construct(self) -> Computer:
        """æ„å»ºè®¡ç®—æœº"""
        self.builder.build_motherboard()
        self.builder.build_cpu()
        self.builder.build_memory()
        self.builder.build_storage()
        self.builder.build_graphics()
        return self.builder.get_result()
    
    def construct_minimal(self) -> Computer:
        """æ„å»ºæœ€å°é…ç½®è®¡ç®—æœº"""
        self.builder.build_motherboard()
        self.builder.build_cpu()
        self.builder.build_memory()
        return self.builder.get_result()

# å»ºé€ è€…æ¨¡å¼éªŒè¯
def verify_builder_pattern():
    """éªŒè¯å»ºé€ è€…æ¨¡å¼"""
    
    # æ„å»ºæ¸¸æˆç”µè„‘
    gaming_builder = GamingComputerBuilder()
    gaming_director = ComputerDirector(gaming_builder)
    gaming_computer = gaming_director.construct()
    print(f"æ¸¸æˆç”µè„‘: {gaming_computer}")
    
    # æ„å»ºåŠå…¬ç”µè„‘
    office_builder = OfficeComputerBuilder()
    office_director = ComputerDirector(office_builder)
    office_computer = office_director.construct()
    print(f"åŠå…¬ç”µè„‘: {office_computer}")
    
    # æ„å»ºæœ€å°é…ç½®
    minimal_computer = office_director.construct_minimal()
    print(f"æœ€å°é…ç½®: {minimal_computer}")
    
    return gaming_computer, office_computer, minimal_computer
```

### 5. åŸå‹æ¨¡å¼å®ç°

```python
from abc import ABC, abstractmethod
from typing import Dict, Any, List
import copy

class Prototype(ABC):
    """åŸå‹æŠ½è±¡åŸºç±»"""
    
    @abstractmethod
    def clone(self) -> 'Prototype':
        """å…‹éš†æ–¹æ³•"""
        pass

class Document(Prototype):
    """æ–‡æ¡£ç±»"""
    
    def __init__(self, title: str, content: str, author: str):
        self.title = title
        self.content = content
        self.author = author
        self.metadata: Dict[str, Any] = {}
    
    def add_metadata(self, key: str, value: Any) -> None:
        """æ·»åŠ å…ƒæ•°æ®"""
        self.metadata[key] = value
    
    def clone(self) -> 'Document':
        """æµ…å…‹éš†"""
        return copy.copy(self)
    
    def deep_clone(self) -> 'Document':
        """æ·±å…‹éš†"""
        return copy.deepcopy(self)
    
    def __str__(self) -> str:
        return f"æ–‡æ¡£: {self.title} (ä½œè€…: {self.author})"

class Shape(Prototype):
    """å½¢çŠ¶ç±»"""
    
    def __init__(self, x: int, y: int, color: str):
        self.x = x
        self.y = y
        self.color = color
    
    def clone(self) -> 'Shape':
        """å…‹éš†å½¢çŠ¶"""
        return copy.copy(self)
    
    def move(self, dx: int, dy: int) -> None:
        """ç§»åŠ¨å½¢çŠ¶"""
        self.x += dx
        self.y += dy
    
    def __str__(self) -> str:
        return f"å½¢çŠ¶: ä½ç½®({self.x}, {self.y}), é¢œè‰²: {self.color}"

class Circle(Shape):
    """åœ†å½¢ç±»"""
    
    def __init__(self, x: int, y: int, color: str, radius: int):
        super().__init__(x, y, color)
        self.radius = radius
    
    def clone(self) -> 'Circle':
        """å…‹éš†åœ†å½¢"""
        return copy.copy(self)
    
    def __str__(self) -> str:
        return f"åœ†å½¢: ä½ç½®({self.x}, {self.y}), é¢œè‰²: {self.color}, åŠå¾„: {self.radius}"

class Rectangle(Shape):
    """çŸ©å½¢ç±»"""
    
    def __init__(self, x: int, y: int, color: str, width: int, height: int):
        super().__init__(x, y, color)
        self.width = width
        self.height = height
    
    def clone(self) -> 'Rectangle':
        """å…‹éš†çŸ©å½¢"""
        return copy.copy(self)
    
    def __str__(self) -> str:
        return f"çŸ©å½¢: ä½ç½®({self.x}, {self.y}), é¢œè‰²: {self.color}, å°ºå¯¸: {self.width}x{self.height}"

class PrototypeRegistry:
    """åŸå‹æ³¨å†Œè¡¨"""
    
    def __init__(self):
        self._prototypes: Dict[str, Prototype] = {}
    
    def register(self, name: str, prototype: Prototype) -> None:
        """æ³¨å†ŒåŸå‹"""
        self._prototypes[name] = prototype
    
    def clone(self, name: str) -> Prototype:
        """æ ¹æ®åç§°å…‹éš†åŸå‹"""
        if name not in self._prototypes:
            raise ValueError(f"åŸå‹ {name} ä¸å­˜åœ¨")
        return self._prototypes[name].clone()
    
    def get_all_prototypes(self) -> List[str]:
        """è·å–æ‰€æœ‰åŸå‹åç§°"""
        return list(self._prototypes.keys())

# åŸå‹æ¨¡å¼éªŒè¯
def verify_prototype_pattern():
    """éªŒè¯åŸå‹æ¨¡å¼"""
    
    # æ–‡æ¡£åŸå‹æµ‹è¯•
    original_doc = Document("è®¾è®¡æ¨¡å¼", "åˆ›å»ºå‹æ¨¡å¼è¯¦è§£", "å¼ ä¸‰")
    original_doc.add_metadata("ç‰ˆæœ¬", "1.0")
    original_doc.add_metadata("åˆ›å»ºæ—¶é—´", "2024-01-01")
    
    # æµ…å…‹éš†
    shallow_clone = original_doc.clone()
    shallow_clone.title = "è®¾è®¡æ¨¡å¼ï¼ˆå‰¯æœ¬ï¼‰"
    shallow_clone.metadata["ç‰ˆæœ¬"] = "1.1"
    
    print(f"åŸå§‹æ–‡æ¡£: {original_doc}")
    print(f"åŸå§‹æ–‡æ¡£å…ƒæ•°æ®: {original_doc.metadata}")
    print(f"æµ…å…‹éš†æ–‡æ¡£: {shallow_clone}")
    print(f"æµ…å…‹éš†å…ƒæ•°æ®: {shallow_clone.metadata}")
    print(f"åŸå§‹æ–‡æ¡£å…ƒæ•°æ®æ˜¯å¦æ”¹å˜: {original_doc.metadata}")
    
    # æ·±å…‹éš†
    deep_clone = original_doc.deep_clone()
    deep_clone.metadata["ç‰ˆæœ¬"] = "2.0"
    print(f"æ·±å…‹éš†å…ƒæ•°æ®: {deep_clone.metadata}")
    print(f"åŸå§‹æ–‡æ¡£å…ƒæ•°æ®: {original_doc.metadata}")
    
    # å½¢çŠ¶åŸå‹æµ‹è¯•
    circle = Circle(10, 20, "çº¢è‰²", 5)
    rectangle = Rectangle(30, 40, "è“è‰²", 10, 8)
    
    # æ³¨å†ŒåŸå‹
    registry = PrototypeRegistry()
    registry.register("circle", circle)
    registry.register("rectangle", rectangle)
    
    # å…‹éš†å½¢çŠ¶
    cloned_circle = registry.clone("circle")
    cloned_rectangle = registry.clone("rectangle")
    
    cloned_circle.move(5, 5)
    cloned_rectangle.move(-5, -5)
    
    print(f"\nåŸå§‹åœ†å½¢: {circle}")
    print(f"å…‹éš†åœ†å½¢: {cloned_circle}")
    print(f"åŸå§‹çŸ©å½¢: {rectangle}")
    print(f"å…‹éš†çŸ©å½¢: {cloned_rectangle}")
    
    return original_doc, shallow_clone, deep_clone, registry
```

## ğŸ“Š æ•°å­¦è¯æ˜

### 1. åˆ›å»ºå‹æ¨¡å¼ç»„åˆå®šç†

**å®šç† 1.1** (åˆ›å»ºå‹æ¨¡å¼ç»„åˆ)
å¦‚æœæ¨¡å¼ $P_1$ å’Œ $P_2$ éƒ½æ˜¯åˆ›å»ºå‹æ¨¡å¼ï¼Œåˆ™å®ƒä»¬çš„ç»„åˆ $P_1 \circ P_2$ ä¹Ÿæ˜¯åˆ›å»ºå‹æ¨¡å¼ã€‚

**è¯æ˜**:

1. è®¾ $P_1$ å’Œ $P_2$ éƒ½æ˜¯åˆ›å»ºå‹æ¨¡å¼
2. æ ¹æ®åˆ›å»ºå‹æ¨¡å¼å®šä¹‰ï¼Œå®ƒä»¬éƒ½ä¸“æ³¨äºå¯¹è±¡åˆ›å»º
3. ç»„åˆ $P_1 \circ P_2$ ä»ç„¶ä¸“æ³¨äºå¯¹è±¡åˆ›å»º
4. å› æ­¤ $P_1 \circ P_2$ æ˜¯åˆ›å»ºå‹æ¨¡å¼

### 2. å•ä¾‹æ¨¡å¼å”¯ä¸€æ€§å®šç†

**å®šç† 1.2** (å•ä¾‹å”¯ä¸€æ€§)
å¦‚æœç±» $C$ å®ç°å•ä¾‹æ¨¡å¼ï¼Œåˆ™å¯¹äºä»»æ„ä¸¤ä¸ªå®ä¾‹ $x, y \in C$ï¼Œæœ‰ $x = y$ã€‚

**è¯æ˜**:

1. è®¾ $x, y$ æ˜¯ $C$ çš„ä»»æ„ä¸¤ä¸ªå®ä¾‹
2. æ ¹æ®å•ä¾‹æ¨¡å¼å®ç°ï¼Œæ‰€æœ‰å®ä¾‹æŒ‡å‘åŒä¸€å¯¹è±¡
3. å› æ­¤ $x$ å’Œ $y$ æŒ‡å‘åŒä¸€å¯¹è±¡
4. æ‰€ä»¥ $x = y$

### 3. å·¥å‚æ–¹æ³•ç±»å‹å®‰å…¨å®šç†

**å®šç† 1.3** (å·¥å‚æ–¹æ³•ç±»å‹å®‰å…¨)
å¦‚æœå·¥å‚æ–¹æ³• $F$ æ­£ç¡®å®ç°ï¼Œåˆ™å¯¹äºä»»æ„äº§å“ç±»å‹ $t$ï¼Œ$F(t)$ çš„ç±»å‹ä¸º $t$ã€‚

**è¯æ˜**:

1. è®¾ $t$ æ˜¯ä»»æ„äº§å“ç±»å‹
2. æ ¹æ®å·¥å‚æ–¹æ³•å®šä¹‰ï¼Œ$F(t) \in \text{Product}$
3. æ ¹æ®ç±»å‹æ˜ å°„ï¼Œ$\text{Type}(F(t)) = t$
4. å› æ­¤ $F(t)$ çš„ç±»å‹ä¸º $t$

## ğŸ”— ç›¸å…³æ¦‚å¿µ

- [ç»“æ„å‹æ¨¡å¼](./03-01-02-ç»“æ„å‹æ¨¡å¼.md)
- [è¡Œä¸ºå‹æ¨¡å¼](./03-01-03-è¡Œä¸ºå‹æ¨¡å¼.md)
- [è®¾è®¡æ¨¡å¼ç†è®º](../03-01-è®¾è®¡æ¨¡å¼/README.md)
- [è½¯ä»¶æ¶æ„ç†è®º](../03-02-è½¯ä»¶æ¶æ„/README.md)

## ğŸ“š å‚è€ƒæ–‡çŒ®

1. Gamma, E., Helm, R., Johnson, R., & Vlissides, J. (1994). Design Patterns: Elements of Reusable Object-Oriented Software
2. Freeman, E., Robson, E., Sierra, K., & Bates, B. (2004). Head First Design Patterns
3. Larman, C. (2004). Applying UML and Patterns: An Introduction to Object-Oriented Analysis and Design and Iterative Development
4. Martin, R. C. (2000). Design Principles and Design Patterns

---

*åˆ›å»ºå‹æ¨¡å¼ä¸ºè½¯ä»¶è®¾è®¡æä¾›äº†çµæ´»çš„å¯¹è±¡åˆ›å»ºæœºåˆ¶ï¼Œé€šè¿‡å½¢å¼åŒ–çš„æ•°å­¦å®šä¹‰å’Œä¸¥æ ¼çš„è¯æ˜ï¼Œæˆ‘ä»¬å»ºç«‹äº†åˆ›å»ºå‹æ¨¡å¼çš„å®Œæ•´ç†è®ºä½“ç³»ã€‚*
