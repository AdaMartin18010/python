# 03-03-è®¾è®¡æ¨¡å¼ç§‘å­¦

## ğŸ“‹ æ¦‚è¿°

è®¾è®¡æ¨¡å¼ç§‘å­¦æ˜¯ç ”ç©¶è½¯ä»¶è®¾è®¡ä¸­å¸¸è§é—®é¢˜çš„æ ‡å‡†è§£å†³æ–¹æ¡ˆçš„å­¦ç§‘ã€‚å®ƒæä¾›äº†å¯é‡ç”¨çš„è®¾è®¡æ¨¡æ¿ï¼Œå¸®åŠ©å¼€å‘è€…åˆ›å»ºçµæ´»ã€å¯ç»´æŠ¤å’Œå¯æ‰©å±•çš„è½¯ä»¶ç³»ç»Ÿã€‚

**ç›¸å…³æ–‡æ¡£**:

- [03-02-è½¯ä»¶æ¶æ„ç§‘å­¦](./03-02-è½¯ä»¶æ¶æ„ç§‘å­¦.md) - æ¶æ„æ¨¡å¼åº”ç”¨
- [06-03-è®¾è®¡æ¨¡å¼å®ç°](../06-ç»„ä»¶ç®—æ³•/06-03-è®¾è®¡æ¨¡å¼å®ç°.md) - æ¨¡å¼å®ç°ç»†èŠ‚

## ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ

### 1. è®¾è®¡æ¨¡å¼çš„å®šä¹‰

è®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶è®¾è®¡ä¸­å¸¸è§é—®é¢˜çš„å…¸å‹è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«ï¼š

- **é—®é¢˜æè¿°**: æ¨¡å¼è¦è§£å†³çš„å…·ä½“é—®é¢˜
- **è§£å†³æ–¹æ¡ˆ**: é—®é¢˜çš„æ ‡å‡†è§£å†³æ–¹å¼
- **æ•ˆæœ**: ä½¿ç”¨æ¨¡å¼çš„ä¼˜ç¼ºç‚¹
- **é€‚ç”¨åœºæ™¯**: æ¨¡å¼çš„åº”ç”¨æ¡ä»¶

### 2. æ¨¡å¼åˆ†ç±»

è®¾è®¡æ¨¡å¼æŒ‰ç›®çš„åˆ†ä¸ºä¸‰ç±»ï¼š

- **åˆ›å»ºå‹æ¨¡å¼**: å¤„ç†å¯¹è±¡åˆ›å»ºæœºåˆ¶
- **ç»“æ„å‹æ¨¡å¼**: å¤„ç†ç±»å’Œå¯¹è±¡çš„ç»„åˆ
- **è¡Œä¸ºå‹æ¨¡å¼**: å¤„ç†å¯¹è±¡é—´çš„é€šä¿¡

## ğŸ”¢ æ•°å­¦å½¢å¼åŒ–

### 1. æ¨¡å¼ç»“æ„å®šä¹‰

è®¾è®¡æ¨¡å¼å¯ä»¥å½¢å¼åŒ–ä¸ºï¼š

$$P = (C, R, I, E)$$

å…¶ä¸­ï¼š

- $C$ æ˜¯å‚ä¸ç±»é›†åˆ
- $R$ æ˜¯ç±»é—´å…³ç³»é›†åˆ
- $I$ æ˜¯æ¥å£é›†åˆ
- $E$ æ˜¯æ•ˆæœé›†åˆ

### 2. æ¨¡å¼å¤æ‚åº¦

æ¨¡å¼å¤æ‚åº¦å®šä¹‰ä¸ºï¼š

$$Complexity(P) = |C| + |R| + \sum_{c \in C} methods(c)$$

## ğŸ’» Python å®ç°

### 1. åˆ›å»ºå‹æ¨¡å¼

```python
from abc import ABC, abstractmethod
from typing import Dict, Any, Optional
from enum import Enum

# å•ä¾‹æ¨¡å¼
class Singleton:
    """å•ä¾‹æ¨¡å¼å®ç°"""
    _instance: Optional['Singleton'] = None
    
    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
        return cls._instance
    
    def __init__(self):
        if not hasattr(self, 'initialized'):
            self.data = {}
            self.initialized = True
    
    def set_data(self, key: str, value: Any):
        self.data[key] = value
    
    def get_data(self, key: str) -> Any:
        return self.data.get(key)

# å·¥å‚æ¨¡å¼
class ProductType(Enum):
    A = "A"
    B = "B"

class Product(ABC):
    @abstractmethod
    def operation(self) -> str:
        pass

class ConcreteProductA(Product):
    def operation(self) -> str:
        return "Product A operation"

class ConcreteProductB(Product):
    def operation(self) -> str:
        return "Product B operation"

class Factory:
    """å·¥å‚æ¨¡å¼å®ç°"""
    @staticmethod
    def create_product(product_type: ProductType) -> Product:
        if product_type == ProductType.A:
            return ConcreteProductA()
        elif product_type == ProductType.B:
            return ConcreteProductB()
        raise ValueError(f"Unknown product type: {product_type}")

# å»ºé€ è€…æ¨¡å¼
class Computer:
    def __init__(self):
        self.parts = []
    
    def add_part(self, part: str):
        self.parts.append(part)
    
    def list_parts(self) -> str:
        return f"Computer parts: {', '.join(self.parts)}"

class ComputerBuilder:
    """å»ºé€ è€…æ¨¡å¼å®ç°"""
    def __init__(self):
        self.reset()
    
    def reset(self):
        self._computer = Computer()
    
    def build_cpu(self):
        self._computer.add_part("CPU")
        return self
    
    def build_memory(self):
        self._computer.add_part("Memory")
        return self
    
    def build_disk(self):
        self._computer.add_part("Disk")
        return self
    
    def get_result(self) -> Computer:
        result = self._computer
        self.reset()
        return result
```

### 2. ç»“æ„å‹æ¨¡å¼

```python
# é€‚é…å™¨æ¨¡å¼
class Target(ABC):
    @abstractmethod
    def request(self) -> str:
        pass

class Adaptee:
    def specific_request(self) -> str:
        return "Specific request"

class Adapter(Target):
    """é€‚é…å™¨æ¨¡å¼å®ç°"""
    def __init__(self, adaptee: Adaptee):
        self.adaptee = adaptee
    
    def request(self) -> str:
        return f"Adapter: {self.adaptee.specific_request()}"

# è£…é¥°å™¨æ¨¡å¼
class Component(ABC):
    @abstractmethod
    def operation(self) -> str:
        pass

class ConcreteComponent(Component):
    def operation(self) -> str:
        return "ConcreteComponent"

class Decorator(Component):
    """è£…é¥°å™¨æ¨¡å¼å®ç°"""
    def __init__(self, component: Component):
        self._component = component
    
    def operation(self) -> str:
        return self._component.operation()

class ConcreteDecoratorA(Decorator):
    def operation(self) -> str:
        return f"ConcreteDecoratorA({super().operation()})"

class ConcreteDecoratorB(Decorator):
    def operation(self) -> str:
        return f"ConcreteDecoratorB({super().operation()})"

# ä»£ç†æ¨¡å¼
class Subject(ABC):
    @abstractmethod
    def request(self) -> str:
        pass

class RealSubject(Subject):
    def request(self) -> str:
        return "RealSubject request"

class Proxy(Subject):
    """ä»£ç†æ¨¡å¼å®ç°"""
    def __init__(self, real_subject: RealSubject):
        self._real_subject = real_subject
    
    def request(self) -> str:
        if self._check_access():
            result = self._real_subject.request()
            self._log_access()
            return result
        return "Access denied"
    
    def _check_access(self) -> bool:
        return True
    
    def _log_access(self):
        print("Logging access")
```

### 3. è¡Œä¸ºå‹æ¨¡å¼

```python
# è§‚å¯Ÿè€…æ¨¡å¼
class Observer(ABC):
    @abstractmethod
    def update(self, subject: 'Subject'):
        pass

class Subject:
    """è§‚å¯Ÿè€…æ¨¡å¼å®ç°"""
    def __init__(self):
        self._observers: List[Observer] = []
        self._state = None
    
    def attach(self, observer: Observer):
        self._observers.append(observer)
    
    def detach(self, observer: Observer):
        self._observers.remove(observer)
    
    def notify(self):
        for observer in self._observers:
            observer.update(self)
    
    @property
    def state(self):
        return self._state
    
    @state.setter
    def state(self, value):
        self._state = value
        self.notify()

class ConcreteObserverA(Observer):
    def update(self, subject: Subject):
        print(f"ObserverA: {subject.state}")

class ConcreteObserverB(Observer):
    def update(self, subject: Subject):
        print(f"ObserverB: {subject.state}")

# ç­–ç•¥æ¨¡å¼
class Strategy(ABC):
    @abstractmethod
    def algorithm_interface(self) -> str:
        pass

class ConcreteStrategyA(Strategy):
    def algorithm_interface(self) -> str:
        return "Strategy A"

class ConcreteStrategyB(Strategy):
    def algorithm_interface(self) -> str:
        return "Strategy B"

class Context:
    """ç­–ç•¥æ¨¡å¼å®ç°"""
    def __init__(self, strategy: Strategy):
        self._strategy = strategy
    
    def context_interface(self) -> str:
        return self._strategy.algorithm_interface()
    
    def set_strategy(self, strategy: Strategy):
        self._strategy = strategy

# å‘½ä»¤æ¨¡å¼
class Command(ABC):
    @abstractmethod
    def execute(self):
        pass

class Receiver:
    def action(self):
        return "Receiver action"

class ConcreteCommand(Command):
    """å‘½ä»¤æ¨¡å¼å®ç°"""
    def __init__(self, receiver: Receiver):
        self._receiver = receiver
    
    def execute(self):
        return self._receiver.action()

class Invoker:
    def __init__(self):
        self._command: Optional[Command] = None
    
    def set_command(self, command: Command):
        self._command = command
    
    def execute_command(self):
        if self._command:
            return self._command.execute()
        return "No command set"
```

### 4. æ¨¡å¼ç®¡ç†å™¨

```python
class PatternManager:
    """è®¾è®¡æ¨¡å¼ç®¡ç†å™¨"""
    
    def __init__(self):
        self.patterns: Dict[str, Dict[str, Any]] = {}
        self.usage_stats: Dict[str, int] = {}
    
    def register_pattern(self, name: str, pattern_class: type, 
                        category: str, description: str):
        """æ³¨å†Œè®¾è®¡æ¨¡å¼"""
        self.patterns[name] = {
            'class': pattern_class,
            'category': category,
            'description': description,
            'usage_count': 0
        }
    
    def use_pattern(self, name: str, *args, **kwargs) -> Any:
        """ä½¿ç”¨è®¾è®¡æ¨¡å¼"""
        if name not in self.patterns:
            raise ValueError(f"Pattern {name} not found")
        
        pattern_info = self.patterns[name]
        pattern_info['usage_count'] += 1
        self.usage_stats[name] = self.usage_stats.get(name, 0) + 1
        
        return pattern_info['class'](*args, **kwargs)
    
    def get_pattern_info(self, name: str) -> Dict[str, Any]:
        """è·å–æ¨¡å¼ä¿¡æ¯"""
        return self.patterns.get(name, {})
    
    def get_usage_stats(self) -> Dict[str, int]:
        """è·å–ä½¿ç”¨ç»Ÿè®¡"""
        return self.usage_stats.copy()
    
    def get_patterns_by_category(self, category: str) -> List[str]:
        """æŒ‰ç±»åˆ«è·å–æ¨¡å¼"""
        return [
            name for name, info in self.patterns.items()
            if info['category'] == category
        ]
    
    def analyze_pattern_complexity(self, name: str) -> float:
        """åˆ†ææ¨¡å¼å¤æ‚åº¦"""
        if name not in self.patterns:
            return 0.0
        
        pattern_class = self.patterns[name]['class']
        
        # è®¡ç®—ç±»çš„æ•°é‡
        class_count = 1  # ä¸»ç±»
        
        # è®¡ç®—æ–¹æ³•æ•°é‡
        method_count = len([m for m in dir(pattern_class) 
                           if not m.startswith('_')])
        
        # è®¡ç®—å…³ç³»æ•°é‡ï¼ˆç®€åŒ–ï¼‰
        relation_count = method_count  # å‡è®¾æ¯ä¸ªæ–¹æ³•ä»£è¡¨ä¸€ä¸ªå…³ç³»
        
        return class_count + relation_count + method_count
```

## ğŸ“Š å›¾è¡¨è¯´æ˜

### 1. è®¾è®¡æ¨¡å¼åˆ†ç±»å›¾

```mermaid
graph TB
    A[è®¾è®¡æ¨¡å¼] --> B[åˆ›å»ºå‹æ¨¡å¼]
    A --> C[ç»“æ„å‹æ¨¡å¼]
    A --> D[è¡Œä¸ºå‹æ¨¡å¼]
    
    B --> E[å•ä¾‹æ¨¡å¼]
    B --> F[å·¥å‚æ¨¡å¼]
    B --> G[å»ºé€ è€…æ¨¡å¼]
    
    C --> H[é€‚é…å™¨æ¨¡å¼]
    C --> I[è£…é¥°å™¨æ¨¡å¼]
    C --> J[ä»£ç†æ¨¡å¼]
    
    D --> K[è§‚å¯Ÿè€…æ¨¡å¼]
    D --> L[ç­–ç•¥æ¨¡å¼]
    D --> M[å‘½ä»¤æ¨¡å¼]
```

### 2. æ¨¡å¼å…³ç³»å›¾

```mermaid
graph LR
    A[å®¢æˆ·ç«¯] --> B[æŠ½è±¡æ¥å£]
    B --> C[å…·ä½“å®ç°]
    B --> D[å…·ä½“å®ç°]
    
    E[è£…é¥°å™¨] --> B
    F[ä»£ç†] --> B
    G[é€‚é…å™¨] --> B
```

## ğŸ“ æ¡ˆä¾‹åˆ†æ

### æ¡ˆä¾‹1: å•ä¾‹æ¨¡å¼åº”ç”¨

```python
def demonstrate_singleton():
    """æ¼”ç¤ºå•ä¾‹æ¨¡å¼"""
    # åˆ›å»ºå•ä¾‹å®ä¾‹
    singleton1 = Singleton()
    singleton1.set_data("key1", "value1")
    
    # åˆ›å»ºå¦ä¸€ä¸ªå®ä¾‹ï¼ˆåº”è¯¥æ˜¯åŒä¸€ä¸ªï¼‰
    singleton2 = Singleton()
    singleton2.set_data("key2", "value2")
    
    # éªŒè¯æ˜¯åŒä¸€ä¸ªå®ä¾‹
    print(f"Same instance: {singleton1 is singleton2}")
    print(f"Data from singleton1: {singleton1.get_data('key2')}")
    print(f"Data from singleton2: {singleton2.get_data('key1')}")

# è¿è¡Œæ¼”ç¤º
demonstrate_singleton()
```

### æ¡ˆä¾‹2: å·¥å‚æ¨¡å¼åº”ç”¨

```python
def demonstrate_factory():
    """æ¼”ç¤ºå·¥å‚æ¨¡å¼"""
    factory = Factory()
    
    # åˆ›å»ºä¸åŒç±»å‹çš„äº§å“
    product_a = factory.create_product(ProductType.A)
    product_b = factory.create_product(ProductType.B)
    
    print(f"Product A: {product_a.operation()}")
    print(f"Product B: {product_b.operation()}")

# è¿è¡Œæ¼”ç¤º
demonstrate_factory()
```

### æ¡ˆä¾‹3: è§‚å¯Ÿè€…æ¨¡å¼åº”ç”¨

```python
def demonstrate_observer():
    """æ¼”ç¤ºè§‚å¯Ÿè€…æ¨¡å¼"""
    subject = Subject()
    
    # åˆ›å»ºè§‚å¯Ÿè€…
    observer_a = ConcreteObserverA()
    observer_b = ConcreteObserverB()
    
    # æ³¨å†Œè§‚å¯Ÿè€…
    subject.attach(observer_a)
    subject.attach(observer_b)
    
    # æ”¹å˜çŠ¶æ€ï¼Œè§¦å‘é€šçŸ¥
    subject.state = "New State"
    
    # ç§»é™¤ä¸€ä¸ªè§‚å¯Ÿè€…
    subject.detach(observer_a)
    subject.state = "Another State"

# è¿è¡Œæ¼”ç¤º
demonstrate_observer()
```

## ğŸ”¬ ç†è®ºè¯æ˜

### å®šç†1: å•ä¾‹å”¯ä¸€æ€§å®šç†

**å®šç†**: å•ä¾‹æ¨¡å¼ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚

**è¯æ˜**:

1. **æ„é€ å‡½æ•°ç§æœ‰åŒ–**: é˜²æ­¢å¤–éƒ¨ç›´æ¥åˆ›å»ºå®ä¾‹
2. **é™æ€å®ä¾‹**: ç±»çº§åˆ«çš„é™æ€å˜é‡å­˜å‚¨å”¯ä¸€å®ä¾‹
3. **æ‡’åŠ è½½**: ç¬¬ä¸€æ¬¡è®¿é—®æ—¶åˆ›å»ºå®ä¾‹
4. **çº¿ç¨‹å®‰å…¨**: ä½¿ç”¨åŒæ­¥æœºåˆ¶ç¡®ä¿å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å”¯ä¸€æ€§

### å®šç†2: è§‚å¯Ÿè€…é€šçŸ¥å®šç†

**å®šç†**: è§‚å¯Ÿè€…æ¨¡å¼ç¡®ä¿æ‰€æœ‰æ³¨å†Œçš„è§‚å¯Ÿè€…éƒ½èƒ½æ”¶åˆ°çŠ¶æ€å˜æ›´é€šçŸ¥ã€‚

**è¯æ˜**:

1. **æ³¨å†Œæœºåˆ¶**: è§‚å¯Ÿè€…é€šè¿‡attachæ–¹æ³•æ³¨å†Œåˆ°ä¸»é¢˜
2. **é€šçŸ¥æœºåˆ¶**: ä¸»é¢˜çŠ¶æ€å˜æ›´æ—¶è°ƒç”¨notifyæ–¹æ³•
3. **éå†é€šçŸ¥**: éå†æ‰€æœ‰æ³¨å†Œçš„è§‚å¯Ÿè€…å¹¶è°ƒç”¨updateæ–¹æ³•
4. **è§£è€¦**: ä¸»é¢˜å’Œè§‚å¯Ÿè€…ä¹‹é—´æ¾è€¦åˆ

### å®šç†3: ç­–ç•¥æ›¿æ¢å®šç†

**å®šç†**: ç­–ç•¥æ¨¡å¼å…è®¸åœ¨è¿è¡Œæ—¶åŠ¨æ€æ›¿æ¢ç®—æ³•ã€‚

**è¯æ˜**:

1. **ç­–ç•¥æ¥å£**: å®šä¹‰ç®—æ³•çš„é€šç”¨æ¥å£
2. **å…·ä½“ç­–ç•¥**: å®ç°ä¸åŒçš„ç®—æ³•
3. **ä¸Šä¸‹æ–‡**: æŒæœ‰ç­–ç•¥å¼•ç”¨
4. **åŠ¨æ€æ›¿æ¢**: é€šè¿‡set_strategyæ–¹æ³•æ›¿æ¢ç­–ç•¥

## ğŸ”— ç›¸å…³é“¾æ¥

- [03-02-è½¯ä»¶æ¶æ„ç§‘å­¦](./03-02-è½¯ä»¶æ¶æ„ç§‘å­¦.md) - æ¶æ„æ¨¡å¼åº”ç”¨
- [06-03-è®¾è®¡æ¨¡å¼å®ç°](../06-ç»„ä»¶ç®—æ³•/06-03-è®¾è®¡æ¨¡å¼å®ç°.md) - æ¨¡å¼å®ç°ç»†èŠ‚
- [07-02-æœ€ä½³å®è·µ](../07-å®è·µåº”ç”¨/07-02-æœ€ä½³å®è·µ.md) - æ¨¡å¼ä½¿ç”¨æœ€ä½³å®è·µ

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2024å¹´12æœˆ19æ—¥  
**ç»´æŠ¤è€…**: AI Assistant
