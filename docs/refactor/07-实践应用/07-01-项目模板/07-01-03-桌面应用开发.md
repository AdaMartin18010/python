# æ¡Œé¢åº”ç”¨å¼€å‘

## ğŸ“‹ æ¦‚è¿°

æ¡Œé¢åº”ç”¨å¼€å‘æ˜¯ä¼ ç»Ÿè½¯ä»¶å·¥ç¨‹çš„é‡è¦é¢†åŸŸï¼Œæ¶‰åŠGUIæ¡†æ¶ã€ç³»ç»Ÿé›†æˆã€æœ¬åœ°å­˜å‚¨ç­‰æŠ€æœ¯ã€‚æœ¬æ–‡æ¡£æä¾›æ¡Œé¢åº”ç”¨å¼€å‘çš„å½¢å¼åŒ–å®šä¹‰ã€æŠ€æœ¯æ¶æ„å’Œæœ€ä½³å®è·µã€‚

## 1. å½¢å¼åŒ–å®šä¹‰

### 1.1 æ¡Œé¢åº”ç”¨ç³»ç»Ÿå®šä¹‰

**å®šä¹‰ 1.1** (æ¡Œé¢åº”ç”¨ç³»ç»Ÿ)
æ¡Œé¢åº”ç”¨ç³»ç»Ÿæ˜¯ä¸€ä¸ªå…­å…ƒç»„ $\mathcal{D} = (OS, GUI, L, S, D, E)$ï¼Œå…¶ä¸­ï¼š

- $OS$ æ˜¯æ“ä½œç³»ç»Ÿæ¥å£ï¼Œ$OS = (FS, P, N, UI)$
- $GUI$ æ˜¯å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼Œ$GUI = (W, C, E, L)$
- $L$ æ˜¯åº”ç”¨é€»è¾‘å±‚ï¼Œ$L = (B, V, C)$
- $S$ æ˜¯æœåŠ¡å±‚ï¼Œ$S = (API, DB, N)$
- $D$ æ˜¯æ•°æ®å±‚ï¼Œ$D = (FS, DB, C)$
- $E$ æ˜¯æ‰©å±•å±‚ï¼Œ$E = (P, M, I)$

**å®šä¹‰ 1.2** (æ¡Œé¢åº”ç”¨æ¶æ„)
æ¡Œé¢åº”ç”¨æ¶æ„æ˜¯ä¸€ä¸ªåˆ†å±‚ç»“æ„ $\mathcal{A} = (L_1, L_2, L_3, L_4, L_5)$ï¼š

- $L_1$: è¡¨ç¤ºå±‚ (Presentation Layer)
- $L_2$: ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)
- $L_3$: æ•°æ®è®¿é—®å±‚ (Data Access Layer)
- $L_4$: ç³»ç»ŸæœåŠ¡å±‚ (System Service Layer)
- $L_5$: æ“ä½œç³»ç»Ÿå±‚ (Operating System Layer)

### 1.2 GUIæ¡†æ¶ç†è®º

**å®šä¹‰ 1.3** (GUIç»„ä»¶)
GUIç»„ä»¶æ˜¯ä¸€ä¸ªä¸‰å…ƒç»„ $\mathcal{C} = (S, E, R)$ï¼Œå…¶ä¸­ï¼š

- $S$ æ˜¯çŠ¶æ€é›†åˆï¼Œ$S = \{s_1, s_2, \ldots, s_n\}$
- $E$ æ˜¯äº‹ä»¶é›†åˆï¼Œ$E = \{e_1, e_2, \ldots, e_m\}$
- $R$ æ˜¯æ¸²æŸ“å‡½æ•°ï¼Œ$R: S \times E \rightarrow S$

## 2. æŠ€æœ¯å®ç°

### 2.1 æ¡Œé¢åº”ç”¨æ¡†æ¶

```python
from abc import ABC, abstractmethod
from typing import Dict, List, Any, Optional, Callable, Tuple
from dataclasses import dataclass, field
from enum import Enum
import tkinter as tk
from tkinter import ttk, messagebox, filedialog
import json
import sqlite3
from pathlib import Path
import threading
import queue

class WindowState(Enum):
    """çª—å£çŠ¶æ€"""
    NORMAL = "normal"
    MINIMIZED = "minimized"
    MAXIMIZED = "maximized"
    CLOSED = "closed"

@dataclass
class WindowConfig:
    """çª—å£é…ç½®"""
    title: str
    width: int
    height: int
    resizable: bool = True
    center: bool = True
    icon_path: Optional[str] = None

class GUIComponent(ABC):
    """GUIç»„ä»¶æŠ½è±¡åŸºç±»"""
    
    def __init__(self, parent=None):
        self.parent = parent
        self.children: List[GUIComponent] = []
        self.event_handlers: Dict[str, Callable] = {}
    
    @abstractmethod
    def create_widget(self) -> Any:
        """åˆ›å»ºæ§ä»¶"""
        pass
    
    @abstractmethod
    def update_state(self, state: Dict[str, Any]) -> None:
        """æ›´æ–°çŠ¶æ€"""
        pass
    
    def add_child(self, child: 'GUIComponent') -> None:
        """æ·»åŠ å­ç»„ä»¶"""
        self.children.append(child)
    
    def bind_event(self, event: str, handler: Callable) -> None:
        """ç»‘å®šäº‹ä»¶"""
        self.event_handlers[event] = handler
    
    def trigger_event(self, event: str, data: Any = None) -> None:
        """è§¦å‘äº‹ä»¶"""
        if event in self.event_handlers:
            self.event_handlers[event](data)

class Button(GUIComponent):
    """æŒ‰é’®ç»„ä»¶"""
    
    def __init__(self, text: str, command: Callable = None, parent=None):
        super().__init__(parent)
        self.text = text
        self.command = command
        self.widget = None
    
    def create_widget(self) -> tk.Button:
        """åˆ›å»ºæŒ‰é’®æ§ä»¶"""
        self.widget = tk.Button(
            self.parent,
            text=self.text,
            command=self.command
        )
        return self.widget
    
    def update_state(self, state: Dict[str, Any]) -> None:
        """æ›´æ–°æŒ‰é’®çŠ¶æ€"""
        if self.widget:
            if 'text' in state:
                self.widget.config(text=state['text'])
            if 'enabled' in state:
                self.widget.config(state='normal' if state['enabled'] else 'disabled')

class TextInput(GUIComponent):
    """æ–‡æœ¬è¾“å…¥ç»„ä»¶"""
    
    def __init__(self, placeholder: str = "", parent=None):
        super().__init__(parent)
        self.placeholder = placeholder
        self.value = ""
        self.widget = None
    
    def create_widget(self) -> tk.Entry:
        """åˆ›å»ºè¾“å…¥æ¡†æ§ä»¶"""
        self.widget = tk.Entry(self.parent)
        if self.placeholder:
            self.widget.insert(0, self.placeholder)
        self.widget.bind('<FocusIn>', self._on_focus_in)
        self.widget.bind('<FocusOut>', self._on_focus_out)
        return self.widget
    
    def _on_focus_in(self, event):
        """è·å¾—ç„¦ç‚¹äº‹ä»¶"""
        if self.widget.get() == self.placeholder:
            self.widget.delete(0, tk.END)
    
    def _on_focus_out(self, event):
        """å¤±å»ç„¦ç‚¹äº‹ä»¶"""
        if not self.widget.get():
            self.widget.insert(0, self.placeholder)
    
    def update_state(self, state: Dict[str, Any]) -> None:
        """æ›´æ–°è¾“å…¥æ¡†çŠ¶æ€"""
        if self.widget:
            if 'value' in state:
                self.widget.delete(0, tk.END)
                self.widget.insert(0, state['value'])
            if 'readonly' in state:
                self.widget.config(state='readonly' if state['readonly'] else 'normal')
    
    def get_value(self) -> str:
        """è·å–è¾“å…¥å€¼"""
        if self.widget:
            return self.widget.get()
        return ""

class ListView(GUIComponent):
    """åˆ—è¡¨è§†å›¾ç»„ä»¶"""
    
    def __init__(self, columns: List[str], parent=None):
        super().__init__(parent)
        self.columns = columns
        self.items: List[Dict] = []
        self.widget = None
    
    def create_widget(self) -> ttk.Treeview:
        """åˆ›å»ºåˆ—è¡¨æ§ä»¶"""
        self.widget = ttk.Treeview(self.parent, columns=self.columns, show='headings')
        
        # è®¾ç½®åˆ—æ ‡é¢˜
        for col in self.columns:
            self.widget.heading(col, text=col)
            self.widget.column(col, width=100)
        
        # ç»‘å®šé€‰æ‹©äº‹ä»¶
        self.widget.bind('<<TreeviewSelect>>', self._on_select)
        return self.widget
    
    def _on_select(self, event):
        """é€‰æ‹©äº‹ä»¶"""
        selection = self.widget.selection()
        if selection:
            item_id = selection[0]
            item_data = self.widget.item(item_id)
            self.trigger_event('select', item_data)
    
    def update_state(self, state: Dict[str, Any]) -> None:
        """æ›´æ–°åˆ—è¡¨çŠ¶æ€"""
        if self.widget and 'items' in state:
            # æ¸…ç©ºç°æœ‰é¡¹
            for item in self.widget.get_children():
                self.widget.delete(item)
            
            # æ·»åŠ æ–°é¡¹
            for item_data in state['items']:
                values = [item_data.get(col, '') for col in self.columns]
                self.widget.insert('', 'end', values=values)
    
    def add_item(self, item_data: Dict) -> None:
        """æ·»åŠ åˆ—è¡¨é¡¹"""
        if self.widget:
            values = [item_data.get(col, '') for col in self.columns]
            self.widget.insert('', 'end', values=values)
    
    def remove_item(self, item_id: str) -> None:
        """ç§»é™¤åˆ—è¡¨é¡¹"""
        if self.widget:
            self.widget.delete(item_id)

class DesktopApp:
    """æ¡Œé¢åº”ç”¨åŸºç±»"""
    
    def __init__(self, config: WindowConfig):
        self.config = config
        self.root = tk.Tk()
        self.components: List[GUIComponent] = []
        self.state: Dict[str, Any] = {}
        self.setup_window()
    
    def setup_window(self) -> None:
        """è®¾ç½®çª—å£"""
        self.root.title(self.config.title)
        self.root.geometry(f"{self.config.width}x{self.config.height}")
        
        if not self.config.resizable:
            self.root.resizable(False, False)
        
        if self.config.center:
            self.center_window()
        
        if self.config.icon_path:
            self.root.iconbitmap(self.config.icon_path)
    
    def center_window(self) -> None:
        """å±…ä¸­çª—å£"""
        self.root.update_idletasks()
        width = self.root.winfo_width()
        height = self.root.winfo_height()
        x = (self.root.winfo_screenwidth() // 2) - (width // 2)
        y = (self.root.winfo_screenheight() // 2) - (height // 2)
        self.root.geometry(f"{width}x{height}+{x}+{y}")
    
    def add_component(self, component: GUIComponent) -> None:
        """æ·»åŠ ç»„ä»¶"""
        self.components.append(component)
        component.parent = self.root
        widget = component.create_widget()
        widget.pack(pady=5, padx=5, fill=tk.BOTH, expand=True)
    
    def update_state(self, key: str, value: Any) -> None:
        """æ›´æ–°åº”ç”¨çŠ¶æ€"""
        self.state[key] = value
        self._notify_components(key, value)
    
    def _notify_components(self, key: str, value: Any) -> None:
        """é€šçŸ¥ç»„ä»¶çŠ¶æ€å˜åŒ–"""
        for component in self.components:
            component.update_state({key: value})
    
    def run(self) -> None:
        """è¿è¡Œåº”ç”¨"""
        self.root.mainloop()
    
    def close(self) -> None:
        """å…³é—­åº”ç”¨"""
        self.root.quit()

class DataManager:
    """æ•°æ®ç®¡ç†å™¨"""
    
    def __init__(self, db_path: str = "app.db"):
        self.db_path = db_path
        self.connection = None
        self.setup_database()
    
    def setup_database(self) -> None:
        """è®¾ç½®æ•°æ®åº“"""
        self.connection = sqlite3.connect(self.db_path)
        self.create_tables()
    
    def create_tables(self) -> None:
        """åˆ›å»ºæ•°æ®è¡¨"""
        cursor = self.connection.cursor()
        
        # åˆ›å»ºç”¨æˆ·è¡¨
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS users (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                name TEXT NOT NULL,
                email TEXT UNIQUE,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
            )
        ''')
        
        # åˆ›å»ºä»»åŠ¡è¡¨
        cursor.execute('''
            CREATE TABLE IF NOT EXISTS tasks (
                id INTEGER PRIMARY KEY AUTOINCREMENT,
                title TEXT NOT NULL,
                description TEXT,
                completed BOOLEAN DEFAULT FALSE,
                user_id INTEGER,
                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
                FOREIGN KEY (user_id) REFERENCES users (id)
            )
        ''')
        
        self.connection.commit()
    
    def insert_user(self, name: str, email: str) -> int:
        """æ’å…¥ç”¨æˆ·"""
        cursor = self.connection.cursor()
        cursor.execute(
            "INSERT INTO users (name, email) VALUES (?, ?)",
            (name, email)
        )
        self.connection.commit()
        return cursor.lastrowid
    
    def insert_task(self, title: str, description: str, user_id: int) -> int:
        """æ’å…¥ä»»åŠ¡"""
        cursor = self.connection.cursor()
        cursor.execute(
            "INSERT INTO tasks (title, description, user_id) VALUES (?, ?, ?)",
            (title, description, user_id)
        )
        self.connection.commit()
        return cursor.lastrowid
    
    def get_tasks(self, user_id: int) -> List[Dict]:
        """è·å–ç”¨æˆ·ä»»åŠ¡"""
        cursor = self.connection.cursor()
        cursor.execute(
            "SELECT * FROM tasks WHERE user_id = ?",
            (user_id,)
        )
        columns = [description[0] for description in cursor.description]
        return [dict(zip(columns, row)) for row in cursor.fetchall()]
    
    def update_task(self, task_id: int, completed: bool) -> None:
        """æ›´æ–°ä»»åŠ¡çŠ¶æ€"""
        cursor = self.connection.cursor()
        cursor.execute(
            "UPDATE tasks SET completed = ? WHERE id = ?",
            (completed, task_id)
        )
        self.connection.commit()
    
    def close(self) -> None:
        """å…³é—­æ•°æ®åº“è¿æ¥"""
        if self.connection:
            self.connection.close()
```

### 2.2 äº‹ä»¶ç³»ç»Ÿ

```python
class EventSystem:
    """äº‹ä»¶ç³»ç»Ÿ"""
    
    def __init__(self):
        self.event_handlers: Dict[str, List[Callable]] = {}
        self.event_queue = queue.Queue()
        self.running = False
    
    def subscribe(self, event_type: str, handler: Callable) -> None:
        """è®¢é˜…äº‹ä»¶"""
        if event_type not in self.event_handlers:
            self.event_handlers[event_type] = []
        self.event_handlers[event_type].append(handler)
    
    def unsubscribe(self, event_type: str, handler: Callable) -> None:
        """å–æ¶ˆè®¢é˜…"""
        if event_type in self.event_handlers:
            if handler in self.event_handlers[event_type]:
                self.event_handlers[event_type].remove(handler)
    
    def publish(self, event_type: str, data: Any = None) -> None:
        """å‘å¸ƒäº‹ä»¶"""
        self.event_queue.put((event_type, data))
    
    def start(self) -> None:
        """å¯åŠ¨äº‹ä»¶ç³»ç»Ÿ"""
        self.running = True
        self._process_events()
    
    def stop(self) -> None:
        """åœæ­¢äº‹ä»¶ç³»ç»Ÿ"""
        self.running = False
    
    def _process_events(self) -> None:
        """å¤„ç†äº‹ä»¶é˜Ÿåˆ—"""
        while self.running:
            try:
                event_type, data = self.event_queue.get(timeout=0.1)
                if event_type in self.event_handlers:
                    for handler in self.event_handlers[event_type]:
                        try:
                            handler(data)
                        except Exception as e:
                            print(f"Error in event handler: {e}")
            except queue.Empty:
                continue

class ApplicationController:
    """åº”ç”¨æ§åˆ¶å™¨"""
    
    def __init__(self, app: DesktopApp, data_manager: DataManager):
        self.app = app
        self.data_manager = data_manager
        self.event_system = EventSystem()
        self.current_user_id = None
        self.setup_event_handlers()
    
    def setup_event_handlers(self) -> None:
        """è®¾ç½®äº‹ä»¶å¤„ç†å™¨"""
        self.event_system.subscribe('user_login', self.handle_user_login)
        self.event_system.subscribe('task_add', self.handle_task_add)
        self.event_system.subscribe('task_toggle', self.handle_task_toggle)
        self.event_system.subscribe('task_delete', self.handle_task_delete)
    
    def handle_user_login(self, user_data: Dict) -> None:
        """å¤„ç†ç”¨æˆ·ç™»å½•"""
        try:
            user_id = self.data_manager.insert_user(
                user_data['name'],
                user_data['email']
            )
            self.current_user_id = user_id
            self.load_user_tasks()
        except Exception as e:
            messagebox.showerror("Error", f"Login failed: {e}")
    
    def handle_task_add(self, task_data: Dict) -> None:
        """å¤„ç†æ·»åŠ ä»»åŠ¡"""
        if not self.current_user_id:
            messagebox.showwarning("Warning", "Please login first")
            return
        
        try:
            task_id = self.data_manager.insert_task(
                task_data['title'],
                task_data.get('description', ''),
                self.current_user_id
            )
            self.load_user_tasks()
        except Exception as e:
            messagebox.showerror("Error", f"Failed to add task: {e}")
    
    def handle_task_toggle(self, task_id: int) -> None:
        """å¤„ç†åˆ‡æ¢ä»»åŠ¡çŠ¶æ€"""
        try:
            # è·å–å½“å‰ä»»åŠ¡çŠ¶æ€å¹¶åˆ‡æ¢
            tasks = self.data_manager.get_tasks(self.current_user_id)
            task = next((t for t in tasks if t['id'] == task_id), None)
            if task:
                self.data_manager.update_task(task_id, not task['completed'])
                self.load_user_tasks()
        except Exception as e:
            messagebox.showerror("Error", f"Failed to update task: {e}")
    
    def handle_task_delete(self, task_id: int) -> None:
        """å¤„ç†åˆ é™¤ä»»åŠ¡"""
        try:
            # è¿™é‡Œåº”è¯¥æ·»åŠ åˆ é™¤ä»»åŠ¡çš„æ–¹æ³•
            self.load_user_tasks()
        except Exception as e:
            messagebox.showerror("Error", f"Failed to delete task: {e}")
    
    def load_user_tasks(self) -> None:
        """åŠ è½½ç”¨æˆ·ä»»åŠ¡"""
        if self.current_user_id:
            tasks = self.data_manager.get_tasks(self.current_user_id)
            self.app.update_state('tasks', tasks)
    
    def start(self) -> None:
        """å¯åŠ¨æ§åˆ¶å™¨"""
        self.event_system.start()
        self.app.run()
    
    def stop(self) -> None:
        """åœæ­¢æ§åˆ¶å™¨"""
        self.event_system.stop()
        self.data_manager.close()
```

### 2.3 é…ç½®ç®¡ç†

```python
import configparser
import os
from typing import Any, Dict

class ConfigManager:
    """é…ç½®ç®¡ç†å™¨"""
    
    def __init__(self, config_file: str = "config.ini"):
        self.config_file = config_file
        self.config = configparser.ConfigParser()
        self.load_config()
    
    def load_config(self) -> None:
        """åŠ è½½é…ç½®"""
        if os.path.exists(self.config_file):
            self.config.read(self.config_file)
        else:
            self.create_default_config()
    
    def create_default_config(self) -> None:
        """åˆ›å»ºé»˜è®¤é…ç½®"""
        self.config['DEFAULT'] = {
            'theme': 'default',
            'language': 'en',
            'auto_save': 'true',
            'window_width': '800',
            'window_height': '600'
        }
        
        self.config['DATABASE'] = {
            'path': 'app.db',
            'backup_enabled': 'true',
            'backup_interval': '24'
        }
        
        self.config['UI'] = {
            'font_size': '12',
            'font_family': 'Arial',
            'show_toolbar': 'true',
            'show_statusbar': 'true'
        }
        
        self.save_config()
    
    def get(self, section: str, key: str, fallback: Any = None) -> Any:
        """è·å–é…ç½®å€¼"""
        return self.config.get(section, key, fallback=fallback)
    
    def getint(self, section: str, key: str, fallback: int = 0) -> int:
        """è·å–æ•´æ•°é…ç½®å€¼"""
        return self.config.getint(section, key, fallback=fallback)
    
    def getboolean(self, section: str, key: str, fallback: bool = False) -> bool:
        """è·å–å¸ƒå°”é…ç½®å€¼"""
        return self.config.getboolean(section, key, fallback=fallback)
    
    def set(self, section: str, key: str, value: str) -> None:
        """è®¾ç½®é…ç½®å€¼"""
        if not self.config.has_section(section):
            self.config.add_section(section)
        self.config.set(section, key, value)
        self.save_config()
    
    def save_config(self) -> None:
        """ä¿å­˜é…ç½®"""
        with open(self.config_file, 'w') as configfile:
            self.config.write(configfile)
    
    def get_all_config(self) -> Dict[str, Dict[str, str]]:
        """è·å–æ‰€æœ‰é…ç½®"""
        result = {}
        for section in self.config.sections():
            result[section] = dict(self.config[section])
        return result
```

## 3. å®é™…åº”ç”¨ç¤ºä¾‹

### 3.1 å®Œæ•´çš„æ¡Œé¢åº”ç”¨ç¤ºä¾‹

```python
class TodoDesktopApp:
    """å®Œæ•´çš„å¾…åŠäº‹é¡¹æ¡Œé¢åº”ç”¨"""
    
    def __init__(self):
        self.config_manager = ConfigManager()
        self.data_manager = DataManager()
        
        # åˆ›å»ºçª—å£é…ç½®
        window_config = WindowConfig(
            title="Todo Desktop App",
            width=self.config_manager.getint('DEFAULT', 'window_width', 800),
            height=self.config_manager.getint('DEFAULT', 'window_height', 600)
        )
        
        self.app = DesktopApp(window_config)
        self.controller = ApplicationController(self.app, self.data_manager)
        
        self.setup_ui()
    
    def setup_ui(self) -> None:
        """è®¾ç½®ç”¨æˆ·ç•Œé¢"""
        # åˆ›å»ºä¸»æ¡†æ¶
        main_frame = tk.Frame(self.app.root)
        main_frame.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)
        
        # æ ‡é¢˜
        title_label = tk.Label(main_frame, text="Todo Desktop Application", 
                              font=("Arial", 16, "bold"))
        title_label.pack(pady=(0, 20))
        
        # ç”¨æˆ·ç™»å½•æ¡†æ¶
        login_frame = tk.LabelFrame(main_frame, text="User Login", padx=10, pady=10)
        login_frame.pack(fill=tk.X, pady=(0, 10))
        
        # ç”¨æˆ·åè¾“å…¥
        tk.Label(login_frame, text="Name:").grid(row=0, column=0, sticky=tk.W)
        self.name_entry = tk.Entry(login_frame, width=30)
        self.name_entry.grid(row=0, column=1, padx=(10, 0))
        
        # é‚®ç®±è¾“å…¥
        tk.Label(login_frame, text="Email:").grid(row=1, column=0, sticky=tk.W, pady=(10, 0))
        self.email_entry = tk.Entry(login_frame, width=30)
        self.email_entry.grid(row=1, column=1, padx=(10, 0), pady=(10, 0))
        
        # ç™»å½•æŒ‰é’®
        login_button = tk.Button(login_frame, text="Login", 
                                command=self.handle_login)
        login_button.grid(row=2, column=0, columnspan=2, pady=(10, 0))
        
        # ä»»åŠ¡ç®¡ç†æ¡†æ¶
        task_frame = tk.LabelFrame(main_frame, text="Task Management", padx=10, pady=10)
        task_frame.pack(fill=tk.BOTH, expand=True, pady=(0, 10))
        
        # æ·»åŠ ä»»åŠ¡æ¡†æ¶
        add_task_frame = tk.Frame(task_frame)
        add_task_frame.pack(fill=tk.X, pady=(0, 10))
        
        tk.Label(add_task_frame, text="New Task:").pack(side=tk.LEFT)
        self.task_entry = tk.Entry(add_task_frame, width=40)
        self.task_entry.pack(side=tk.LEFT, padx=(10, 10))
        
        add_button = tk.Button(add_task_frame, text="Add Task", 
                              command=self.handle_add_task)
        add_button.pack(side=tk.LEFT)
        
        # ä»»åŠ¡åˆ—è¡¨
        list_frame = tk.Frame(task_frame)
        list_frame.pack(fill=tk.BOTH, expand=True)
        
        # åˆ›å»ºTreeview
        columns = ('ID', 'Title', 'Description', 'Status', 'Created')
        self.task_tree = ttk.Treeview(list_frame, columns=columns, show='headings')
        
        # è®¾ç½®åˆ—æ ‡é¢˜
        for col in columns:
            self.task_tree.heading(col, text=col)
            self.task_tree.column(col, width=100)
        
        # æ·»åŠ æ»šåŠ¨æ¡
        scrollbar = ttk.Scrollbar(list_frame, orient=tk.VERTICAL, command=self.task_tree.yview)
        self.task_tree.configure(yscrollcommand=scrollbar.set)
        
        self.task_tree.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
        scrollbar.pack(side=tk.RIGHT, fill=tk.Y)
        
        # ç»‘å®šåŒå‡»äº‹ä»¶
        self.task_tree.bind('<Double-1>', self.handle_task_double_click)
        
        # æ“ä½œæŒ‰é’®æ¡†æ¶
        button_frame = tk.Frame(task_frame)
        button_frame.pack(fill=tk.X, pady=(10, 0))
        
        toggle_button = tk.Button(button_frame, text="Toggle Status", 
                                 command=self.handle_toggle_task)
        toggle_button.pack(side=tk.LEFT, padx=(0, 10))
        
        delete_button = tk.Button(button_frame, text="Delete Task", 
                                 command=self.handle_delete_task)
        delete_button.pack(side=tk.LEFT)
        
        refresh_button = tk.Button(button_frame, text="Refresh", 
                                  command=self.refresh_tasks)
        refresh_button.pack(side=tk.RIGHT)
    
    def handle_login(self) -> None:
        """å¤„ç†ç™»å½•"""
        name = self.name_entry.get().strip()
        email = self.email_entry.get().strip()
        
        if not name or not email:
            messagebox.showwarning("Warning", "Please enter both name and email")
            return
        
        user_data = {'name': name, 'email': email}
        self.controller.event_system.publish('user_login', user_data)
    
    def handle_add_task(self) -> None:
        """å¤„ç†æ·»åŠ ä»»åŠ¡"""
        title = self.task_entry.get().strip()
        if not title:
            messagebox.showwarning("Warning", "Please enter a task title")
            return
        
        task_data = {'title': title, 'description': ''}
        self.controller.event_system.publish('task_add', task_data)
        self.task_entry.delete(0, tk.END)
    
    def handle_task_double_click(self, event) -> None:
        """å¤„ç†ä»»åŠ¡åŒå‡»"""
        selection = self.task_tree.selection()
        if selection:
            item_id = selection[0]
            item_data = self.task_tree.item(item_id)
            # è¿™é‡Œå¯ä»¥æ‰“å¼€ä»»åŠ¡ç¼–è¾‘å¯¹è¯æ¡†
            messagebox.showinfo("Task Details", f"Task: {item_data['values'][1]}")
    
    def handle_toggle_task(self) -> None:
        """å¤„ç†åˆ‡æ¢ä»»åŠ¡çŠ¶æ€"""
        selection = self.task_tree.selection()
        if selection:
            item_id = selection[0]
            item_data = self.task_tree.item(item_id)
            task_id = item_data['values'][0]
            self.controller.event_system.publish('task_toggle', task_id)
        else:
            messagebox.showwarning("Warning", "Please select a task")
    
    def handle_delete_task(self) -> None:
        """å¤„ç†åˆ é™¤ä»»åŠ¡"""
        selection = self.task_tree.selection()
        if selection:
            if messagebox.askyesno("Confirm", "Are you sure you want to delete this task?"):
                item_id = selection[0]
                item_data = self.task_tree.item(item_id)
                task_id = item_data['values'][0]
                self.controller.event_system.publish('task_delete', task_id)
        else:
            messagebox.showwarning("Warning", "Please select a task")
    
    def refresh_tasks(self) -> None:
        """åˆ·æ–°ä»»åŠ¡åˆ—è¡¨"""
        self.controller.load_user_tasks()
        self.update_task_display()
    
    def update_task_display(self) -> None:
        """æ›´æ–°ä»»åŠ¡æ˜¾ç¤º"""
        # æ¸…ç©ºç°æœ‰æ˜¾ç¤º
        for item in self.task_tree.get_children():
            self.task_tree.delete(item)
        
        # è·å–å½“å‰ä»»åŠ¡
        tasks = self.controller.data_manager.get_tasks(self.controller.current_user_id or 0)
        
        # æ·»åŠ åˆ°æ˜¾ç¤º
        for task in tasks:
            status = "Completed" if task['completed'] else "Pending"
            values = (
                task['id'],
                task['title'],
                task['description'] or '',
                status,
                task['created_at']
            )
            self.task_tree.insert('', 'end', values=values)
    
    def run(self) -> None:
        """è¿è¡Œåº”ç”¨"""
        try:
            self.controller.start()
        except KeyboardInterrupt:
            print("Application interrupted by user")
        finally:
            self.controller.stop()

# ä½¿ç”¨ç¤ºä¾‹
def main():
    """ä¸»å‡½æ•°"""
    app = TodoDesktopApp()
    app.run()

if __name__ == "__main__":
    main()
```

## 4. æ€»ç»“

### 4.1 æŠ€æœ¯è¦ç‚¹

1. **GUIæ¡†æ¶**: ä½¿ç”¨tkinteræ„å»ºè·¨å¹³å°æ¡Œé¢ç•Œé¢
2. **æ•°æ®ç®¡ç†**: SQLiteæ•°æ®åº“å­˜å‚¨å’Œæœ¬åœ°æ–‡ä»¶ç®¡ç†
3. **äº‹ä»¶ç³»ç»Ÿ**: å¼‚æ­¥äº‹ä»¶å¤„ç†å’Œæ¶ˆæ¯ä¼ é€’
4. **é…ç½®ç®¡ç†**: ç”¨æˆ·é…ç½®çš„æŒä¹…åŒ–å­˜å‚¨
5. **çŠ¶æ€ç®¡ç†**: åº”ç”¨çŠ¶æ€çš„ç»Ÿä¸€ç®¡ç†

### 4.2 æœ€ä½³å®è·µ

1. **æ¨¡å—åŒ–è®¾è®¡**: å°†UIã€ä¸šåŠ¡é€»è¾‘ã€æ•°æ®è®¿é—®åˆ†ç¦»
2. **äº‹ä»¶é©±åŠ¨**: ä½¿ç”¨äº‹ä»¶ç³»ç»Ÿè§£è€¦ç»„ä»¶
3. **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œç”¨æˆ·åé¦ˆ
4. **é…ç½®ç®¡ç†**: çµæ´»çš„é…ç½®ç³»ç»Ÿ
5. **èµ„æºç®¡ç†**: æ­£ç¡®çš„èµ„æºé‡Šæ”¾å’Œæ¸…ç†

### 4.3 æ‰©å±•æ–¹å‘

1. **ä¸»é¢˜ç³»ç»Ÿ**: æ”¯æŒå¤šç§UIä¸»é¢˜
2. **æ’ä»¶ç³»ç»Ÿ**: å¯æ‰©å±•çš„æ’ä»¶æ¶æ„
3. **å›½é™…åŒ–**: å¤šè¯­è¨€æ”¯æŒ
4. **è‡ªåŠ¨æ›´æ–°**: åº”ç”¨è‡ªåŠ¨æ›´æ–°æœºåˆ¶
5. **ç³»ç»Ÿé›†æˆ**: ä¸æ“ä½œç³»ç»Ÿçš„æ·±åº¦é›†æˆ

---

**ç›¸å…³æ–‡æ¡£**:

- [Webåº”ç”¨å¼€å‘](./07-01-01-Webåº”ç”¨å¼€å‘.md)
- [ç§»åŠ¨åº”ç”¨å¼€å‘](./07-01-02-ç§»åŠ¨åº”ç”¨å¼€å‘.md)
- [å¾®æœåŠ¡åº”ç”¨](./07-01-04-å¾®æœåŠ¡åº”ç”¨.md)
